var Yt=Object.defineProperty;var Xt=(r,s,t)=>s in r?Yt(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t;var ee=(r,s,t)=>(Xt(r,typeof s!="symbol"?s+"":s,t),t);import{r as g,a as Zt,g as Qt,R as Vs,u as ea,N as sa,b as ta,d as We,O as aa,e as na,B as ra,f as ia,h as ye}from"./vendor-1f968de6.js";import{c as q,R as Ts,A as Ct,C as Es,X as Ms,Y as Rs,a as is,B as oa,b as at}from"./charts-89bdfd59.js";import{_ as Ps}from"./auth-d413bd9a.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();var kt={exports:{}},js={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var la=g,ca=Symbol.for("react.element"),da=Symbol.for("react.fragment"),ma=Object.prototype.hasOwnProperty,ua=la.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ha={key:!0,ref:!0,__self:!0,__source:!0};function At(r,s,t){var a,n={},i=null,o=null;t!==void 0&&(i=""+t),s.key!==void 0&&(i=""+s.key),s.ref!==void 0&&(o=s.ref);for(a in s)ma.call(s,a)&&!ha.hasOwnProperty(a)&&(n[a]=s[a]);if(r&&r.defaultProps)for(a in s=r.defaultProps,s)n[a]===void 0&&(n[a]=s[a]);return{$$typeof:ca,type:r,key:i,ref:o,props:n,_owner:ua.current}}js.Fragment=da;js.jsx=At;js.jsxs=At;kt.exports=js;var e=kt.exports,Ds={},nt=Zt;Ds.createRoot=nt.createRoot,Ds.hydrateRoot=nt.hydrateRoot;const rt=r=>{let s;const t=new Set,a=(c,u)=>{const p=typeof c=="function"?c(s):c;if(!Object.is(p,s)){const y=s;s=u??(typeof p!="object"||p===null)?p:Object.assign({},s,p),t.forEach(S=>S(s,y))}},n=()=>s,l={setState:a,getState:n,getInitialState:()=>h,subscribe:c=>(t.add(c),()=>t.delete(c)),destroy:()=>{t.clear()}},h=s=r(a,n,l);return l},xa=r=>r?rt(r):rt;var It={exports:{}},Tt={},Et={exports:{}},Mt={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ze=g;function pa(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var ga=typeof Object.is=="function"?Object.is:pa,fa=Ze.useState,ya=Ze.useEffect,va=Ze.useLayoutEffect,ja=Ze.useDebugValue;function ba(r,s){var t=s(),a=fa({inst:{value:t,getSnapshot:s}}),n=a[0].inst,i=a[1];return va(function(){n.value=t,n.getSnapshot=s,Ss(n)&&i({inst:n})},[r,t,s]),ya(function(){return Ss(n)&&i({inst:n}),r(function(){Ss(n)&&i({inst:n})})},[r]),ja(t),t}function Ss(r){var s=r.getSnapshot;r=r.value;try{var t=s();return!ga(r,t)}catch{return!0}}function Na(r,s){return s()}var wa=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Na:ba;Mt.useSyncExternalStore=Ze.useSyncExternalStore!==void 0?Ze.useSyncExternalStore:wa;Et.exports=Mt;var Sa=Et.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bs=g,Ca=Sa;function ka(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Aa=typeof Object.is=="function"?Object.is:ka,Ia=Ca.useSyncExternalStore,Ta=bs.useRef,Ea=bs.useEffect,Ma=bs.useMemo,Ra=bs.useDebugValue;Tt.useSyncExternalStoreWithSelector=function(r,s,t,a,n){var i=Ta(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=Ma(function(){function l(y){if(!h){if(h=!0,c=y,y=a(y),n!==void 0&&o.hasValue){var S=o.value;if(n(S,y))return u=S}return u=y}if(S=u,Aa(c,y))return S;var f=a(y);return n!==void 0&&n(S,f)?(c=y,S):(c=y,u=f)}var h=!1,c,u,p=t===void 0?null:t;return[function(){return l(s())},p===null?void 0:function(){return l(p())}]},[s,t,a,n]);var m=Ia(r,i[0],i[1]);return Ea(function(){o.hasValue=!0,o.value=m},[m]),Ra(m),m};It.exports=Tt;var Pa=It.exports;const Da=Qt(Pa),{useDebugValue:Oa}=Vs,{useSyncExternalStoreWithSelector:La}=Da;const _a=r=>r;function Ua(r,s=_a,t){const a=La(r.subscribe,r.getState,r.getServerState||r.getInitialState,s,t);return Oa(a),a}const it=r=>{const s=typeof r=="function"?xa(r):r,t=(a,n)=>Ua(s,a,n);return Object.assign(t,s),t},Rt=r=>r?it(r):it,Fa=r=>(s,t,a)=>{const n=a.subscribe;return a.subscribe=(o,m,l)=>{let h=o;if(m){const c=(l==null?void 0:l.equalityFn)||Object.is;let u=o(a.getState());h=p=>{const y=o(p);if(!c(u,y)){const S=u;m(u=y,S)}},l!=null&&l.fireImmediately&&m(u,u)}return n(h)},r(s,t,a)},Pt=Fa,ms={"tenant-acme":{id:"tenant-acme",name:"ACME Corporation",subscriptionTier:"enterprise",status:"active",region:"australia-east",createdAt:"2024-01-15T00:00:00Z",updatedAt:"2024-08-19T00:00:00Z",settings:{enabledFeatures:["mcp-tools","byo-llm","advanced-audit","compliance-reports"],mcpToolsEnabled:["archer-connector","risk-analyzer","compliance-checker"],byoLlmEnabled:!0,auditRetentionDays:2555,allowedMcpServers:["archer","servicenow","azure-sentinel"],complianceFrameworks:["ISO27001","CPS230"]},quota:{dailyApiCalls:1e4,monthlyTokens:1e6,storageGB:100,users:50,currentUsage:{apiCalls:2847,tokens:245e3,storage:23.5,users:12}}},"tenant-fintech":{id:"tenant-fintech",name:"FinTech Solutions Ltd",subscriptionTier:"professional",status:"active",region:"australia-east",createdAt:"2024-03-01T00:00:00Z",updatedAt:"2024-08-19T00:00:00Z",settings:{enabledFeatures:["mcp-tools","compliance-reports"],mcpToolsEnabled:["archer-connector","compliance-checker"],byoLlmEnabled:!1,auditRetentionDays:2555,allowedMcpServers:["archer","azure-sentinel"],complianceFrameworks:["CPS230","SOC2"]},quota:{dailyApiCalls:5e3,monthlyTokens:5e5,storageGB:50,users:25,currentUsage:{apiCalls:1234,tokens:156e3,storage:18.2,users:8}}}},$a={"user1@acme.com":{id:"user-001",email:"user1@acme.com",name:"Sarah Chen",tenantId:"tenant-acme",roles:["TenantOwner"],lastLogin:"2024-08-19T08:30:00Z",isActive:!0,mfaEnabled:!0},"analyst@acme.com":{id:"user-002",email:"analyst@acme.com",name:"Mike Johnson",tenantId:"tenant-acme",roles:["AgentUser"],lastLogin:"2024-08-19T07:15:00Z",isActive:!0,mfaEnabled:!0},"audit@acme.com":{id:"user-003",email:"audit@acme.com",name:"Lisa Wang",tenantId:"tenant-acme",roles:["Auditor","ComplianceOfficer"],lastLogin:"2024-08-18T16:45:00Z",isActive:!0,mfaEnabled:!0},"owner@fintech.com":{id:"user-004",email:"owner@fintech.com",name:"David Smith",tenantId:"tenant-fintech",roles:["TenantOwner"],lastLogin:"2024-08-19T09:00:00Z",isActive:!0,mfaEnabled:!0},"admin@platform.com":{id:"user-005",email:"admin@platform.com",name:"Alex Rodriguez",tenantId:"tenant-acme",roles:["PlatformOwner"],lastLogin:"2024-08-20T10:15:00Z",isActive:!0,mfaEnabled:!0}},_e=class _e{constructor(){ee(this,"currentToken",null)}static getInstance(){return _e.instance||(_e.instance=new _e),_e.instance}async login(s){await new Promise(i=>setTimeout(i,1e3));const t=$a[s];if(!t)throw new Error("User not found or access denied");const a=ms[t.tenantId];if(!a||a.status!=="active")throw new Error("Tenant not active or not found");const n={tenantId:t.tenantId,userId:t.id,email:t.email,name:t.name,roles:t.roles,iat:Math.floor(Date.now()/1e3),exp:Math.floor(Date.now()/1e3)+3600,aud:"api://your-saas",iss:"https://your-tenant.b2clogin.com/your-tenant.onmicrosoft.com/v2.0/"};return this.currentToken=n,localStorage.setItem("auth_token",JSON.stringify(n)),localStorage.setItem("current_user",JSON.stringify(t)),localStorage.setItem("current_tenant",JSON.stringify(a)),{token:n,user:t,tenant:a}}isAuthenticated(){try{const s=this.getCurrentToken();return s?s.exp>Math.floor(Date.now()/1e3):!1}catch(s){return console.error("Error checking authentication:",s),!1}}getCurrentToken(){if(this.currentToken&&this.currentToken.exp>Math.floor(Date.now()/1e3))return this.currentToken;const s=localStorage.getItem("auth_token");if(s)try{const t=JSON.parse(s);if(t.exp>Math.floor(Date.now()/1e3))return this.currentToken=t,t}catch{}return null}getCurrentUser(){const s=localStorage.getItem("current_user");if(s)try{return JSON.parse(s)}catch{return null}return null}getCurrentTenant(){const s=localStorage.getItem("current_tenant");if(s)try{return JSON.parse(s)}catch{return null}return null}async switchTenant(s){if(!this.getCurrentUser())throw new Error("Not authenticated");const a=ms[s];if(!a)throw new Error("Tenant not found");localStorage.setItem("current_tenant",JSON.stringify(a));const n=this.getCurrentToken();return n&&(n.tenantId=s,this.currentToken=n,localStorage.setItem("auth_token",JSON.stringify(n))),a}async logout(){this.currentToken=null,localStorage.removeItem("auth_token"),localStorage.removeItem("current_user"),localStorage.removeItem("current_tenant")}hasRole(s){const t=this.getCurrentUser();return(t==null?void 0:t.roles.includes(s))||!1}hasPermission(s,t){const a=this.getCurrentUser();return a?a.roles.includes("PlatformOwner")||a.roles.includes("TenantOwner")?!0:a.roles.includes("Auditor")||a.roles.includes("ComplianceOfficer")?t==="read":a.roles.includes("AgentUser")?t==="read"||s.includes("agent")&&t==="execute":!1:!1}async getAvailableTenants(){const s=this.getCurrentUser();return s?s.roles.includes("PlatformOwner")?Object.values(ms):Object.values(ms).filter(t=>t.id===s.tenantId):[]}};ee(_e,"instance");let Os=_e;const be=Os.getInstance();let Cs=null;const oe=Rt()(Pt((r,s)=>({isAuthenticated:!1,isLoading:!1,isInitialized:!1,token:null,user:null,tenant:null,availableTenants:[],error:null,login:async t=>{console.log("Auth store: Starting login process for",t),r({isLoading:!0,error:null});try{const{token:a,user:n,tenant:i}=await be.login(t),o=await be.getAvailableTenants();console.log("Auth store: Login successful",{user:n.name,tenant:i.name}),r({isAuthenticated:!0,isLoading:!1,isInitialized:!0,token:a,user:n,tenant:i,availableTenants:o,error:null})}catch(a){console.error("Auth store: Login failed",a),r({isAuthenticated:!1,isLoading:!1,token:null,user:null,tenant:null,error:a instanceof Error?a.message:"Login failed"})}},logout:async()=>{r({isLoading:!0});try{await be.logout(),r({isAuthenticated:!1,isLoading:!1,isInitialized:!1,token:null,user:null,tenant:null,availableTenants:[],error:null})}catch(t){r({isLoading:!1,error:t instanceof Error?t.message:"Logout failed"})}},switchTenant:async t=>{r({isLoading:!0,error:null});try{const a=await be.switchTenant(t);r({tenant:a,isLoading:!1,error:null})}catch(a){r({isLoading:!1,error:a instanceof Error?a.message:"Failed to switch tenant"})}},initializeAuth:()=>{if(!s().isInitialized){console.log("Auth store: Initializing authentication state");try{const a=be.isAuthenticated(),n=be.getCurrentToken(),i=be.getCurrentUser(),o=be.getCurrentTenant();console.log("Auth store: Initial auth check results",{isAuth:a,hasToken:!!n,hasUser:!!i,hasTenant:!!o}),a&&n&&i&&o?(console.log("Auth store: Restoring authenticated state on init",{user:i.name,tenant:o.name}),r({isAuthenticated:!0,isInitialized:!0,token:n,user:i,tenant:o,availableTenants:[o],error:null})):(console.log("Auth store: No valid authentication found on init"),r({isAuthenticated:!1,isInitialized:!0,token:null,user:null,tenant:null,availableTenants:[],error:null}))}catch(a){console.error("Auth store: Error during initialization",a),r({isAuthenticated:!1,isInitialized:!0,token:null,user:null,tenant:null,availableTenants:[],error:a instanceof Error?a.message:"Authentication initialization failed"})}}},refreshAuth:async()=>{if(s().isLoading){console.log("Auth store: Refresh already in progress, skipping");return}return Cs&&clearTimeout(Cs),new Promise(a=>{Cs=setTimeout(async()=>{console.log("Auth store: Refreshing authentication state"),r({isLoading:!0});try{const n=be.isAuthenticated(),i=be.getCurrentToken(),o=be.getCurrentUser(),m=be.getCurrentTenant();if(console.log("Auth store: Auth check results",{isAuth:n,hasToken:!!i,hasUser:!!o,hasTenant:!!m}),n&&i&&o&&m){const l=await be.getAvailableTenants();console.log("Auth store: Restoring authenticated state",{user:o.name,tenant:m.name}),r({isAuthenticated:!0,isLoading:!1,isInitialized:!0,token:i,user:o,tenant:m,availableTenants:l,error:null})}else console.log("Auth store: No valid authentication found"),r({isAuthenticated:!1,isLoading:!1,isInitialized:!0,token:null,user:null,tenant:null,availableTenants:[],error:null})}catch(n){console.error("Auth store: Error during refresh",n),r({isAuthenticated:!1,isLoading:!1,isInitialized:!0,token:null,user:null,tenant:null,availableTenants:[],error:n instanceof Error?n.message:"Authentication refresh failed"})}a()},300)})},clearError:()=>r({error:null})})));oe.subscribe(r=>r.isAuthenticated,r=>{r||console.log("User logged out, clearing cached data")});const za=r=>[{tenantId:r,agentId:"agent-grc-analyzer",name:"GRC Risk Analyzer",description:"AI agent for analyzing governance, risk, and compliance data",enabledTools:["archer-connector","risk-calculator","compliance-checker"],llmConfig:{provider:"azure-openai",model:"gpt-4",temperature:.3,maxTokens:2e3},auditLevel:"enhanced",rateLimits:{requestsPerMinute:60,tokensPerHour:5e4,dailyBudget:100},isActive:!0,createdAt:"2024-07-15T10:00:00Z",updatedAt:"2024-08-19T09:00:00Z"},{tenantId:r,agentId:"agent-compliance-monitor",name:"Compliance Monitor",description:"Continuous monitoring of compliance requirements and controls",enabledTools:["archer-connector","compliance-checker","audit-trail"],llmConfig:{provider:"azure-openai",model:"gpt-3.5-turbo",temperature:.2,maxTokens:1500},auditLevel:"full",rateLimits:{requestsPerMinute:30,tokensPerHour:25e3,dailyBudget:50},isActive:!0,createdAt:"2024-08-01T14:30:00Z",updatedAt:"2024-08-19T08:30:00Z"},{tenantId:r,agentId:"agent-risk-reporter",name:"Risk Reporter",description:"Generates risk assessment reports and insights",enabledTools:["risk-calculator","report-generator"],llmConfig:{provider:"azure-openai",model:"gpt-4",temperature:.1,maxTokens:3e3},auditLevel:"basic",rateLimits:{requestsPerMinute:20,tokensPerHour:3e4,dailyBudget:75},isActive:!1,createdAt:"2024-06-20T11:15:00Z",updatedAt:"2024-08-10T16:20:00Z"}],Ga=r=>({totalAgents:3,activeAgents:2,healthyAgents:2,todayQueries:47,weeklyGrowth:12.5,averageResponseTime:850,tokenUsage:{current:245e3,limit:1e6,percentage:24.5},apiCalls:{current:2847,limit:1e4,percentage:28.47},riskScore:7.2,complianceScore:94.8,criticalFindings:3,openRisks:12}),qa=r=>[{id:"query-001",tenantId:r,agentId:"agent-grc-analyzer",query:"What are the current high-risk findings in our ISO 27001 assessment?",response:{content:"I found 3 high-risk findings in your current ISO 27001 assessment: 1) Inadequate access control reviews (A.9.2.5), 2) Missing encryption for data in transit (A.10.1.1), 3) Incomplete incident response documentation (A.16.1.2). Each requires immediate attention to maintain compliance.",confidence:.92,toolsUsed:["archer-connector","compliance-checker"],evidence:[{source:"Archer GRC Platform",excerpt:"Control A.9.2.5: Last review completed 14 months ago",relevanceScore:.95,metadata:{controlId:"A.9.2.5",lastReview:"2023-06-15"}}],complianceFlags:[{framework:"ISO27001",rule:"A.9.2.5",severity:"critical",description:"Access control review exceeds maximum allowed interval"}],tokenUsage:{promptTokens:150,completionTokens:280,totalTokens:430,cost:.0086}},status:"completed",timestamp:"2024-08-19T09:15:00Z",userId:"user-001"},{id:"query-002",tenantId:r,agentId:"agent-compliance-monitor",query:"Generate a summary of this quarter's compliance posture",status:"processing",timestamp:"2024-08-19T09:45:00Z",userId:"user-002"}],ls=Rt()(Pt((r,s)=>({activeView:"executive",sidebarCollapsed:!1,agents:[],agentHealth:{},recentQueries:[],riskAssessments:[],complianceReports:[],recentAuditEvents:[],metrics:{totalAgents:0,activeAgents:0,healthyAgents:0,todayQueries:0,weeklyGrowth:0,averageResponseTime:0,tokenUsage:{current:0,limit:0,percentage:0},apiCalls:{current:0,limit:0,percentage:0},riskScore:0,complianceScore:0,criticalFindings:0,openRisks:0},isLoadingMetrics:!1,setActiveView:t=>r({activeView:t}),toggleSidebar:()=>r(t=>({sidebarCollapsed:!t.sidebarCollapsed})),loadDashboardData:async t=>{r({isLoadingMetrics:!0});try{await new Promise(m=>setTimeout(m,1e3));const a=za(t),n=Ga(t),i=qa(t),o={};a.forEach(m=>{o[m.agentId]={status:m.isActive?"healthy":"unhealthy",lastCheck:new Date().toISOString(),responseTime:Math.floor(Math.random()*2e3)+200,errorCount:Math.floor(Math.random()*5),uptime:Math.random()*.1+.9}}),r({agents:a,agentHealth:o,recentQueries:i,metrics:n,isLoadingMetrics:!1})}catch(a){console.error("Failed to load dashboard data:",a),r({isLoadingMetrics:!1})}},refreshMetrics:async t=>{const a=s().metrics;try{await new Promise(i=>setTimeout(i,500));const n={...a,todayQueries:a.todayQueries+Math.floor(Math.random()*3),averageResponseTime:a.averageResponseTime+(Math.random()-.5)*100,tokenUsage:{...a.tokenUsage,current:Math.min(a.tokenUsage.current+Math.floor(Math.random()*1e3),a.tokenUsage.limit)}};n.tokenUsage.percentage=n.tokenUsage.current/n.tokenUsage.limit*100,r({metrics:n})}catch(n){console.error("Failed to refresh metrics:",n)}},updateAgentHealth:(t,a)=>{r(n=>({agentHealth:{...n.agentHealth,[t]:a}}))}}))),ot={variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},M=g.forwardRef(({className:r,variant:s="default",size:t="default",...a},n)=>e.jsx("button",{className:q("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",ot.variant[s],ot.size[t],r),ref:n,...a}));M.displayName="Button";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ka={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ha=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),R=(r,s)=>{const t=g.forwardRef(({color:a="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:m="",children:l,...h},c)=>g.createElement("svg",{ref:c,...Ka,width:n,height:n,stroke:a,strokeWidth:o?Number(i)*24/Number(n):i,className:["lucide",`lucide-${Ha(r)}`,m].join(" "),...h},[...s.map(([u,p])=>g.createElement(u,p)),...Array.isArray(l)?l:[l]]));return t.displayName=`${r}`,t};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=R("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=R("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=R("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=R("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=R("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ba=R("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=R("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=R("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=R("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=R("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=R("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=R("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=R("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=R("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=R("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wa=R("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ja=R("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=R("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=R("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=R("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=R("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=R("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=R("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=R("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=R("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=R("Factory",[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=R("FileCheck",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=R("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xa=R("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=R("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=R("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=R("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=R("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Za=R("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=R("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=R("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=R("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=R("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=R("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=R("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=R("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=R("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=R("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=R("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=R("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=R("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=R("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=R("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=R("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=R("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=R("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=R("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=R("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=R("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=R("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=R("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=R("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=R("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=R("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=R("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nn=R("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=R("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=R("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=R("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=R("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rn=R("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=R("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=R("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),on=()=>{const{user:r,tenant:s}=oe(),{sidebarCollapsed:t,toggleSidebar:a}=ls(),n=ea();if(!r||!s)return null;const o=[{title:"Overview",items:[{href:"/dashboard",icon:e.jsx(Za,{className:"h-5 w-5"}),label:"Dashboard",roles:["TenantOwner","AgentUser","Auditor","ComplianceOfficer"]}]},{title:"AI & Automation",items:[{href:"/agents",icon:e.jsx(Se,{className:"h-5 w-5"}),label:"AI Agents",roles:["TenantOwner","AgentUser"]},{href:"/chat",icon:e.jsx(fs,{className:"h-5 w-5"}),label:"GRC Chat",roles:["TenantOwner","AgentUser"]},{href:"/ai-insights",icon:e.jsx(me,{className:"h-5 w-5"}),label:"AI Insights",roles:["TenantOwner","AgentUser","ComplianceOfficer"],badge:"New"}]},{title:"Configuration",items:[{href:"/connections",icon:e.jsx(Bs,{className:"h-5 w-5"}),label:"Connections",roles:["TenantOwner"]},{href:"/settings",icon:e.jsx(de,{className:"h-5 w-5"}),label:"Settings",roles:["TenantOwner"]}]},{title:"Administration",items:[{href:"/users",icon:e.jsx(Ye,{className:"h-5 w-5"}),label:"User Management",roles:["TenantOwner"]},{href:"/audit",icon:e.jsx(cs,{className:"h-5 w-5"}),label:"Audit Trail",roles:["TenantOwner","Auditor","ComplianceOfficer"]}]}].map(l=>({...l,items:l.items.filter(h=>h.roles.some(c=>r.roles.includes(c)))})).filter(l=>l.items.length>0),m=l=>l==="/dashboard"?n.pathname==="/dashboard"||n.pathname==="/":n.pathname.startsWith(l);return e.jsxs("div",{className:q("fixed left-0 top-0 z-50 h-full bg-card border-r transition-all duration-300 flex flex-col",t?"w-16":"w-64"),children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[!t&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"GRC Platform"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.name})]})]}),e.jsx(M,{variant:"ghost",size:"icon",onClick:a,className:"shrink-0",children:t?e.jsx(Ja,{className:"h-4 w-4"}):e.jsx(Wa,{className:"h-4 w-4"})})]})}),t&&e.jsx("div",{className:"p-2 border-b",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(re,{className:"h-8 w-8 text-primary"})})}),e.jsx("nav",{className:"flex-1 p-4 overflow-y-auto",children:o.map(l=>e.jsxs("div",{className:"mb-6 last:mb-0",children:[!t&&e.jsx("h3",{className:"mb-2 px-3 text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:l.title}),e.jsx("div",{className:"space-y-1",children:l.items.map(h=>e.jsxs(sa,{to:h.href,className:({isActive:c})=>q("flex items-center space-x-3 px-3 py-2 rounded-md text-sm font-medium transition-colors",m(h.href)||c?"bg-primary text-primary-foreground":"text-foreground hover:bg-accent hover:text-accent-foreground",t&&"justify-center px-2"),title:t?h.label:void 0,children:[h.icon,!t&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flex-1",children:h.label}),h.badge&&e.jsx("span",{className:"bg-primary/20 text-primary text-xs px-2 py-0.5 rounded-full",children:h.badge})]})]},h.href))})]},l.title))})]})},ln=()=>{const r=ta(),{user:s,tenant:t,availableTenants:a,switchTenant:n,logout:i}=oe(),{refreshMetrics:o}=ls(),[m,l]=g.useState(!1),[h,c]=g.useState(!1),[u,p]=g.useState(document.documentElement.classList.contains("dark"));if(!s||!t)return null;const y=async w=>{w!==t.id&&await n(w),c(!1)},S=()=>{const w=!u;p(w),document.documentElement.classList.toggle("dark",w),localStorage.setItem("theme",w?"dark":"light")},f=()=>{o(t.id)},b=async()=>{l(!1);try{await i(),r("/login",{replace:!0})}catch(w){console.error("Logout failed:",w),r("/login",{replace:!0})}},j=w=>{switch(w){case"active":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"suspended":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";case"provisioning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}};return e.jsxs("header",{className:"h-16 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-40",children:[e.jsxs("div",{className:"flex h-full items-center px-6",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(qt,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search agents, tools, or ask GRC questions...",className:"w-full bg-muted/50 border-0 pl-10 pr-4 py-2 text-sm rounded-md focus:outline-none focus:ring-2 focus:ring-ring"})]})}),e.jsxs("div",{className:"flex items-center space-x-4 ml-6",children:[e.jsx(M,{variant:"ghost",size:"icon",onClick:f,title:"Refresh dashboard data",children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx(M,{variant:"ghost",size:"icon",onClick:S,title:"Toggle theme",children:u?e.jsx(an,{className:"h-4 w-4"}):e.jsx(en,{className:"h-4 w-4"})}),e.jsxs(M,{variant:"ghost",size:"icon",className:"relative",children:[e.jsx(Ba,{className:"h-4 w-4"}),e.jsx("span",{className:"absolute -top-1 -right-1 h-3 w-3 bg-red-500 rounded-full text-[10px] text-white flex items-center justify-center",children:"3"})]}),e.jsxs("div",{className:"relative",children:[s.roles.includes("PlatformOwner")||a.length>1?e.jsxs(M,{variant:"outline",className:"flex items-center space-x-2",onClick:()=>c(!h),children:[e.jsx(lt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline max-w-32 truncate",children:t.name}),e.jsx("span",{className:q("px-2 py-0.5 rounded-full text-xs font-medium",j(t.status)),children:t.status}),e.jsx(ct,{className:"h-4 w-4"})]}):e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 border rounded-md bg-muted/20",children:[e.jsx(lt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline max-w-32 truncate",children:t.name}),e.jsx("span",{className:q("px-2 py-0.5 rounded-full text-xs font-medium",j(t.status)),children:t.status})]}),h&&(s.roles.includes("PlatformOwner")||a.length>1)&&e.jsxs("div",{className:"absolute right-0 top-12 w-72 bg-popover border rounded-md shadow-lg z-50",children:[e.jsxs("div",{className:"p-3 border-b",children:[e.jsx("h3",{className:"font-medium",children:"Switch Tenant"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a different tenant environment"})]}),e.jsx("div",{className:"py-2",children:a.map(w=>e.jsxs("button",{className:q("w-full px-3 py-2 text-left hover:bg-accent hover:text-accent-foreground flex items-center justify-between",w.id===t.id&&"bg-accent text-accent-foreground"),onClick:()=>y(w.id),children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:w.name}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[w.subscriptionTier,"  ",w.region]})]}),e.jsx("span",{className:q("px-2 py-0.5 rounded-full text-xs font-medium",j(w.status)),children:w.status})]},w.id))})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(M,{variant:"ghost",className:"flex items-center space-x-2",onClick:()=>l(!m),children:[e.jsx("div",{className:"h-8 w-8 bg-primary rounded-full flex items-center justify-center text-primary-foreground text-sm font-medium",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"hidden sm:block text-left",children:[e.jsx("div",{className:"text-sm font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.roles[0]})]}),e.jsx(ct,{className:"h-4 w-4"})]}),m&&e.jsxs("div",{className:"absolute right-0 top-12 w-56 bg-popover border rounded-md shadow-lg z-50",children:[e.jsxs("div",{className:"p-3 border-b",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.roles.map(w=>e.jsx("span",{className:"px-2 py-0.5 bg-secondary text-secondary-foreground rounded-full text-xs",children:w},w))})]}),e.jsxs("div",{className:"py-2",children:[e.jsxs("button",{className:"w-full px-3 py-2 text-left hover:bg-accent hover:text-accent-foreground flex items-center space-x-2",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{children:"Settings"})]}),e.jsxs("button",{className:"w-full px-3 py-2 text-left hover:bg-accent hover:text-accent-foreground flex items-center space-x-2 text-destructive hover:text-destructive",onClick:b,children:[e.jsx(Qa,{className:"h-4 w-4"}),e.jsx("span",{children:"Sign out"})]})]})]})]})]})]}),(m||h)&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>{l(!1),c(!1)}})]})},cn=()=>{const{isAuthenticated:r,isLoading:s,isInitialized:t,user:a,tenant:n}=oe(),{loadDashboardData:i,sidebarCollapsed:o}=ls();return g.useEffect(()=>{n&&r&&i(n.id)},[n==null?void 0:n.id,r,i]),t?!r||!a||!n?(console.log("DashboardLayout: Redirecting to login - not authenticated"),e.jsx(We,{to:"/login",replace:!0})):s?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(ce,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading dashboard..."})]})}):e.jsxs("div",{className:"flex h-screen bg-background",children:[e.jsx(on,{}),e.jsxs("div",{className:`flex-1 flex flex-col transition-all duration-300 ${o?"ml-16":"ml-64"}`,children:[e.jsx(ln,{}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-muted/50",children:e.jsx("div",{className:"mx-auto max-w-7xl",children:e.jsx(aa,{})})})]})]}):e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(ce,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Initializing..."})]})})},P=g.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:q("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s}));P.displayName="Card";const F=g.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:q("flex flex-col space-y-1.5 p-6",r),...s}));F.displayName="CardHeader";const $=g.forwardRef(({className:r,...s},t)=>e.jsx("h3",{ref:t,className:q("text-2xl font-semibold leading-none tracking-tight",r),...s}));$.displayName="CardTitle";const Fs=g.forwardRef(({className:r,...s},t)=>e.jsx("p",{ref:t,className:q("text-sm text-muted-foreground",r),...s}));Fs.displayName="CardDescription";const O=g.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:q("p-6 pt-0",r),...s}));O.displayName="CardContent";const dn=g.forwardRef(({className:r,...s},t)=>e.jsx("div",{ref:t,className:q("flex items-center p-6 pt-0",r),...s}));dn.displayName="CardFooter";const mn=()=>{const{login:r,isAuthenticated:s,isLoading:t,error:a,clearError:n}=oe(),[i,o]=g.useState(""),m=[{email:"admin@platform.com",name:"Alex Rodriguez",role:"Platform Owner",tenant:"SaaS Platform Admin",description:"Master admin with cross-tenant access and full platform management capabilities"},{email:"user1@acme.com",name:"Sarah Chen",role:"Tenant Owner",tenant:"ACME Corporation",description:"Full administrative access to ACME tenant with all MCP tools enabled"},{email:"analyst@acme.com",name:"Mike Johnson",role:"Agent User",tenant:"ACME Corporation",description:"Operational dashboard access with ability to manage and run AI agents"},{email:"audit@acme.com",name:"Lisa Wang",role:"Auditor & Compliance Officer",tenant:"ACME Corporation",description:"Read-only access to audit trails, compliance reports, and risk assessments"},{email:"owner@fintech.com",name:"David Smith",role:"Tenant Owner",tenant:"FinTech Solutions Ltd",description:"Full access to FinTech tenant with limited MCP tools (no BYO LLM)"}];if(g.useEffect(()=>{n()},[n]),s)return e.jsx(We,{to:"/dashboard",replace:!0});const l=async()=>{i&&(console.log("Attempting login with user:",i),await r(i))};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted/30",children:e.jsx("div",{className:"w-full max-w-2xl p-6",children:e.jsxs(P,{children:[e.jsxs(F,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(re,{className:"h-12 w-12 text-primary"})}),e.jsx($,{className:"text-2xl",children:"GRC Multi-Tenant Platform"}),e.jsx("p",{className:"text-muted-foreground",children:"AI-powered Governance, Risk & Compliance dashboard with MCP server integration"})]}),e.jsxs(O,{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(re,{className:"h-4 w-4 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Azure AD B2C Authentication"}),e.jsx("p",{className:"text-blue-700 dark:text-blue-300 mt-1",children:"In production, this would redirect to your Azure B2C tenant for secure authentication with MFA support."})]})]})}),a&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-950/30 border border-red-200 dark:border-red-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ue,{className:"h-4 w-4 text-red-600"}),e.jsx("p",{className:"text-red-900 dark:text-red-100 font-medium",children:"Authentication Error"})]}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mt-1 text-sm",children:a})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Select Demo User"}),e.jsx("div",{className:"space-y-3",children:m.map(h=>e.jsx("div",{className:q("p-4 border rounded-lg cursor-pointer transition-colors",i===h.email?"border-primary bg-primary/5":"hover:bg-muted/50"),onClick:()=>o(h.email),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-10 w-10 bg-primary rounded-full flex items-center justify-center text-primary-foreground font-semibold",children:h.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:h.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h.email})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsx("span",{className:"px-2 py-1 bg-secondary text-secondary-foreground rounded",children:h.role}),e.jsx("span",{className:"text-muted-foreground",children:h.tenant})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:h.description})]})]}),e.jsx("div",{className:"ml-4",children:e.jsx("div",{className:q("w-4 h-4 rounded-full border-2 transition-colors",i===h.email?"border-primary bg-primary":"border-muted-foreground"),children:i===h.email&&e.jsx("div",{className:"w-2 h-2 bg-primary-foreground rounded-full m-0.5"})})})]})},h.email))})]}),e.jsx(M,{onClick:l,disabled:!i||t,className:"w-full",size:"lg",children:t?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 mr-2 animate-spin"}),"Authenticating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Sign in with Azure AD B2C"]})}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground space-y-2",children:[e.jsx("p",{children:"This demo showcases a multi-tenant SaaS platform with:"}),e.jsxs("ul",{className:"text-xs space-y-1",children:[e.jsx("li",{children:" Tenant-isolated AI agents with configurable MCP tools"}),e.jsx("li",{children:" Role-based access control (Platform Owner, Tenant Owner, Agent User, Auditor)"}),e.jsx("li",{children:" Azure AD B2C integration with tenant context and cross-tenant management"}),e.jsx("li",{children:" Platform-compliant audit logging and compliance reporting"}),e.jsx("li",{children:" Real-time GRC data visualization and risk assessment"})]})]})]})]})})})},un=()=>{const{metrics:r}=ls(),{tenant:s}=oe(),t=[{month:"Jan",high:12,medium:25,low:8},{month:"Feb",high:10,medium:28,low:6},{month:"Mar",high:8,medium:22,low:4},{month:"Apr",high:6,medium:20,low:3},{month:"May",high:9,medium:24,low:5},{month:"Jun",high:7,medium:18,low:2}],a=[{framework:"ISO 27001",score:94.8,color:"#22c55e"},{framework:"CPS 230",score:89.2,color:"#3b82f6"},{framework:"SOC 2",score:96.5,color:"#8b5cf6"},{framework:"GDPR",score:91.7,color:"#f59e0b"}],n=[{category:"AI Agents",amount:1240,budget:2e3},{category:"MCP Tools",amount:890,budget:1500},{category:"Storage",amount:450,budget:800},{category:"Audit",amount:320,budget:500}];return s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Executive Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Strategic overview of your GRC platform performance and risk posture"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Risk Score"}),e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(O,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[r.riskScore.toFixed(1),"/10"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx(Kt,{className:"inline h-3 w-3 mr-1"}),"Decreased by 0.8 this month"]})]})]}),e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Compliance Score"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(O,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[r.complianceScore.toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx(es,{className:"inline h-3 w-3 mr-1"}),"Improved by 2.3% this month"]})]})]}),e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Active Agents"}),e.jsx(De,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(O,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[r.activeAgents,"/",r.totalAgents]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.healthyAgents," healthy, monitoring 24/7"]})]})]}),e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Monthly Cost"}),e.jsx(Ya,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(O,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",n.reduce((i,o)=>i+o.amount,0).toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",(n.reduce((i,o)=>i+o.budget,0)-n.reduce((i,o)=>i+o.amount,0)).toLocaleString()," under budget"]})]})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(P,{children:[e.jsx(F,{children:e.jsx($,{children:"Risk Trend Analysis"})}),e.jsxs(O,{children:[e.jsx("div",{className:"h-80",children:e.jsx(Ts,{width:"100%",height:"100%",children:e.jsxs(Ct,{data:t,children:[e.jsx(Es,{strokeDasharray:"3 3"}),e.jsx(Ms,{dataKey:"month"}),e.jsx(Rs,{}),e.jsx(is,{type:"monotone",dataKey:"high",stackId:"1",stroke:"#ef4444",fill:"#ef4444",fillOpacity:.8}),e.jsx(is,{type:"monotone",dataKey:"medium",stackId:"1",stroke:"#f59e0b",fill:"#f59e0b",fillOpacity:.8}),e.jsx(is,{type:"monotone",dataKey:"low",stackId:"1",stroke:"#10b981",fill:"#10b981",fillOpacity:.8})]})})}),e.jsxs("div",{className:"flex justify-center space-x-6 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{children:"High Risk"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),e.jsx("span",{children:"Medium Risk"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{children:"Low Risk"})]})]})]})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsx($,{children:"Cost Analysis"})}),e.jsx(O,{children:e.jsx("div",{className:"h-80",children:e.jsx(Ts,{width:"100%",height:"100%",children:e.jsxs(oa,{data:n,children:[e.jsx(Es,{strokeDasharray:"3 3"}),e.jsx(Ms,{dataKey:"category"}),e.jsx(Rs,{}),e.jsx(at,{dataKey:"amount",fill:"#3b82f6",name:"Actual"}),e.jsx(at,{dataKey:"budget",fill:"#e5e7eb",name:"Budget"})]})})})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"h-5 w-5 text-red-500"}),e.jsx("span",{children:"Critical Findings"})]})}),e.jsxs(O,{children:[e.jsx("div",{className:"text-3xl font-bold text-red-600 mb-4",children:r.criticalFindings}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Encryption gaps"}),e.jsx("span",{className:"text-sm font-medium text-red-600",children:"2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Access control"}),e.jsx("span",{className:"text-sm font-medium text-red-600",children:"1"})]})]}),e.jsx(M,{variant:"outline",className:"w-full mt-4",size:"sm",children:"View All Findings"})]})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(Ie,{className:"h-5 w-5 text-yellow-500"}),e.jsx("span",{children:"Open Risks"})]})}),e.jsxs(O,{children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-600 mb-4",children:r.openRisks}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"High priority"}),e.jsx("span",{className:"text-sm font-medium text-red-600",children:"3"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Medium priority"}),e.jsx("span",{className:"text-sm font-medium text-yellow-600",children:"5"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low priority"}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:"4"})]})]}),e.jsx(M,{variant:"outline",className:"w-full mt-4",size:"sm",children:"Review Risks"})]})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{children:"Compliance Overview"})]})}),e.jsxs(O,{children:[e.jsx("div",{className:"space-y-3",children:a.map(i=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:i.framework}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:i.color},children:[i.score,"%"]}),e.jsx("div",{className:"w-16 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full",style:{width:`${i.score}%`,backgroundColor:i.color}})})]})]},i.framework))}),e.jsx(M,{variant:"outline",className:"w-full mt-4",size:"sm",children:"Detailed Report"})]})]})]})]}):null};function $s(r){"@babel/helpers - typeof";return $s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},$s(r)}function we(r,s){if(s.length<r)throw new TypeError(r+" argument"+(r>1?"s":"")+" required, but only "+s.length+" present")}function ge(r){we(1,arguments);var s=Object.prototype.toString.call(r);return r instanceof Date||$s(r)==="object"&&s==="[object Date]"?new Date(r.getTime()):typeof r=="number"||s==="[object Number]"?new Date(r):((typeof r=="string"||s==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}var hn={};function xn(){return hn}function ht(r){var s=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return s.setUTCFullYear(r.getFullYear()),r.getTime()-s.getTime()}function ps(r,s){we(2,arguments);var t=ge(r),a=ge(s),n=t.getTime()-a.getTime();return n<0?-1:n>0?1:n}function pn(r,s){we(2,arguments);var t=ge(r),a=ge(s),n=t.getFullYear()-a.getFullYear(),i=t.getMonth()-a.getMonth();return n*12+i}function gn(r,s){return we(2,arguments),ge(r).getTime()-ge(s).getTime()}var xt={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(s){return s<0?Math.ceil(s):Math.floor(s)}},fn="trunc";function yn(r){return r?xt[r]:xt[fn]}function vn(r){we(1,arguments);var s=ge(r);return s.setHours(23,59,59,999),s}function jn(r){we(1,arguments);var s=ge(r),t=s.getMonth();return s.setFullYear(s.getFullYear(),t+1,0),s.setHours(23,59,59,999),s}function bn(r){we(1,arguments);var s=ge(r);return vn(s).getTime()===jn(s).getTime()}function Nn(r,s){we(2,arguments);var t=ge(r),a=ge(s),n=ps(t,a),i=Math.abs(pn(t,a)),o;if(i<1)o=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-n*i);var m=ps(t,a)===-n;bn(ge(r))&&i===1&&ps(r,a)===1&&(m=!1),o=n*(i-Number(m))}return o===0?0:o}function wn(r,s,t){we(2,arguments);var a=gn(r,s)/1e3;return yn(t==null?void 0:t.roundingMethod)(a)}var Sn={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Cn=function(s,t,a){var n,i=Sn[s];return typeof i=="string"?n=i:t===1?n=i.one:n=i.other.replace("{{count}}",t.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+n:n+" ago":n};const kn=Cn;function ks(r){return function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=s.width?String(s.width):r.defaultWidth,a=r.formats[t]||r.formats[r.defaultWidth];return a}}var An={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},In={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Tn={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},En={date:ks({formats:An,defaultWidth:"full"}),time:ks({formats:In,defaultWidth:"full"}),dateTime:ks({formats:Tn,defaultWidth:"full"})};const Mn=En;var Rn={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Pn=function(s,t,a,n){return Rn[s]};const Dn=Pn;function as(r){return function(s,t){var a=t!=null&&t.context?String(t.context):"standalone",n;if(a==="formatting"&&r.formattingValues){var i=r.defaultFormattingWidth||r.defaultWidth,o=t!=null&&t.width?String(t.width):i;n=r.formattingValues[o]||r.formattingValues[i]}else{var m=r.defaultWidth,l=t!=null&&t.width?String(t.width):r.defaultWidth;n=r.values[l]||r.values[m]}var h=r.argumentCallback?r.argumentCallback(s):s;return n[h]}}var On={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Ln={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},_n={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Un={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Fn={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},$n={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},zn=function(s,t){var a=Number(s),n=a%100;if(n>20||n<10)switch(n%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},Gn={ordinalNumber:zn,era:as({values:On,defaultWidth:"wide"}),quarter:as({values:Ln,defaultWidth:"wide",argumentCallback:function(s){return s-1}}),month:as({values:_n,defaultWidth:"wide"}),day:as({values:Un,defaultWidth:"wide"}),dayPeriod:as({values:Fn,defaultWidth:"wide",formattingValues:$n,defaultFormattingWidth:"wide"})};const qn=Gn;function ns(r){return function(s){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=t.width,n=a&&r.matchPatterns[a]||r.matchPatterns[r.defaultMatchWidth],i=s.match(n);if(!i)return null;var o=i[0],m=a&&r.parsePatterns[a]||r.parsePatterns[r.defaultParseWidth],l=Array.isArray(m)?Hn(m,function(u){return u.test(o)}):Kn(m,function(u){return u.test(o)}),h;h=r.valueCallback?r.valueCallback(l):l,h=t.valueCallback?t.valueCallback(h):h;var c=s.slice(o.length);return{value:h,rest:c}}}function Kn(r,s){for(var t in r)if(r.hasOwnProperty(t)&&s(r[t]))return t}function Hn(r,s){for(var t=0;t<r.length;t++)if(s(r[t]))return t}function Vn(r){return function(s){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=s.match(r.matchPattern);if(!a)return null;var n=a[0],i=s.match(r.parsePattern);if(!i)return null;var o=r.valueCallback?r.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;var m=s.slice(n.length);return{value:o,rest:m}}}var Bn=/^(\d+)(th|st|nd|rd)?/i,Wn=/\d+/i,Jn={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Yn={any:[/^b/i,/^(a|c)/i]},Xn={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Zn={any:[/1/i,/2/i,/3/i,/4/i]},Qn={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},er={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},sr={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},tr={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ar={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},nr={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},rr={ordinalNumber:Vn({matchPattern:Bn,parsePattern:Wn,valueCallback:function(s){return parseInt(s,10)}}),era:ns({matchPatterns:Jn,defaultMatchWidth:"wide",parsePatterns:Yn,defaultParseWidth:"any"}),quarter:ns({matchPatterns:Xn,defaultMatchWidth:"wide",parsePatterns:Zn,defaultParseWidth:"any",valueCallback:function(s){return s+1}}),month:ns({matchPatterns:Qn,defaultMatchWidth:"wide",parsePatterns:er,defaultParseWidth:"any"}),day:ns({matchPatterns:sr,defaultMatchWidth:"wide",parsePatterns:tr,defaultParseWidth:"any"}),dayPeriod:ns({matchPatterns:ar,defaultMatchWidth:"any",parsePatterns:nr,defaultParseWidth:"any"})};const ir=rr;var or={code:"en-US",formatDistance:kn,formatLong:Mn,formatRelative:Dn,localize:qn,match:ir,options:{weekStartsOn:0,firstWeekContainsDate:1}};const lr=or;function Vt(r,s){if(r==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(r[t]=s[t]);return r}function cr(r){return Vt({},r)}var pt=1440,dr=2520,As=43200,mr=86400;function ur(r,s,t){var a,n;we(2,arguments);var i=xn(),o=(a=(n=t==null?void 0:t.locale)!==null&&n!==void 0?n:i.locale)!==null&&a!==void 0?a:lr;if(!o.formatDistance)throw new RangeError("locale must contain formatDistance property");var m=ps(r,s);if(isNaN(m))throw new RangeError("Invalid time value");var l=Vt(cr(t),{addSuffix:!!(t!=null&&t.addSuffix),comparison:m}),h,c;m>0?(h=ge(s),c=ge(r)):(h=ge(r),c=ge(s));var u=wn(c,h),p=(ht(c)-ht(h))/1e3,y=Math.round((u-p)/60),S;if(y<2)return t!=null&&t.includeSeconds?u<5?o.formatDistance("lessThanXSeconds",5,l):u<10?o.formatDistance("lessThanXSeconds",10,l):u<20?o.formatDistance("lessThanXSeconds",20,l):u<40?o.formatDistance("halfAMinute",0,l):u<60?o.formatDistance("lessThanXMinutes",1,l):o.formatDistance("xMinutes",1,l):y===0?o.formatDistance("lessThanXMinutes",1,l):o.formatDistance("xMinutes",y,l);if(y<45)return o.formatDistance("xMinutes",y,l);if(y<90)return o.formatDistance("aboutXHours",1,l);if(y<pt){var f=Math.round(y/60);return o.formatDistance("aboutXHours",f,l)}else{if(y<dr)return o.formatDistance("xDays",1,l);if(y<As){var b=Math.round(y/pt);return o.formatDistance("xDays",b,l)}else if(y<mr)return S=Math.round(y/As),o.formatDistance("aboutXMonths",S,l)}if(S=Nn(c,h),S<12){var j=Math.round(y/As);return o.formatDistance("xMonths",j,l)}else{var w=S%12,T=Math.floor(S/12);return w<3?o.formatDistance("aboutXYears",T,l):w<9?o.formatDistance("overXYears",T,l):o.formatDistance("almostXYears",T+1,l)}}function gt(r,s){return we(1,arguments),ur(r,Date.now(),s)}const ft=()=>{const{agents:r,agentHealth:s,recentQueries:t,metrics:a}=ls(),{tenant:n}=oe(),[i,o]=g.useState(null);if(!n)return null;const m=c=>{switch(c){case"healthy":return e.jsx(Y,{className:"h-4 w-4 text-green-500"});case"degraded":return e.jsx(ue,{className:"h-4 w-4 text-yellow-500"});case"unhealthy":return e.jsx(ue,{className:"h-4 w-4 text-red-500"});default:return e.jsx(De,{className:"h-4 w-4 text-gray-500"})}},l=(c,u)=>{if(!u)return"text-gray-500";switch(c){case"healthy":return"text-green-500";case"degraded":return"text-yellow-500";case"unhealthy":return"text-red-500";default:return"text-gray-500"}},h=c=>{switch(c){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"processing":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"failed":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Operational Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage and monitor your AI agents and MCP tools"})]}),e.jsxs(M,{className:"flex items-center space-x-2",children:[e.jsx(fs,{className:"h-4 w-4"}),e.jsx("span",{children:"New GRC Query"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Active Agents"}),e.jsx(Se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.activeAgents}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.healthyAgents," healthy, ",a.totalAgents-a.activeAgents," paused"]})]})]}),e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Queries Today"}),e.jsx(fs,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.todayQueries}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",Math.floor(a.weeklyGrowth),"% from last week"]})]})]}),e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Avg Response"}),e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(O,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(a.averageResponseTime),"ms"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Within SLA targets"})]})]}),e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Token Usage"}),e.jsx(ss,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(O,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[a.tokenUsage.percentage.toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.tokenUsage.current.toLocaleString()," of ",a.tokenUsage.limit.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(Se,{className:"h-5 w-5"}),e.jsx("span",{children:"AI Agents"})]})}),e.jsx(O,{children:e.jsx("div",{className:"space-y-4",children:r.map(c=>{const u=s[c.agentId];return e.jsxs("div",{className:q("p-4 border rounded-lg cursor-pointer transition-colors",i===c.agentId?"border-primary bg-primary/5":"hover:bg-muted/50"),onClick:()=>o(i===c.agentId?null:c.agentId),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[m((u==null?void 0:u.status)||"unknown"),e.jsx("h3",{className:"font-medium",children:c.name})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(M,{size:"sm",variant:c.isActive?"destructive":"default",className:"h-7 px-2 text-xs",children:c.isActive?e.jsxs(e.Fragment,{children:[e.jsx($t,{className:"h-3 w-3 mr-1"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(zt,{className:"h-3 w-3 mr-1"}),"Start"]})}),e.jsx(M,{size:"sm",variant:"ghost",className:"h-7 px-2",children:e.jsx(de,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:q("text-sm font-medium",l((u==null?void 0:u.status)||"unknown",c.isActive)),children:c.isActive?(u==null?void 0:u.status)||"unknown":"paused"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[u==null?void 0:u.responseTime,"ms avg"]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 mb-3",children:c.description}),i===c.agentId&&e.jsxs("div",{className:"border-t pt-3 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Model:"})," ",c.llmConfig.model]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Audit Level:"})," ",c.auditLevel]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Rate Limit:"})," ",c.rateLimits.requestsPerMinute,"/min"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Uptime:"})," ",(((u==null?void 0:u.uptime)||0)*100).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:"Enabled Tools:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:c.enabledTools.map(p=>e.jsx("span",{className:"px-2 py-1 bg-secondary text-secondary-foreground rounded text-xs",children:p},p))})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Last updated ",gt(new Date(c.updatedAt))," ago"]})]})]},c.agentId)})})})]})}),e.jsxs("div",{children:[e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(De,{className:"h-5 w-5"}),e.jsx("span",{children:"Recent Queries"})]})}),e.jsxs(O,{children:[e.jsx("div",{className:"space-y-4",children:t.map(c=>{var u;return e.jsxs("div",{className:"border-b last:border-b-0 pb-3 last:pb-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:c.query}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:(u=r.find(p=>p.agentId===c.agentId))==null?void 0:u.name})]}),e.jsx("span",{className:q("px-2 py-1 rounded-full text-xs font-medium shrink-0 ml-2",h(c.status)),children:c.status})]}),c.response&&e.jsxs("div",{className:"mt-2 p-2 bg-muted rounded text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-muted-foreground mb-1",children:[e.jsxs("span",{children:["Confidence: ",Math.round(c.response.confidence*100),"%"]}),e.jsxs("span",{children:["Tokens: ",c.response.tokenUsage.totalTokens]}),e.jsxs("span",{children:["Cost: $",c.response.tokenUsage.cost.toFixed(4)]})]}),e.jsx("p",{className:"line-clamp-2",children:c.response.content})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[gt(new Date(c.timestamp))," ago"]})]},c.id)})}),e.jsx(M,{variant:"outline",className:"w-full mt-4",size:"sm",children:"View All Queries"})]})]}),e.jsxs(P,{className:"mt-4",children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"h-5 w-5"}),e.jsx("span",{children:"Resource Usage"})]})}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"API Calls"}),e.jsxs("span",{children:[a.apiCalls.current.toLocaleString()," / ",a.apiCalls.limit.toLocaleString()]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${a.apiCalls.percentage}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Tokens"}),e.jsxs("span",{children:[a.tokenUsage.current.toLocaleString()," / ",a.tokenUsage.limit.toLocaleString()]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${a.tokenUsage.percentage}%`}})})]}),e.jsxs("div",{className:"pt-2 border-t",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Monthly Budget"}),e.jsx("span",{className:"font-medium",children:"$2,940 / $4,800"})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"$1,860 remaining this month"})]})]})})]})]})]})]})},hr=()=>{const{tenant:r,user:s}=oe(),t=[{month:"Jan",events:1250,violations:12},{month:"Feb",events:1180,violations:8},{month:"Mar",events:1350,violations:15},{month:"Apr",events:1420,violations:6},{month:"May",events:1390,violations:9},{month:"Jun",events:1480,violations:4}],a=[{framework:"ISO 27001",compliant:142,total:150,color:"#22c55e"},{framework:"CPS 230",compliant:89,total:95,color:"#3b82f6"},{framework:"SOC 2",compliant:67,total:72,color:"#8b5cf6"},{framework:"GDPR",compliant:45,total:48,color:"#f59e0b"}],n=[{id:"evt-001",timestamp:"2024-08-19T09:30:00Z",action:"agent.enabled",user:"Sarah Chen",resource:"GRC Risk Analyzer",outcome:"success",riskLevel:"low"},{id:"evt-002",timestamp:"2024-08-19T09:15:00Z",action:"llm.query",user:"Mike Johnson",resource:"Compliance Monitor",outcome:"success",riskLevel:"medium"},{id:"evt-003",timestamp:"2024-08-19T08:45:00Z",action:"data.exported",user:"Lisa Wang",resource:"Compliance Report Q3",outcome:"success",riskLevel:"high"},{id:"evt-004",timestamp:"2024-08-19T08:20:00Z",action:"settings.updated",user:"Sarah Chen",resource:"MCP Tools Configuration",outcome:"warning",riskLevel:"medium"},{id:"evt-005",timestamp:"2024-08-19T07:55:00Z",action:"user.login",user:"David Smith",resource:"Dashboard",outcome:"failure",riskLevel:"high"}],i=[{id:"find-001",framework:"ISO 27001",control:"A.9.2.5",title:"Access Control Review",severity:"critical",status:"open",dueDate:"2024-08-25",assignee:"Security Team"},{id:"find-002",framework:"CPS 230",control:"CPS.230.1",title:"Operational Resilience Testing",severity:"high",status:"in-progress",dueDate:"2024-09-15",assignee:"IT Operations"},{id:"find-003",framework:"SOC 2",control:"CC6.1",title:"Logical Access Controls",severity:"medium",status:"resolved",dueDate:"2024-08-10",assignee:"Compliance Team"}];if(!r||!s)return null;const o=c=>{switch(c){case"success":return"text-green-600";case"warning":return"text-yellow-600";case"failure":return"text-red-600";default:return"text-gray-600"}},m=c=>{switch(c){case"low":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"medium":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"high":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}},l=c=>{switch(c){case"critical":return"text-red-600";case"high":return"text-orange-600";case"medium":return"text-yellow-600";case"low":return"text-green-600";default:return"text-gray-600"}},h=c=>{switch(c){case"resolved":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"in-progress":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"open":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Audit & Compliance Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Monitor compliance status, audit trails, and regulatory requirements"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(M,{variant:"outline",size:"sm",children:[e.jsx(Xa,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(M,{size:"sm",children:[e.jsx(Ot,{className:"h-4 w-4 mr-2"}),"Export Report"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Compliance Score"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:"94.8%"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"343 of 365 controls compliant"})]})]}),e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Open Findings"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:"8"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"3 critical, 5 high priority"})]})]}),e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Audit Events"}),e.jsx(De,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"1,247"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last 24 hours"})]})]}),e.jsxs(P,{children:[e.jsxs(F,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx($,{className:"text-sm font-medium",children:"Next Audit"}),e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(O,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"127"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Days until ISO 27001 audit"})]})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(P,{children:[e.jsx(F,{children:e.jsx($,{children:"Audit Event Trends"})}),e.jsxs(O,{children:[e.jsx("div",{className:"h-80",children:e.jsx(Ts,{width:"100%",height:"100%",children:e.jsxs(Ct,{data:t,children:[e.jsx(Es,{strokeDasharray:"3 3"}),e.jsx(Ms,{dataKey:"month"}),e.jsx(Rs,{}),e.jsx(is,{type:"monotone",dataKey:"events",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.3}),e.jsx(is,{type:"monotone",dataKey:"violations",stroke:"#ef4444",fill:"#ef4444",fillOpacity:.8})]})})}),e.jsxs("div",{className:"flex justify-center space-x-6 mt-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("span",{children:"Total Events"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{children:"Violations"})]})]})]})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsx($,{children:"Compliance by Framework"})}),e.jsx(O,{children:e.jsx("div",{className:"space-y-4",children:a.map(c=>{const u=c.compliant/c.total*100;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:c.framework}),e.jsxs("span",{children:[c.compliant," / ",c.total," (",u.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all",style:{width:`${u}%`,backgroundColor:c.color}})})]},c.framework)})})})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(cs,{className:"h-5 w-5"}),e.jsx("span",{children:"Recent Audit Events"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(M,{variant:"outline",size:"sm",children:[e.jsx(qt,{className:"h-4 w-4 mr-2"}),"Search"]}),e.jsxs(M,{variant:"outline",size:"sm",children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"View All"]})]})]})}),e.jsx(O,{children:e.jsx("div",{className:"space-y-3",children:n.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`text-sm font-medium ${o(c.outcome)}`,children:c.outcome.toUpperCase()}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:c.user})," performed"," ",e.jsx("span",{className:"font-mono text-xs bg-muted px-1 py-0.5 rounded",children:c.action})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["Resource: ",c.resource]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(c.timestamp).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${m(c.riskLevel)}`,children:c.riskLevel}),e.jsx(M,{variant:"ghost",size:"sm",children:e.jsx(Ge,{className:"h-4 w-4"})})]})]},c.id))})})]})}),e.jsx("div",{children:e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(X,{className:"h-5 w-5"}),e.jsx("span",{children:"Active Findings"})]})}),e.jsxs(O,{children:[e.jsx("div",{className:"space-y-4",children:i.map(c=>e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:c.framework}),e.jsx("span",{className:"text-xs font-mono bg-muted px-1 py-0.5 rounded",children:c.control})]}),e.jsx("h4",{className:"text-sm font-medium",children:c.title}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Assigned to: ",c.assignee]})]}),e.jsx(X,{className:`h-4 w-4 ${l(c.severity)}`})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${h(c.status)}`,children:c.status}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Due: ",new Date(c.dueDate).toLocaleDateString()]})]})]},c.id))}),e.jsx(M,{variant:"outline",className:"w-full mt-4",size:"sm",children:"View All Findings"})]})]})})]})]})},xr=()=>{const{user:r}=oe();if(!r)return null;switch(r.roles[0]){case"TenantOwner":return e.jsx(un,{});case"AgentUser":return e.jsx(ft,{});case"Auditor":case"ComplianceOfficer":return e.jsx(hr,{});default:return e.jsx(ft,{})}},pr={variant:{default:"bg-background text-foreground border-border",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive bg-destructive/5",warning:"border-yellow-200 text-yellow-800 dark:border-yellow-900/50 dark:text-yellow-200 bg-yellow-50 dark:bg-yellow-900/10 [&>svg]:text-yellow-600 dark:[&>svg]:text-yellow-400",success:"border-green-200 text-green-800 dark:border-green-900/50 dark:text-green-200 bg-green-50 dark:bg-green-900/10 [&>svg]:text-green-600 dark:[&>svg]:text-green-400",info:"border-blue-200 text-blue-800 dark:border-blue-900/50 dark:text-blue-200 bg-blue-50 dark:bg-blue-900/10 [&>svg]:text-blue-600 dark:[&>svg]:text-blue-400"}},gr={default:he,destructive:rn,warning:ue,success:Y,info:he},Q=g.forwardRef(({className:r,variant:s="default",title:t,children:a,dismissible:n,onDismiss:i,...o},m)=>{const l=gr[s];return e.jsxs("div",{ref:m,role:"alert",className:q("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg]:h-4 [&>svg]:w-4",pr.variant[s],r),...o,children:[e.jsx(l,{className:"h-4 w-4"}),n&&i&&e.jsxs("button",{onClick:i,className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx(Ws,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),e.jsxs("div",{className:n?"pr-8":"",children:[t&&e.jsx("h5",{className:"mb-1 font-medium leading-none tracking-tight",children:t}),e.jsx("div",{className:"text-sm [&_p]:leading-relaxed",children:a})]})]})});Q.displayName="Alert";const fr=[{id:"risk-analysis",name:"Risk Analysis",description:"Analyze and assess various types of organizational risks",category:"risk"},{id:"compliance-audit",name:"Compliance Auditing",description:"Evaluate compliance status against regulatory frameworks",category:"compliance"},{id:"control-assessment",name:"Control Assessment",description:"Assess effectiveness of organizational controls",category:"governance"},{id:"executive-reporting",name:"Executive Reporting",description:"Generate executive-level insights and dashboards",category:"reporting"},{id:"anomaly-detection",name:"Anomaly Detection",description:"Identify unusual patterns and potential issues",category:"analysis"},{id:"trend-analysis",name:"Trend Analysis",description:"Analyze trends and predict future patterns",category:"analysis"}],vs=[{id:"grc-analyst",name:"GRC Analyst",description:"Comprehensive governance, risk, and compliance analysis specialist",persona:"Professional, analytical, detail-oriented GRC expert with deep regulatory knowledge",systemPrompt:`You are a senior GRC (Governance, Risk, and Compliance) analyst with extensive experience in regulatory frameworks, risk assessment, and compliance monitoring. 

# YOUR APPROACH TO ANALYSIS

When analyzing GRC data, you produce comprehensive, professional reports that match the quality of leading enterprise GRC platforms. Your responses should provide executive-level insights while maintaining technical accuracy.

# RESPONSE STRUCTURE GUIDELINES

## For Risk Analysis Queries:
1. **Executive Summary**
   - Total risks identified with breakdown by severity
   - Key statistics (% critical, % high, trend indicators)
   - Business impact assessment
   - Top 3 immediate concerns

2. **Risk Categorization**
   - Group risks by category (Operational, Financial, Compliance, Strategic, Reputational)
   - Use visual indicators:  Critical,  High,  Medium,  Low
   - Show risk count and percentage for each category

3. **Detailed Risk Analysis**
   - For each significant risk:
     * Risk ID and Title
     * Current Risk Score (Likelihood  Impact)
     * Risk Owner and Business Unit
     * Current Control Effectiveness
     * Mitigation Status and Timeline
     * Residual Risk Assessment

4. **Risk Distribution Analysis**
   - Business Unit Risk Distribution table
   - Risk Age Analysis (new vs. aging risks)
   - Risk Velocity indicators
   - Control Coverage gaps

5. **Actionable Recommendations**
   - Prioritized action items with timelines
   - Resource requirements
   - Quick wins vs. strategic initiatives
   - Risk acceptance recommendations where appropriate

6. **Risk Maturity Assessment**
   - Current maturity level by domain
   - Benchmarking against industry standards
   - Maturity improvement roadmap

## For Compliance Queries:
1. **Compliance Dashboard**
   - Overall compliance score
   - Framework coverage (ISO27001, SOX, GDPR, etc.)
   - Non-compliance areas highlighted
   - Audit readiness status

2. **Control Assessment**
   - Control effectiveness ratings
   - Failed controls with business impact
   - Compensating controls analysis
   - Control testing schedule

3. **Regulatory Updates**
   - Recent regulatory changes impact
   - Upcoming compliance deadlines
   - Required documentation status

## For Executive Reporting:
1. **Strategic Risk Overview**
   - Board-level risk appetite alignment
   - Strategic objective impact analysis
   - Peer comparison and benchmarking

2. **Key Risk Indicators (KRIs)**
   - Trending KRIs with thresholds
   - Predictive risk analytics
   - Early warning indicators

3. **Investment Recommendations**
   - Risk mitigation ROI analysis
   - Technology investment priorities
   - Resource allocation optimization

# DATA PRESENTATION STANDARDS

- Use tables for structured data with clear headers
- Include percentages and trends () for context
- Provide both current state and historical comparison
- Use formatting to highlight critical information
- Include confidence levels for predictions
- Add data quality indicators where relevant

# PROFESSIONAL COMMUNICATION

- Lead with business impact, not technical details
- Quantify risks in monetary terms when possible
- Provide context using industry benchmarks
- Include both technical and executive summaries
- Use clear, professional language without jargon
- Support findings with specific data points
- Acknowledge data limitations transparently

# IMPORTANT REMINDERS

- Always use actual data from MCP tools, never placeholders
- If data is limited, acknowledge it and provide what's available
- Tailor depth of analysis to query complexity
- For simple queries, provide concise but complete answers
- For complex queries, deliver comprehensive analysis reports
- Include metadata (data freshness, coverage, quality indicators)`,capabilities:["risk-analysis","compliance-audit","control-assessment","executive-reporting"],useCase:"comprehensive-grc-analysis",avatar:"",color:"#2563eb"},{id:"risk-specialist",name:"Risk Specialist",description:"Focused on risk identification, assessment, and mitigation strategies",persona:"Strategic risk expert focused on identifying, quantifying, and mitigating organizational risks",systemPrompt:`You are a specialized risk management professional with expertise in enterprise risk assessment and mitigation strategies.

# YOUR SPECIALIZED RISK ANALYSIS FRAMEWORK

## Core Competencies:
- Quantitative risk modeling and Monte Carlo simulations
- Threat intelligence and emerging risk identification
- Risk correlation and concentration analysis
- Scenario planning and stress testing
- Risk appetite framework development

## Risk Analysis Methodology:

### 1. RISK IDENTIFICATION & PROFILING
**For each risk, provide:**
- **Risk ID**: Unique identifier
- **Risk Statement**: Clear description of the risk event
- **Risk Category**: 
  *  Strategic Risk
  *  Financial Risk
  *  Operational Risk
  *  Compliance Risk
  *  Technology/Cyber Risk
  *  Reputational Risk
- **Risk Source**: Internal/External/Both
- **Risk Velocity**: How quickly risk impacts manifest (Slow/Medium/Fast)

### 2. QUANTITATIVE RISK ASSESSMENT
**Provide detailed metrics:**

**Risk Scoring Matrix:**
- Inherent Risk Score: [L  I]
- Likelihood: [1-5] (X% probability)
- Impact: [1-5] ($X financial impact)
- Control Effectiveness: [%]
- Residual Risk Score: [Adjusted]
- Risk Tolerance Threshold: [Value]
- Current Status: [Within/Exceeds]

### 3. RISK INTERDEPENDENCY ANALYSIS
- **Risk Correlations**: Identify related risks
- **Cascade Effects**: Potential domino impacts
- **Concentration Areas**: Risk clustering by business unit/process
- **Systemic Risks**: Enterprise-wide vulnerabilities

### 4. CONTROL ENVIRONMENT ASSESSMENT
**For each control:**
- Control ID and Description
- Control Type: Preventive/Detective/Corrective
- Control Effectiveness Rating: 
  *  Effective (>90%)
  *  Partially Effective (60-90%)
  *  Ineffective (<60%)
- Testing Frequency and Last Test Date
- Control Gaps and Remediation Plans

### 5. RISK MITIGATION STRATEGIES
**Structured approach:**
1. **Immediate Actions** (0-30 days)
   - Quick wins and critical patches
   - Emergency response procedures
   - Temporary compensating controls

2. **Short-term Initiatives** (1-3 months)
   - Process improvements
   - Control enhancements
   - Training and awareness programs

3. **Strategic Programs** (3-12 months)
   - System implementations
   - Organizational changes
   - Policy and framework updates

### 6. RISK MONITORING FRAMEWORK
**Key Risk Indicators (KRIs):**

**KRI Dashboard:**
- KRI Name | Current | Threshold | Trend
- [Name] | [Value] | [Limit] | []

### 7. SCENARIO ANALYSIS
**For high-impact risks:**
- **Best Case**: Optimistic scenario (10% probability)
- **Most Likely**: Expected scenario (70% probability)
- **Worst Case**: Pessimistic scenario (20% probability)
- **Black Swan**: Extreme tail risk scenario

### 8. RISK REPORTING STRUCTURE
**Executive Risk Summary:**
- Top 5 Risks by Residual Score
- Risk Appetite Utilization: [X%]
- Risk Trend: [Improving/Stable/Deteriorating]
- Required Management Actions
- Board Escalation Items

## DATA VISUALIZATION STANDARDS
- Use heat maps for risk matrices
- Include trend lines for risk scores over time
- Show risk distribution across business units
- Provide risk appetite consumption gauges
- Display control effectiveness ratings

## COMMUNICATION PRINCIPLES
- Quantify risks in business terms (revenue impact, operational disruption)
- Provide probabilistic assessments with confidence intervals
- Link risks to strategic objectives
- Include industry-specific risk benchmarks
- Highlight emerging risks and future trends
- Recommend risk-adjusted decision criteria`,capabilities:["risk-analysis","anomaly-detection","trend-analysis"],useCase:"risk-management",avatar:"",color:"#dc2626"},{id:"compliance-auditor",name:"Compliance Auditor",description:"Regulatory compliance expert specializing in audit and assessment",persona:"Meticulous compliance professional with deep regulatory framework knowledge",systemPrompt:`You are a senior compliance auditor with expertise in multiple regulatory frameworks including ISO27001, CPS230, GDPR, HIPAA, and SOX.

# COMPREHENSIVE COMPLIANCE ANALYSIS FRAMEWORK

## Your Regulatory Expertise:
- **ISO Standards**: 27001/27002 (Information Security), 22301 (Business Continuity), 31000 (Risk Management)
- **Financial**: SOX, Basel III, Dodd-Frank, MiFID II
- **Privacy**: GDPR, CCPA, PIPEDA, LGPD
- **Healthcare**: HIPAA, HITECH, FDA 21 CFR Part 11
- **Industry**: PCI DSS, NIST, CIS Controls, COBIT

## COMPLIANCE ASSESSMENT METHODOLOGY

### 1. REGULATORY LANDSCAPE ANALYSIS
**Provide comprehensive framework coverage:**

**Compliance Framework Status:**

| Framework | Coverage | Score | Maturity    |
|-----------|----------|-------|-------------|
| ISO 27001 | 87%      | 4.2/5 | Managed     |
| SOX       | 92%      | 4.5/5 | Optimized   |
| GDPR      | 78%      | 3.8/5 | Defined     |
| CPS230    | 65%      | 3.2/5 | Developing  |

### 2. CONTROL TESTING & VALIDATION
**For each control assessment:**

**Control Information:**
- Control ID & Reference (e.g., ISO 27001 A.12.1.1)
- Control Objective & Description
- Control Owner & Implementation Date
- Testing Methodology Applied

**Testing Results:**

**Control Effectiveness Assessment:**
- Design Effectiveness: [Pass/Fail]
- Operating Effectiveness: [Pass/Fail]
- Sample Size Tested: [N]
- Exceptions Found: [X]
- Error Rate: [%]
- Conclusion: [Status]

### 3. COMPLIANCE GAP ANALYSIS
**Structured gap identification:**

**Critical Gaps** 
- Requirement: [Specific clause/section]
- Current State: [What exists]
- Required State: [What's needed]
- Business Impact: [High/Medium/Low]
- Remediation Effort: [Hours/Days/Weeks]
- Priority: [P1/P2/P3]

**Gap Categorization:**
-  Documentation Gaps
-  Technical Implementation Gaps
-  Process & Procedural Gaps
-  Training & Awareness Gaps
-  Monitoring & Measurement Gaps

### 4. AUDIT EVIDENCE MATRIX

**Evidence Collection Status:**

| Requirement | Evidence Type | Status | Quality |
|-------------|---------------|--------|---------|
| [Req ID]    | Documentation |      | Good    |
| [Req ID]    | Screenshots   |      | Partial |
| [Req ID]    | Logs          |      | Missing |

### 5. REMEDIATION ROADMAP
**Phased implementation plan:**

**Phase 1: Critical Remediation** (0-30 days)
- Address regulatory violations
- Implement compensating controls
- Document temporary measures
- Estimated Cost: $[X]
- Resources Required: [Y] FTEs

**Phase 2: High Priority** (30-90 days)
- Close major control gaps
- Update policies and procedures
- Conduct targeted training
- Estimated Cost: $[X]
- Resources Required: [Y] FTEs

**Phase 3: Optimization** (90-180 days)
- Enhance control automation
- Implement continuous monitoring
- Achieve target maturity level
- Estimated Cost: $[X]
- Resources Required: [Y] FTEs

### 6. COMPLIANCE METRICS & KPIs
**Key Performance Indicators:**
- Overall Compliance Score: [%]
- Controls Passed: [X/Y] ([%])
- Open Audit Findings: [N]
- Average Remediation Time: [Days]
- Repeat Findings Rate: [%]
- Audit Cycle Coverage: [%]

### 7. REGULATORY CHANGE MANAGEMENT
**Upcoming requirements:**
- Regulation: [Name]
- Effective Date: [Date]
- Impact Assessment: [High/Medium/Low]
- Preparation Status: [On Track/At Risk/Behind]
- Required Actions: [List]

### 8. AUDIT READINESS ASSESSMENT

**Audit Readiness Scorecard:**

| Component          | Score | Status |
|--------------------|-------|--------|
| Documentation      | 85%   |      |
| Evidence           | 72%   |      |
| Control Testing    | 90%   |      |
| Management Review  | 68%   |      |
| Corrective Actions | 88%   |      |

## REPORTING STANDARDS
- Include regulatory references for all findings
- Provide clear pass/fail determinations
- Map findings to business risk
- Include benchmarking against industry standards
- Provide cost-benefit analysis for remediation
- Include timeline with regulatory deadlines
- Add precedent and enforcement action context

## COMMUNICATION APPROACH
- Use regulatory language accurately
- Translate compliance requirements to business impact
- Provide clear, actionable recommendations
- Include risk of non-compliance (fines, sanctions)
- Highlight positive compliance achievements
- Maintain objective, evidence-based tone`,capabilities:["compliance-audit","control-assessment"],useCase:"compliance-monitoring",avatar:"",color:"#059669"},{id:"executive-advisor",name:"Executive Advisor",description:"Strategic GRC advisor providing executive-level insights and recommendations",persona:"Senior executive consultant translating complex GRC data into strategic business insights",systemPrompt:`You are a senior executive advisor specializing in translating complex GRC data into strategic business insights for C-level executives and board members.

# EXECUTIVE-LEVEL GRC INTELLIGENCE FRAMEWORK

## Your Strategic Advisory Role:
- Board and C-Suite GRC advisory
- Strategic risk appetite calibration
- Regulatory strategy formulation
- Crisis management and response
- M&A risk due diligence
- ESG and sustainability governance

## EXECUTIVE REPORTING STRUCTURE

### 1. EXECUTIVE DASHBOARD
**One-page strategic overview:**

**EXECUTIVE GRC DASHBOARD:**
- Overall Risk Score: 7.2/10 
- Compliance Health: 89% 
- Control Effectiveness: 82% 
- Incidents (MTD): 3 Critical
- Audit Findings: 12 Open
- Risk Appetite Usage: 68% 

**Strategic Risk Heat Map:**

Risk Matrix (Impact vs Likelihood):
- High Likelihood: [2] Low Impact, [5] Medium Impact, [8] High Impact, [3] Critical Impact
- Medium Likelihood: [4] Low Impact, [7] Medium Impact, [6] High Impact, [1] Critical Impact  
- Low Likelihood: [9] Low Impact, [11] Medium Impact, [10] High Impact, [0] Critical Impact

### 2. STRATEGIC RISK NARRATIVE

**Top 5 Strategic Risks:**

For each risk, provide:
1. **Risk Title & Business Context**
   - Strategic objective impact
   - Competitive implications
   - Stakeholder concerns

2. **Financial Quantification**
   - Potential loss range: $[X]M - $[Y]M
   - Probability-weighted impact: $[Z]M
   - Cost of mitigation: $[A]M
   - Risk-adjusted ROI: [%]

3. **Strategic Options**
   - Accept: Business rationale
   - Mitigate: Investment required
   - Transfer: Insurance/hedging options
   - Avoid: Strategic pivot needed

### 3. BOARD-LEVEL INSIGHTS

**Governance Effectiveness:**

**Board Risk Oversight Metrics:**
- Risk Committee Meetings: 12/12 
- Risk Appetite Breaches: 2 
- Management Actions Overdue: 3 
- Independent Assurance: Level 2 

**Peer Benchmarking:**
- Industry Risk Maturity: Top Quartile/Average/Bottom
- Regulatory Compliance: Above/At/Below Industry
- Incident Rate: X% better/worse than peers
- Investment in GRC: $X per $1M revenue (Industry: $Y)

### 4. STRATEGIC RECOMMENDATIONS

**Immediate Board Actions Required:**
1. **[Decision Title]**
   - Context: [Business situation]
   - Options: [A, B, C with trade-offs]
   - Recommendation: [Preferred option]
   - Timeline: [Decision deadline]
   - Impact: [Strategic consequences]

**Investment Priorities Matrix:**

**High Impact / Low Cost (DO NOW):**
 Initiative 1 ($X, Y months)
 Initiative 2 ($X, Y months)

**High Impact / High Cost (PLAN):**
 Initiative 3 ($X, Y months)
 Initiative 4 ($X, Y months)

### 5. REGULATORY & COMPLIANCE OUTLOOK

**Regulatory Horizon Scanning:**
- **6 Months**: [Upcoming requirements]
- **12 Months**: [Preparation needed]
- **24 Months**: [Strategic planning]

**Compliance Investment Analysis:**
- Current Spend: $[X]M annually
- Required Investment: $[Y]M
- Penalty Avoidance: $[Z]M
- Reputational Value Protection: [Qualitative]

### 6. CRISIS READINESS ASSESSMENT

**Scenario Response Capability:**
- Cyber Incident: [Ready/Partial/Not Ready]
- Regulatory Breach: [Ready/Partial/Not Ready]
- Operational Failure: [Ready/Partial/Not Ready]
- Reputational Crisis: [Ready/Partial/Not Ready]

### 7. STRATEGIC VALUE CREATION

**GRC as Competitive Advantage:**
- Trust Premium: [Customer confidence metrics]
- Operational Excellence: [Efficiency gains]
- Market Access: [Regulatory clearances]
- Cost of Capital: [Risk-adjusted rates]
- M&A Readiness: [Due diligence preparedness]

### 8. EXECUTIVE DECISION SUPPORT

**Risk-Adjusted Decision Framework:**
For major decisions, provide:
- Risk-adjusted NPV
- Scenario analysis (Best/Expected/Worst)
- Strategic option valuation
- Stakeholder impact assessment
- Reversibility and exit strategies

## COMMUNICATION PRINCIPLES

**For Board Presentations:**
- Lead with business impact, not GRC details
- Use financial metrics and business KPIs
- Provide clear recommendations with options
- Include competitive context
- Focus on strategic enablement, not just protection
- Time-box detailed discussions

**For C-Suite Briefings:**
- Connect to strategic objectives
- Quantify in business terms
- Provide actionable intelligence
- Include early warning indicators
- Suggest strategic opportunities
- Maintain solution orientation

## VISUAL COMMUNICATION STANDARDS
- Use executive dashboards sparingly
- Include trend indicators ()
- Apply traffic light systems ()
- Provide one-page summaries
- Use charts over tables where possible
- Include confidence levels for projections`,capabilities:["executive-reporting","trend-analysis","risk-analysis"],useCase:"executive-reporting",avatar:"",color:"#7c3aed"}];class yr{constructor(s){ee(this,"tenantId");this.tenantId=s}async getAgents(){try{const s=`ai_agents_${this.tenantId}`,t=localStorage.getItem(s);return t?JSON.parse(t):await this.initializeDefaultAgents()}catch(s){return console.error("Error loading AI agents:",s),[]}}async getEnabledAgents(){return(await this.getAgents()).filter(t=>t.isEnabled)}async getAgent(s){return(await this.getAgents()).find(a=>a.id===s)||null}async createAgent(s){const t={...s,id:`agent-${Date.now()}`,createdAt:new Date().toISOString(),usageCount:0,isEnabled:!0},a=await this.getAgents();return a.push(t),await this.saveAgents(a),t}async updateAgent(s,t){const a=await this.getAgents(),n=a.findIndex(i=>i.id===s);return n===-1?null:(a[n]={...a[n],...t},await this.saveAgents(a),a[n])}async deleteAgent(s){const t=await this.getAgents(),a=t.filter(n=>n.id!==s);return a.length===t.length?!1:(await this.saveAgents(a),!0)}async createAgentFromPreset(s,t,a,n){const i=vs.find(o=>o.id===s);if(!i)throw new Error("Agent preset not found");return await this.createAgent({name:(n==null?void 0:n.name)||i.name,description:(n==null?void 0:n.description)||i.description,persona:i.persona,systemPrompt:i.systemPrompt,llmConfigId:t,enabledMcpServers:a,capabilities:i.capabilities,useCase:i.useCase,avatar:i.avatar,color:i.color})}async recordUsage(s){const t=await this.getAgents(),a=t.findIndex(n=>n.id===s);a>=0&&(t[a].usageCount++,t[a].lastUsed=new Date().toISOString(),await this.saveAgents(t))}async getAgentWithContext(s){const t=await this.getAgent(s);if(!t)return null;const a=`user_llm_configs_${this.tenantId}`,i=JSON.parse(localStorage.getItem(a)||"[]").find(h=>h.id===t.llmConfigId),o=`user_mcp_servers_${this.tenantId}`,l=JSON.parse(localStorage.getItem(o)||"[]").filter(h=>t.enabledMcpServers.includes(h.id));return{agent:t,llmConfig:i||null,mcpServers:l}}async initializeDefaultAgents(){const s=[],t=`user_llm_configs_${this.tenantId}`,a=`user_mcp_servers_${this.tenantId}`,n=JSON.parse(localStorage.getItem(t)||"[]"),i=JSON.parse(localStorage.getItem(a)||"[]");{const o=n.length>0?n.find(l=>l.isEnabled)||n[0]:{id:"demo-llm-config",name:"Demo LLM"},m=i.length>0?i.filter(l=>l.isEnabled).map(l=>l.id):["mcp-local-grc-server"];for(const l of vs){const h={id:`agent-${l.id}-${this.tenantId}`,name:l.name,description:l.description,persona:l.persona,systemPrompt:l.systemPrompt,llmConfigId:o.id,enabledMcpServers:m,capabilities:l.capabilities,useCase:l.useCase,isEnabled:!0,createdAt:new Date().toISOString(),usageCount:0,avatar:l.avatar,color:l.color};s.push(h)}}return s.length>0&&(await this.saveAgents(s),console.log(`[Agent Service] Initialized ${s.length} default AI agents from master template for tenant:`,this.tenantId),await this.initializeSampleMetrics(s)),s}async initializeSampleMetrics(s){const{createAgentMetricsService:t}=await Ps(()=>Promise.resolve().then(()=>vr),void 0),a=t(this.tenantId);for(const n of s)await a.generateSampleMetrics(n.id);console.log(`[Agent Service] Initialized sample metrics for ${s.length} agents`)}async saveAgents(s){const t=`ai_agents_${this.tenantId}`;localStorage.setItem(t,JSON.stringify(s))}async validateAgent(s){const t=[],a=`user_llm_configs_${this.tenantId}`,i=JSON.parse(localStorage.getItem(a)||"[]").find(c=>c.id===s.llmConfigId);i?i.isEnabled||t.push("LLM configuration is disabled"):t.push("LLM configuration not found");const o=`user_mcp_servers_${this.tenantId}`,l=JSON.parse(localStorage.getItem(o)||"[]").filter(c=>s.enabledMcpServers.includes(c.id));return l.length===0&&t.push("No MCP servers configured"),l.filter(c=>c.isEnabled).length===0&&t.push("No enabled MCP servers"),{isValid:t.length===0,issues:t}}}const Re=r=>new yr(r);class Bt{constructor(s){ee(this,"tenantId");this.tenantId=s}getAgentMetrics(s){const t=this.loadAllMetrics();return t[s]||(t[s]=this.generateSampleMetrics(s),this.saveAllMetrics(t)),t[s]}getAllAgentMetrics(){return this.loadAllMetrics()}recordExecution(s,t){const a=this.loadAllMetrics(),n=a[s]||this.generateSampleMetrics(s),i={id:`exec-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,...t};n.executionHistory.push(i),n.executionHistory.length>100&&(n.executionHistory=n.executionHistory.slice(-100)),this.recalculateMetrics(n),a[s]=n,this.saveAllMetrics(a)}generateSampleMetrics(s){const t={"risk-specialist":{baseSuccessRate:87,avgExecutions:234,avgTime:3.2,tools:["get_risk_summary","forecast_risk_trajectory","detect_anomalies","analyze_grc_data"]},"compliance-auditor":{baseSuccessRate:92,avgExecutions:156,avgTime:2.8,tools:["analyze_grc_data","detect_anomalies"]},"grc-analyst":{baseSuccessRate:89,avgExecutions:198,avgTime:2.1,tools:["analyze_grc_data","generate_insights"]},"executive-advisor":{baseSuccessRate:94,avgExecutions:89,avgTime:4.5,tools:["analyze_grc_data","generate_insights"]}},a=Object.keys(t).find(l=>s.toLowerCase().includes(l.replace("-",""))),n=a?t[a]:t["grc-analyst"],i=[],o=new Date;for(let l=0;l<n.avgExecutions;l++){const h=Math.random()*30,c=new Date(o.getTime()-h*24*60*60*1e3),u=Math.random()<n.baseSuccessRate/100,p=n.avgTime+(Math.random()-.5)*2;i.push({id:`exec-${l}-${s}`,timestamp:c.toISOString(),success:u,executionTime:Math.max(.1,p),toolsUsed:this.sampleTools(n.tools),errorMessage:u?void 0:this.generateErrorMessage()})}return i.sort((l,h)=>new Date(l.timestamp).getTime()-new Date(h.timestamp).getTime()),{agentId:s,successRate:n.baseSuccessRate,totalExecutions:n.avgExecutions,averageExecutionTime:n.avgTime,lastExecution:i.length>0?i[i.length-1].timestamp:void 0,executionHistory:i,toolsUsed:n.tools}}sampleTools(s){const t=Math.floor(Math.random()*s.length)+1;return[...s].sort(()=>.5-Math.random()).slice(0,t)}generateErrorMessage(){const s=["Tool execution timeout","MCP server connection failed","Invalid parameters provided","Data source temporarily unavailable","Rate limit exceeded","Authentication failed","Network connectivity issue"];return s[Math.floor(Math.random()*s.length)]}recalculateMetrics(s){var m;const{executionHistory:t}=s;if(t.length===0)return;const a=t.filter(l=>l.success);s.successRate=Math.round(a.length/t.length*100),s.totalExecutions=t.length;const n=t.reduce((l,h)=>l+h.executionTime,0);s.averageExecutionTime=Math.round(n/t.length*10)/10,s.lastExecution=(m=t[t.length-1])==null?void 0:m.timestamp;const o=t.slice(-20).flatMap(l=>l.toolsUsed);s.toolsUsed=[...new Set(o)]}getPlatformStats(){const s=this.loadAllMetrics(),t=Object.values(s);if(t.length===0)return{totalAgents:0,activeAgents:0,totalExecutions:0,averageSuccessRate:0};const a=t.reduce((m,l)=>m+l.totalExecutions,0),n=t.reduce((m,l)=>m+l.successRate,0),i=new Date(Date.now()-24*60*60*1e3),o=t.filter(m=>m.lastExecution&&new Date(m.lastExecution)>i).length;return{totalAgents:t.length,activeAgents:o,totalExecutions:a,averageSuccessRate:Math.round(n/t.length*10)/10}}simulateActivity(s){const t=["get_risk_summary","analyze_grc_data","detect_anomalies","generate_insights"],a=Math.random()>.1,n=1+Math.random()*4;this.recordExecution(s,{timestamp:new Date().toISOString(),success:a,executionTime:n,toolsUsed:this.sampleTools(t),errorMessage:a?void 0:this.generateErrorMessage()})}loadAllMetrics(){const s=`agent_metrics_${this.tenantId}`,t=localStorage.getItem(s);return t?JSON.parse(t):{}}saveAllMetrics(s){const t=`agent_metrics_${this.tenantId}`;localStorage.setItem(t,JSON.stringify(s))}}const ws=r=>new Bt(r),vr=Object.freeze(Object.defineProperty({__proto__:null,AgentMetricsService:Bt,createAgentMetricsService:ws},Symbol.toStringTag,{value:"Module"})),jr=({tenantId:r})=>{const[s,t]=g.useState({totalAgents:0,activeAgents:0,totalExecutions:0,averageSuccessRate:0}),[a,n]=g.useState(!0);g.useEffect(()=>{const m=async()=>{try{const c=ws(r).getPlatformStats();t(c)}catch(h){console.error("Error loading platform stats:",h)}finally{n(!1)}};m();const l=setInterval(m,3e4);return()=>clearInterval(l)},[r]);const i=m=>m>=1e3?Math.floor(m/1e3)+"k+":m.toString(),o=[{title:"Total Agents",value:a?"-":s.totalAgents,icon:Se,color:"text-blue-600",bgColor:"bg-blue-50"},{title:"Active Agents",value:a?"-":s.activeAgents,icon:De,color:"text-green-600",bgColor:"bg-green-50"},{title:"Total Executions",value:a?"-":i(s.totalExecutions),icon:es,color:"text-purple-600",bgColor:"bg-purple-50"},{title:"Success Rate",value:a?"-":`${s.averageSuccessRate}%`,icon:Y,color:"text-emerald-600",bgColor:"bg-emerald-50"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:o.map(m=>{const l=m.icon;return e.jsx(P,{className:"hover:shadow-md transition-shadow",children:e.jsx(O,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${m.bgColor}`,children:e.jsx(l,{className:`h-5 w-5 ${m.color}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.value}),e.jsx("p",{className:"text-sm text-gray-500",children:m.title})]})]})})},m.title)})})},z=g.forwardRef(({className:r,variant:s="default",...t},a)=>e.jsx("div",{ref:a,className:q("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{"border-transparent bg-primary text-primary-foreground hover:bg-primary/80":s==="default","border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80":s==="secondary","border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80":s==="destructive","text-foreground":s==="outline"},r),...t}));z.displayName="Badge";const br=({agent:r,tenantId:s,onToggle:t,onConfigure:a})=>{const[n,i]=g.useState(null),[o,m]=g.useState(!0),[l,h]=g.useState([]),c={risk:es,compliance:re,control:de,executive:Ye,recommendation:me},u=b=>{const j=b.useCase.toLowerCase();return j.includes("risk")?"risk":j.includes("compliance")?"compliance":j.includes("control")?"control":j.includes("executive")?"executive":"recommendation"};g.useEffect(()=>{const b=async()=>{try{m(!0);const T=ws(s).getAgentMetrics(r.id);i(T);const D=`user_mcp_servers_${s}`,N=JSON.parse(localStorage.getItem(D)||"[]").filter(G=>r.enabledMcpServers.includes(G.id)&&G.isEnabled);if(N.length===0&&r.enabledMcpServers.length>0){const G=r.enabledMcpServers.map(V=>({id:V,name:V==="mcp-local-grc-server"?"Archer GRC Server":V.replace(/^mcp-/,"").replace(/-/g," "),isEnabled:!0}));h(G)}else h(N)}catch(w){console.error("Error loading agent data:",w)}finally{m(!1)}};b();const j=setInterval(b,3e4);return()=>clearInterval(j)},[r.id,s,r.enabledMcpServers]);const p=b=>{if(!b)return"Never";const j=new Date,w=new Date(b),T=j.getTime()-w.getTime(),D=Math.floor(T/6e4),I=Math.floor(T/36e5),N=Math.floor(T/864e5);return D<1?"Just now":D<60?`${D} minutes ago`:I<24?`${I} hours ago`:N<7?`${N} days ago`:w.toLocaleDateString()},y=b=>b?"bg-green-100 text-green-800 border-green-200":"bg-gray-100 text-gray-800 border-gray-200",S=b=>b?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(ue,{className:"h-4 w-4"}),f=c[u(r)];return e.jsx(P,{className:"hover:shadow-md transition-shadow",children:e.jsxs(O,{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-3 rounded-lg ${r.isEnabled?"bg-blue-100":"bg-gray-100"}`,children:e.jsx(f,{className:`h-6 w-6 ${r.isEnabled?"text-blue-600":"text-gray-400"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r.name}),e.jsxs(z,{variant:"outline",className:y(r.isEnabled),children:[S(r.isEnabled),e.jsx("span",{className:"ml-1 capitalize",children:r.isEnabled?"Active":"Inactive"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:r.description})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Specialization"}),e.jsx("p",{className:"text-sm text-gray-800",children:r.persona})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-2",children:"Available Tools"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:o?e.jsx(z,{variant:"secondary",className:"text-xs",children:"Loading tools..."}):l.length>0?l.map(b=>e.jsx(z,{variant:"secondary",className:"text-xs",children:b.name},b.id)):e.jsx(z,{variant:"outline",className:"text-xs text-gray-500",children:"No MCP servers enabled"})})]}),!o&&n&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center border-t pt-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[n.successRate,"%"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Success Rate"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:n.totalExecutions}),e.jsx("p",{className:"text-xs text-gray-500",children:"Executions"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[n.averageExecutionTime,"s"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Avg Time"})]})]}),o&&e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center border-t pt-4 mb-4",children:[e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded mb-1"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Success Rate"})]}),e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded mb-1"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Executions"})]}),e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded mb-1"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Avg Time"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500 flex items-center space-x-1",children:[e.jsx(Ie,{className:"h-3 w-3"}),e.jsxs("span",{children:["Last execution: ",p(n==null?void 0:n.lastExecution)]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>t(r.id,!r.isEnabled),className:"text-xs",children:r.isEnabled?e.jsxs(e.Fragment,{children:[e.jsx($t,{className:"h-3 w-3 mr-1"}),"Pause"]}):e.jsxs(e.Fragment,{children:[e.jsx(zt,{className:"h-3 w-3 mr-1"}),"Activate"]})}),e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>a(r),className:"text-xs",children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),"Configure"]})]})]})]})})},Nr=({open:r,onClose:s,agent:t,isEditing:a=!1,tenantId:n,onSave:i})=>{oe();const[o,m]=g.useState("general"),[l,h]=g.useState(!1),[c,u]=g.useState(null),[p,y]=g.useState({name:"",description:"",persona:"",systemPrompt:"",llmConfigId:"",enabledMcpServers:[],capabilities:[],useCase:"",avatar:"",color:"#2563eb",isEnabled:!0}),[S,f]=g.useState([]),[b,j]=g.useState([]),[w,T]=g.useState(null),[D,I]=g.useState(null);g.useEffect(()=>{if(!n||!r)return;const x=`user_llm_configs_${n}`,L=localStorage.getItem(x);if(L){const _=JSON.parse(L);f(_)}const K=`user_mcp_servers_${n}`,v=localStorage.getItem(K);if(v){const _=JSON.parse(v);j(_)}if(a&&t){const B=ws(n).getAgentMetrics(t.id);I(B)}},[n,r,a,t]),g.useEffect(()=>{t&&a?y({name:t.name,description:t.description,persona:t.persona,systemPrompt:t.systemPrompt,llmConfigId:t.llmConfigId,enabledMcpServers:t.enabledMcpServers,capabilities:t.capabilities,useCase:t.useCase,avatar:t.avatar||"",color:t.color||"#2563eb",isEnabled:t.isEnabled}):(y({name:"",description:"",persona:"",systemPrompt:"",llmConfigId:"",enabledMcpServers:[],capabilities:[],useCase:"",avatar:"",color:"#2563eb",isEnabled:!0}),T(null))},[t,a,r]);const N=x=>{const L=vs.find(K=>K.id===x);L&&(T(x),y({...p,name:L.name,description:L.description,persona:L.persona,systemPrompt:L.systemPrompt,capabilities:L.capabilities,useCase:L.useCase,avatar:L.avatar,color:L.color}))},G=x=>{y(L=>({...L,capabilities:L.capabilities.includes(x)?L.capabilities.filter(K=>K!==x):[...L.capabilities,x]}))},V=x=>{y(L=>({...L,enabledMcpServers:L.enabledMcpServers.includes(x)?L.enabledMcpServers.filter(K=>K!==x):[...L.enabledMcpServers,x]}))},Z=async()=>{if(!p.name.trim()){u({type:"error",text:"Agent name is required"});return}if(!p.llmConfigId){u({type:"error",text:"LLM configuration is required"});return}if(p.enabledMcpServers.length===0){u({type:"error",text:"At least one MCP server must be enabled"});return}try{h(!0),u(null);const x=Re(n);a&&t?(await x.updateAgent(t.id,p),u({type:"success",text:"Agent updated successfully"})):(await x.createAgent(p),u({type:"success",text:"Agent created successfully"})),setTimeout(()=>{i(),s()},1e3)}catch(x){console.error("Error saving agent:",x),u({type:"error",text:"Failed to save agent. Please try again."})}finally{h(!1)}},d=async()=>{if(!(!t||!a)&&confirm(`Are you sure you want to delete the agent "${t.name}"? This action cannot be undone.`))try{h(!0),await Re(n).deleteAgent(t.id),u({type:"success",text:"Agent deleted successfully"}),setTimeout(()=>{i(),s()},1e3)}catch(x){console.error("Error deleting agent:",x),u({type:"error",text:"Failed to delete agent. Please try again."})}finally{h(!1)}},k=[{id:"general",label:"General",icon:Se},{id:"persona",label:"Persona",icon:Ht},{id:"capabilities",label:"Capabilities",icon:os},{id:"integrations",label:"Integrations",icon:ve},{id:"performance",label:"Performance",icon:De}];return r?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Se,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:a?`Configure ${t==null?void 0:t.name}`:"Create AI Agent"}),e.jsx("p",{className:"text-sm text-gray-600",children:a?"Modify agent settings and capabilities":"Set up a new AI agent with custom configuration"})]})]}),e.jsx(M,{variant:"ghost",onClick:s,className:"p-2",children:e.jsx(Ws,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"border-b bg-gray-50",children:e.jsx("div",{className:"flex space-x-0 px-6",children:k.map(x=>{const L=x.icon;return e.jsx("button",{onClick:()=>m(x.id),className:`px-4 py-3 text-sm font-medium border-b-2 transition-colors ${o===x.id?"border-blue-500 text-blue-600 bg-white":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{children:x.label})]})},x.id)})})}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:[c&&e.jsxs(Q,{className:`mb-4 ${c.type==="success"?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[c.type==="success"?e.jsx(Y,{className:"h-4 w-4 text-green-600"}):e.jsx(ue,{className:"h-4 w-4 text-red-600"}),e.jsx("div",{className:"ml-2",children:e.jsx("p",{className:`text-sm ${c.type==="success"?"text-green-800":"text-red-800"}`,children:c.text})})]}),o==="general"&&e.jsxs("div",{className:"space-y-6",children:[!a&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(os,{className:"h-5 w-5 text-yellow-500"}),e.jsx("h3",{className:"text-lg font-medium",children:"Start with a Preset"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:vs.map(x=>e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-all ${w===x.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>N(x.id),children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("span",{className:"text-2xl",children:x.avatar}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:x.name}),e.jsx("p",{className:"text-sm text-gray-600",children:x.description})]}),w===x.id&&e.jsx(Y,{className:"h-5 w-5 text-blue-500"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[x.capabilities.slice(0,3).map(L=>e.jsx(z,{variant:"outline",className:"text-xs",children:L},L)),x.capabilities.length>3&&e.jsxs(z,{variant:"outline",className:"text-xs",children:["+",x.capabilities.length-3," more"]})]})]},x.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Agent Name *"}),e.jsx("input",{type:"text",value:p.name,onChange:x=>y({...p,name:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Risk Analysis Specialist"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Avatar"}),e.jsx("div",{className:"flex space-x-2",children:["","","","","","","",""].map(x=>e.jsx("button",{type:"button",onClick:()=>y({...p,avatar:x}),className:`p-2 border rounded-md text-xl hover:bg-gray-50 ${p.avatar===x?"border-blue-500 bg-blue-50":"border-gray-200"}`,children:x},x))})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:p.description,onChange:x=>y({...p,description:x.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of what this agent specializes in..."})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Use Case"}),e.jsx("input",{type:"text",value:p.useCase,onChange:x=>y({...p,useCase:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"e.g., comprehensive-grc-analysis, risk-management"})]})]})]}),o==="persona"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Agent Persona & Behavior"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Persona Description"}),e.jsx("textarea",{value:p.persona,onChange:x=>y({...p,persona:x.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Describe the agent's personality and expertise (e.g., Professional, analytical, detail-oriented GRC expert with deep regulatory knowledge)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"System Prompt"}),e.jsx("textarea",{value:p.systemPrompt,onChange:x=>y({...p,systemPrompt:x.target.value}),rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Detailed instructions for how the agent should behave, its role, and response structure..."})]})]})]})}),o==="capabilities"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Agent Capabilities"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Select the capabilities this agent should have. These define what the agent is good at."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:fr.map(x=>e.jsxs("div",{className:`p-4 border rounded-lg cursor-pointer transition-all ${p.capabilities.includes(x.id)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>G(x.id),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:x.name}),p.capabilities.includes(x.id)&&e.jsx(Y,{className:"h-5 w-5 text-blue-500"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:x.description}),e.jsx(z,{variant:"outline",className:"mt-2 text-xs",children:x.category})]},x.id))})]})}),o==="integrations"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"LLM Configuration"}),S.length>0?e.jsxs("select",{value:p.llmConfigId,onChange:x=>y({...p,llmConfigId:x.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select LLM Configuration..."}),S.map(x=>e.jsxs("option",{value:x.id,children:[x.name," (",x.provider," - ",x.model,")"]},x.id))]}):e.jsxs(Q,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(ue,{className:"h-4 w-4 text-yellow-600"}),e.jsx("div",{className:"ml-2",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"No LLM configurations available. Please configure at least one LLM in Settings first."})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"MCP Server Access"}),b.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:b.map(x=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-all ${p.enabledMcpServers.includes(x.id)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>V(x.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:x.name}),e.jsx("p",{className:"text-sm text-gray-600",children:x.description})]}),p.enabledMcpServers.includes(x.id)&&e.jsx(Y,{className:"h-5 w-5 text-blue-500"})]})},x.id))}):e.jsxs(Q,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(ue,{className:"h-4 w-4 text-yellow-600"}),e.jsx("div",{className:"ml-2",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"No MCP servers available. Please configure at least one MCP server in Settings first."})})]})]})]}),o==="performance"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Performance Metrics"}),a&&D?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[D.successRate,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Success Rate"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:D.totalExecutions}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Executions"})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[D.averageExecutionTime,"s"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Avg Execution Time"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Recent Activity"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:D.executionHistory.slice(-10).reverse().map(x=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[x.success?e.jsx(Y,{className:"h-4 w-4 text-green-500"}):e.jsx(ue,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm",children:x.success?"Success":"Failed"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(x.timestamp).toLocaleString()})]},x.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Frequently Used Tools"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:D.toolsUsed.map(x=>e.jsx(z,{variant:"outline",className:"text-xs",children:x.replace(/_/g," ")},x))})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(De,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h4",{className:"font-medium text-gray-600 mb-2",children:"No Performance Data"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Performance metrics will be available after the agent has been used."})]})]})})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white border-t px-6 py-4 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3",children:a&&e.jsxs(M,{variant:"outline",onClick:d,disabled:l,className:"text-red-600 border-red-200 hover:bg-red-50",children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"Delete Agent"]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(M,{variant:"outline",onClick:s,disabled:l,children:"Cancel"}),e.jsx(M,{onClick:Z,disabled:l,children:l?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Saving..."})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Gt,{className:"h-4 w-4"}),e.jsx("span",{children:a?"Update Agent":"Create Agent"})]})})]})]})]})}):null},wr=()=>{const{tenant:r}=oe(),[s,t]=g.useState([]),[a,n]=g.useState(!0),[i,o]=g.useState(new Date),[m,l]=g.useState(!1),[h,c]=g.useState(null),[u,p]=g.useState(!1);g.useEffect(()=>{r!=null&&r.id&&y()},[r==null?void 0:r.id]);const y=async()=>{if(r!=null&&r.id)try{n(!0);const I=await Re(r.id).getAgents();t(I),o(new Date)}catch(D){console.error("Error loading AI agents:",D)}finally{n(!1)}},S=async(D,I)=>{if(r!=null&&r.id)try{await Re(r.id).updateAgent(D,{isEnabled:I}),await y()}catch(N){console.error("Error toggling AI agent:",N)}},f=D=>{c(D),l(!0)},b=()=>{c(null),p(!0)},j=()=>{l(!1),p(!1),c(null)},w=()=>{y()},T=()=>{y()};return a&&s.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"AI Agents"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage and monitor your intelligent GRC analysis agents"})]})}),e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"AI Agents"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage and monitor your intelligent GRC analysis agents"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(M,{variant:"outline",onClick:T,disabled:a,className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:`h-4 w-4 ${a?"animate-spin":""}`}),e.jsx("span",{children:"Refresh"})]}),e.jsxs(M,{onClick:b,children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Create Agent"]})]})]}),(r==null?void 0:r.id)&&e.jsx(jr,{tenantId:r.id}),s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Se,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-medium text-muted-foreground mb-2",children:"No AI Agents Available"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"AI agents will be automatically created when you configure LLM settings and MCP servers."}),e.jsxs(Q,{className:"max-w-lg mx-auto",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("div",{className:"ml-2",children:e.jsx("p",{className:"text-sm",children:"Configure LLM settings and MCP servers in Settings to enable AI agents."})})]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:s.map(D=>e.jsx(br,{agent:D,tenantId:(r==null?void 0:r.id)||"",onToggle:S,onConfigure:f},D.id))}),s.length>0&&e.jsxs(Q,{className:"bg-green-50 border-green-200",children:[e.jsx(re,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("h4",{className:"font-medium text-green-800",children:"System Protection"}),e.jsxs("p",{className:"text-sm text-green-700 mt-1",children:["Circuit Breaker Status: ",e.jsx("span",{className:"font-medium",children:"CLOSED (Normal Operation)"}),e.jsx("br",{}),"Protects against infinite loops and cascading failures"]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["Last updated: ",i.toLocaleTimeString(),"  Auto-refresh every 30 seconds for active agents"]}),e.jsx(Nr,{open:m||u,onClose:j,agent:h,isEditing:!!h,tenantId:(r==null?void 0:r.id)||"",onSave:w})]})};class le extends Error{constructor(s,t,a,n){super(s),this.code=t,this.tenantId=a,this.userId=n,this.name="TenantValidationError"}}const Ue=class Ue{constructor(){ee(this,"accessRules",new Map);this.initializeDefaultRules()}static getInstance(){return Ue.instance||(Ue.instance=new Ue),Ue.instance}initializeDefaultRules(){[{tenantId:"tenant-fintech-001",allowedUserIds:["user-004"],requiredRoles:["TenantOwner","AgentUser"],crossTenantAccess:!1,lastUpdated:new Date().toISOString()},{tenantId:"tenant-healthcare-002",allowedUserIds:["user-006"],requiredRoles:["TenantOwner","AgentUser"],crossTenantAccess:!1,lastUpdated:new Date().toISOString()},{tenantId:"tenant-manufacturing-003",allowedUserIds:["user-001","user-002","user-003"],requiredRoles:["TenantOwner","AgentUser","Auditor"],crossTenantAccess:!1,lastUpdated:new Date().toISOString()}].forEach(t=>{this.accessRules.set(t.tenantId,t)})}async validateTenantAccess(s){try{return this.validateContextStructure(s),this.validateRequestTimestamp(s.requestTimestamp),await this.validateTenantPermissions(s),await this.validateSessionIntegrity(s),await this.detectAnomalousAccess(s),!0}catch(t){if(t instanceof le)throw this.logSecurityViolation(s,t),t;const a=new le("Tenant validation failed due to system error","SYSTEM_ERROR",s.tenantId,s.userId);throw this.logSecurityViolation(s,a),a}}validateContextStructure(s){if(!s.userId)throw new le("User ID is required","INVALID_USER_ID");if(!s.tenantId)throw new le("Tenant ID is required","INVALID_TENANT_ID");if(!s.sessionToken)throw new le("Session token is required","INVALID_SESSION");if(!Array.isArray(s.userRoles)||s.userRoles.length===0)throw new le("Valid user roles are required","INVALID_ROLES")}validateRequestTimestamp(s){const t=Date.now(),a=5*60*1e3;if(s>t+a)throw new le("Request timestamp is too far in the future","TIMESTAMP_FUTURE");if(s<t-a)throw new le("Request timestamp is too old (possible replay attack)","TIMESTAMP_REPLAY")}async validateTenantPermissions(s){const t=this.accessRules.get(s.tenantId);if(!t)throw new le("Tenant not found or access denied","TENANT_NOT_FOUND",s.tenantId,s.userId);if(!t.allowedUserIds.includes(s.userId)&&!(s.userRoles.includes("PlatformOwner")||s.userRoles.includes("SuperAdmin")))throw new le("User does not have access to this tenant","ACCESS_DENIED",s.tenantId,s.userId);if(!t.requiredRoles.some(n=>s.userRoles.includes(n)))throw new le("User does not have required roles for tenant access","INSUFFICIENT_ROLES",s.tenantId,s.userId)}async validateSessionIntegrity(s){if(s.sessionToken.split(".").length!==3)throw new le("Invalid session token format","INVALID_SESSION_FORMAT",s.tenantId,s.userId);try{const a=localStorage.getItem("auth_token");if(!a)throw new le("No valid session found","SESSION_NOT_FOUND",s.tenantId,s.userId);const n=JSON.parse(a);if(n.exp&&n.exp<Math.floor(Date.now()/1e3))throw new le("Session has expired","SESSION_EXPIRED",s.tenantId,s.userId);if(n.tenantId!==s.tenantId)throw new le("Session tenant mismatch","TENANT_MISMATCH",s.tenantId,s.userId)}catch(a){throw a instanceof le?a:new le("Session validation failed","SESSION_VALIDATION_ERROR",s.tenantId,s.userId)}}async detectAnomalousAccess(s){const t=`access_pattern_${s.userId}`,a=localStorage.getItem(t),n={tenantId:s.tenantId,timestamp:s.requestTimestamp,userAgent:typeof navigator<"u"?navigator.userAgent:"unknown"};if(a)try{const o=JSON.parse(a).filter(l=>l.timestamp>Date.now()-60*60*1e3);if(new Set(o.map(l=>l.tenantId)).size>3)throw new le("Suspicious tenant switching pattern detected","SUSPICIOUS_PATTERN",s.tenantId,s.userId);o.push(n),localStorage.setItem(t,JSON.stringify(o.slice(-20)))}catch{localStorage.setItem(t,JSON.stringify([n]))}else localStorage.setItem(t,JSON.stringify([n]))}logSecurityViolation(s,t){const a={timestamp:new Date().toISOString(),userId:s.userId,tenantId:s.tenantId,errorCode:t.code,errorMessage:t.message,userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",requestTimestamp:s.requestTimestamp,severity:this.getSeverityLevel(t.code)},n="security_violations",i=localStorage.getItem(n),o=i?JSON.parse(i):[];o.push(a),localStorage.setItem(n,JSON.stringify(o.slice(-100))),console.warn("Security Violation Detected:",a)}getSeverityLevel(s){switch(s){case"TIMESTAMP_REPLAY":case"SUSPICIOUS_PATTERN":case"ACCESS_DENIED":return"CRITICAL";case"TENANT_MISMATCH":case"SESSION_EXPIRED":return"HIGH";case"INSUFFICIENT_ROLES":case"INVALID_SESSION_FORMAT":return"MEDIUM";default:return"LOW"}}getSecurityViolations(){const s=localStorage.getItem("security_violations");return s?JSON.parse(s):[]}updateTenantRule(s){s.lastUpdated=new Date().toISOString(),this.accessRules.set(s.tenantId,s)}getTenantRule(s){return this.accessRules.get(s)}};ee(Ue,"instance");let zs=Ue;const Sr=zs.getInstance();class Le extends Error{constructor(s,t){super(s),this.code=t,this.name="RequestSigningError"}}const Fe=class Fe{constructor(){ee(this,"signingKey");this.signingKey=this.generateSigningKey()}static getInstance(){return Fe.instance||(Fe.instance=new Fe),Fe.instance}generateSigningKey(){return btoa("grc-mcp-security-key-v1"+"-"+Date.now().toString().slice(0,-3))}async signRequest(s,t,a,n={}){try{const i=n.includeTimestamp!==!1?Date.now():0,o=n.includeNonce!==!1?this.generateNonce():"",m=this.createSigningMessage(s,t,a,i,o),l=await this.generateSignature(m);return{payload:s,signature:l,timestamp:i,nonce:o,tenantId:t,userId:a}}catch(i){throw new Le(`Failed to sign request: ${i instanceof Error?i.message:"Unknown error"}`,"SIGNING_FAILED")}}async verifyRequest(s){try{if(s.timestamp>0){const n=Date.now(),i=5*60*1e3;if(s.timestamp<n-i)throw new Le("Request too old (possible replay attack)","REPLAY_DETECTED");if(s.timestamp>n+i)throw new Le("Request timestamp too far in future","INVALID_TIMESTAMP")}if(s.nonce){if(await this.checkNonceUsage(s.nonce))throw new Le("Nonce already used (replay attack detected)","NONCE_REPLAY");await this.recordNonceUsage(s.nonce)}const t=this.createSigningMessage(s.payload,s.tenantId,s.userId,s.timestamp,s.nonce),a=await this.generateSignature(t);return this.constantTimeEquals(s.signature,a)}catch(t){throw t instanceof Le?t:new Le(`Failed to verify request: ${t instanceof Error?t.message:"Unknown error"}`,"VERIFICATION_FAILED")}}async signMcpOperation(s,t,a,n,i){const o={operation:s,toolId:t,inputs:a,securityLevel:"CRITICAL"};return this.signRequest(o,n,i,{includeTimestamp:!0,includeNonce:!0})}createSigningMessage(s,t,a,n,i){const o=typeof s=="string"?s:JSON.stringify(s,null,0);return["GRC-MCP-REQUEST",t,a,n.toString(),i,o].join("|")}async generateSignature(s){try{const a=new TextEncoder().encode(s+this.signingKey);if(typeof crypto<"u"&&crypto.subtle){const n=await crypto.subtle.digest("SHA-256",a);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")}else return this.simpleHash(s+this.signingKey)}catch{throw new Le("Failed to generate signature","CRYPTO_ERROR")}}simpleHash(s){let t=0;if(s.length===0)return t.toString();for(let a=0;a<s.length;a++){const n=s.charCodeAt(a);t=(t<<5)-t+n,t=t&t}return Math.abs(t).toString(16).padStart(8,"0")}generateNonce(){if(typeof crypto<"u"&&crypto.getRandomValues){const s=new Uint8Array(16);return crypto.getRandomValues(s),Array.from(s,t=>t.toString(16).padStart(2,"0")).join("")}else return Math.random().toString(36).substring(2)+Date.now().toString(36)}async checkNonceUsage(s){return this.getUsedNonces().includes(s)}async recordNonceUsage(s){const t=this.getUsedNonces();t.push(s);const a=t.slice(-1e3);localStorage.setItem("used_nonces",JSON.stringify(a))}getUsedNonces(){const s=localStorage.getItem("used_nonces");return s?JSON.parse(s):[]}constantTimeEquals(s,t){if(s.length!==t.length)return!1;let a=0;for(let n=0;n<s.length;n++)a|=s.charCodeAt(n)^t.charCodeAt(n);return a===0}clearExpiredData(){this.getUsedNonces().length>5e3&&localStorage.removeItem("used_nonces")}getSigningStats(){return{usedNoncesCount:this.getUsedNonces().length,signingKeyAge:Date.now()}}};ee(Fe,"instance");let Gs=Fe;const Cr=Gs.getInstance(),$e=class $e{constructor(){ee(this,"events",[]);ee(this,"maxEvents",1e4);this.loadExistingEvents(),this.initializePeriodicMaintenance()}static getInstance(){return $e.instance||($e.instance=new $e),$e.instance}async logEvent(s,t,a,n,i,o,m={},l={}){const h=this.generateEventId(),c=new Date().toISOString(),u={id:h,timestamp:c,eventType:s,severity:t,tenantId:a,userId:n,sessionId:l.sessionId||this.getCurrentSessionId(),action:i,resource:l.resource,resourceId:l.resourceId,outcome:o,details:{...m,applicationContext:"GRC-MCP-Chat",version:"1.0.0"},userAgent:this.getUserAgent(),ipAddress:this.getClientIP(),geolocation:this.getGeolocation(),riskScore:l.riskScore||this.calculateRiskScore(s,t,o),complianceFrameworks:this.getApplicableFrameworks(a),hash:""};return u.hash=await this.generateEventHash(u),this.events.push(u),await this.persistEvent(u),await this.analyzeAndAlert(u),this.maintainEventLimits(),h}async logTenantAccess(s,t,a,n={}){return this.logEvent("TENANT_ACCESS",a==="FAILURE"?"WARNING":"INFO",s,t,"TENANT_ACCESS_ATTEMPT",a,n)}async logMcpOperation(s,t,a,n,i,o={}){const m=i==="FAILURE"?"ERROR":i==="PARTIAL"?"WARNING":"INFO";return this.logEvent("MCP_OPERATION",m,s,t,`MCP_${n.toUpperCase()}`,i,{...o,toolId:a,operation:n},{resource:"MCP_TOOL",resourceId:a})}async logSecurityViolation(s,t,a,n={}){return this.logEvent("SECURITY_VIOLATION","CRITICAL",s,t,`SECURITY_VIOLATION_${a}`,"FAILURE",{...n,violationType:a,automated:!0,requiresInvestigation:!0},{riskScore:9})}async logAuthentication(s,t,a,n,i={}){return this.logEvent("AUTHENTICATION",n==="FAILURE"?"WARNING":"INFO",s,t,`AUTH_${a.toUpperCase()}`,n,{...i,authMethod:a})}async logAgentInteraction(s,t,a,n,i,o={}){return this.logEvent("AGENT_INTERACTION","INFO",s,t,`AGENT_${n.toUpperCase()}`,i,{...o,agentId:a,interaction:n},{resource:"AI_AGENT",resourceId:a})}queryEvents(s){let t=[...this.events];return s.tenantId&&(t=t.filter(a=>a.tenantId===s.tenantId)),s.userId&&(t=t.filter(a=>a.userId===s.userId)),s.eventType&&(t=t.filter(a=>a.eventType===s.eventType)),s.severity&&(t=t.filter(a=>a.severity===s.severity)),s.outcome&&(t=t.filter(a=>a.outcome===s.outcome)),s.startTime&&(t=t.filter(a=>a.timestamp>=s.startTime)),s.endTime&&(t=t.filter(a=>a.timestamp<=s.endTime)),t.sort((a,n)=>new Date(n.timestamp).getTime()-new Date(a.timestamp).getTime()),s.limit&&(t=t.slice(0,s.limit)),t}generateAuditSummary(s,t){let a=s?this.events.filter(c=>c.tenantId===s):this.events;t&&(a=a.filter(c=>c.timestamp>=t.start&&c.timestamp<=t.end));const n={},i={};let o=0;a.forEach(c=>{n[c.eventType]=(n[c.eventType]||0)+1,i[c.severity]=(i[c.severity]||0)+1,o+=c.riskScore||0});const m=a.length>0?o/a.length:0,l=this.detectAnomalies(a),h=this.assessComplianceStatus(a,s);return{totalEvents:a.length,eventsByType:n,eventsBySeverity:i,riskScore:Math.round(m*100)/100,complianceStatus:h,anomalies:l}}exportAuditLogs(s,t="JSON"){const a=this.queryEvents(s);return t==="CSV"?this.eventsToCSV(a):JSON.stringify({exportTimestamp:new Date().toISOString(),totalEvents:a.length,query:s,events:a},null,2)}async verifyIntegrity(s){const t=s?this.events.filter(n=>s.includes(n.id)):this.events,a=[];for(const n of t){const i={...n};delete i.hash;const o=await this.generateEventHash(i);n.hash!==o&&a.push(n.id)}return{verified:a.length===0,tamperedEvents:a,totalChecked:t.length}}generateEventId(){return`audit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getCurrentSessionId(){const s=localStorage.getItem("session_id");if(s)return s;const t=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return localStorage.setItem("session_id",t),t}getUserAgent(){return typeof navigator<"u"?navigator.userAgent:"server"}getClientIP(){return"127.0.0.1"}getGeolocation(){return"Local Development"}calculateRiskScore(s,t,a){let n=0;switch(s){case"SECURITY_VIOLATION":n=8;break;case"AUTHORIZATION":n=6;break;case"AUTHENTICATION":n=5;break;case"TENANT_ACCESS":n=4;break;case"MCP_OPERATION":n=3;break;case"DATA_ACCESS":n=3;break;default:n=1}const i={CRITICAL:2,ERROR:1.5,WARNING:1.2,INFO:1}[t]||1,o={FAILURE:1.5,PARTIAL:1.2,SUCCESS:.8}[a]||1;return Math.min(10,n*i*o)}getApplicableFrameworks(s){const t=["SOC2","ISO27001"];return s.includes("fintech")?t.push("PCI-DSS","SOX"):s.includes("healthcare")?t.push("HIPAA"):s.includes("manufacturing")&&t.push("ISO9001"),t}async generateEventHash(s){const t=JSON.stringify({id:s.id,timestamp:s.timestamp,eventType:s.eventType,tenantId:s.tenantId,userId:s.userId,action:s.action,outcome:s.outcome,details:s.details},Object.keys(s).sort());if(typeof crypto<"u"&&crypto.subtle){const n=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(m=>m.toString(16).padStart(2,"0")).join("")}return this.simpleHash(t)}simpleHash(s){let t=0;for(let a=0;a<s.length;a++){const n=s.charCodeAt(a);t=(t<<5)-t+n,t=t&t}return Math.abs(t).toString(16).padStart(8,"0")}loadExistingEvents(){try{const s=localStorage.getItem("audit_events");s&&(this.events=JSON.parse(s))}catch(s){console.warn("Failed to load existing audit events:",s)}}async persistEvent(s){try{const t=[...this.events];localStorage.setItem("audit_events",JSON.stringify(t.slice(-this.maxEvents))),s.severity==="CRITICAL"&&console.warn("CRITICAL AUDIT EVENT:",s)}catch(t){console.error("Failed to persist audit event:",t)}}async analyzeAndAlert(s){(s.severity==="CRITICAL"||s.riskScore>7)&&console.warn("HIGH RISK AUDIT EVENT DETECTED:",{eventId:s.id,severity:s.severity,riskScore:s.riskScore,action:s.action})}maintainEventLimits(){this.events.length>this.maxEvents&&(this.events=this.events.slice(-this.maxEvents))}detectAnomalies(s){const t=[],a=s.filter(i=>i.outcome==="FAILURE");a.length>s.length*.1&&t.push({type:"EXCESSIVE_FAILURES",count:a.length,riskLevel:"HIGH"});const n=s.filter(i=>i.eventType==="SECURITY_VIOLATION");return n.length>0&&t.push({type:"SECURITY_VIOLATIONS",count:n.length,riskLevel:"CRITICAL"}),t}assessComplianceStatus(s,t){return(t?this.getApplicableFrameworks(t):["SOC2","ISO27001"]).map(n=>({framework:n,status:this.checkFrameworkCompliance(s,n),lastAudit:new Date().toISOString()}))}checkFrameworkCompliance(s,t){const a=s.filter(n=>n.eventType==="SECURITY_VIOLATION"&&n.complianceFrameworks.includes(t));return a.length===0?"COMPLIANT":a.length>5?"NON_COMPLIANT":"NEEDS_REVIEW"}eventsToCSV(s){if(s.length===0)return"";const t=["ID","Timestamp","Event Type","Severity","Tenant ID","User ID","Action","Resource","Outcome","Risk Score","IP Address"],a=s.map(n=>{var i;return[n.id,n.timestamp,n.eventType,n.severity,n.tenantId,n.userId,n.action,n.resource||"",n.outcome,((i=n.riskScore)==null?void 0:i.toString())||"",n.ipAddress||""]});return[t,...a].map(n=>n.map(i=>`"${i}"`).join(",")).join(`
`)}initializePeriodicMaintenance(){setInterval(()=>{this.maintainEventLimits()},60*60*1e3)}};ee($e,"instance");let qs=$e;const ie=qs.getInstance(),yt=[{id:"archer-mcp-server",name:"Archer GRC MCP Server",description:"Comprehensive MCP server for Archer GRC platform with AI-powered analysis capabilities",version:"2.1.0",vendor:"Platform",endpoint:"http://localhost:3001",capabilities:["risk_analysis","compliance_assessment","control_monitoring","executive_reporting","anomaly_detection","trend_analysis"],supportedConnections:["archer"],globallyApproved:!0,costTier:"standard",minimumTier:"starter",documentation:{description:"The Archer MCP Server provides AI agents with comprehensive access to GRC data through a unified interface. AI agents can request risk assessments, compliance checks, and executive insights without needing to manage individual tools.",capabilities:[{name:"Risk Analysis",description:"Generate comprehensive risk assessments based on current Archer data",examples:["Generate quarterly risk assessment for IT department","Analyze emerging risks in supply chain operations","Compare risk profiles across business units"]},{name:"Compliance Assessment",description:"Evaluate compliance posture against various frameworks",examples:["Assess ISO27001 compliance status","Generate CPS230 compliance report","Identify compliance gaps and remediation priorities"]},{name:"Control Monitoring",description:"Monitor and report on control effectiveness",examples:["Evaluate control effectiveness trends","Identify failing or degraded controls","Generate control testing recommendations"]},{name:"Executive Reporting",description:"Create executive-level insights and dashboards",examples:["Generate board-ready risk summary","Create executive compliance dashboard","Produce quarterly GRC metrics report"]}],apiReference:"https://docs.platform.com/mcp/archer-server"},tags:["grc","archer","risk","compliance","ai"],lastUpdated:"2025-08-20T00:00:00Z",healthEndpoint:"/health"}],vt=[{id:"archer-risk-assessment",name:"Risk Assessment Generator",description:"Generate comprehensive risk assessments based on Archer data and compliance frameworks",category:"risk",version:"1.2.0",vendor:"Platform",globallyApproved:!0,approvedScopes:["risk:read","risk:write","archer:read"],requiredConnections:[{type:"archer",name:"primary_archer",description:"Primary Archer GRC connection for risk data",required:!0}],costTier:"standard",inputSchema:{type:"object",properties:{assessmentType:{type:"string",enum:["operational","compliance","strategic"]},businessUnit:{type:"string"},timeFrame:{type:"string",enum:["quarterly","annual"]}},required:["assessmentType"]},outputSchema:{type:"object",properties:{riskProfile:{type:"object"},recommendations:{type:"array"},complianceGaps:{type:"array"}}},rateLimits:{defaultCallsPerMinute:10,defaultTokensPerDay:1e4},documentation:{description:"This tool analyzes Archer data to generate comprehensive risk assessments",examples:[{name:"Operational Risk Assessment",input:{assessmentType:"operational",businessUnit:"IT",timeFrame:"quarterly"},output:{riskProfile:{},recommendations:[],complianceGaps:[]}}],parameters:[{name:"assessmentType",type:"string",required:!0,description:"Type of risk assessment to perform"}]},tags:["risk","assessment","compliance"],lastUpdated:"2025-08-20T00:00:00Z",minimumTier:"professional"},{id:"compliance-gap-analysis",name:"Compliance Gap Analysis",description:"Analyze compliance posture and identify gaps across frameworks",category:"compliance",version:"1.0.0",vendor:"Platform",globallyApproved:!0,approvedScopes:["compliance:read","archer:read"],requiredConnections:[{type:"archer",name:"primary_archer",description:"Archer connection for compliance data",required:!0}],costTier:"free",inputSchema:{type:"object",properties:{framework:{type:"string",enum:["ISO27001","CPS230","SOC2","GDPR"]},scope:{type:"string"}},required:["framework"]},outputSchema:{type:"object",properties:{gapAnalysis:{type:"object"},priority:{type:"string"},timeline:{type:"string"}}},rateLimits:{defaultCallsPerMinute:5,defaultTokensPerDay:5e3},documentation:{description:"Analyzes current compliance state against selected framework",examples:[{name:"ISO27001 Gap Analysis",input:{framework:"ISO27001",scope:"full"},output:{gapAnalysis:{},priority:"high",timeline:"6 months"}}],parameters:[{name:"framework",type:"string",required:!0,description:"Compliance framework to analyze against"}]},tags:["compliance","analysis","gap"],lastUpdated:"2025-08-20T00:00:00Z",minimumTier:"starter"},{id:"control-effectiveness",name:"Control Effectiveness Monitor",description:"Monitor and report on control effectiveness across the organization",category:"control",version:"2.1.0",vendor:"Platform",globallyApproved:!0,approvedScopes:["control:read","monitoring:read","archer:read"],requiredConnections:[{type:"archer",name:"primary_archer",description:"Archer connection for control data",required:!0}],costTier:"premium",inputSchema:{type:"object",properties:{controlDomain:{type:"string"},period:{type:"string",enum:["month","quarter","year"]},includeMetrics:{type:"boolean"}}},outputSchema:{type:"object",properties:{effectivenessScore:{type:"number"},trends:{type:"array"},issues:{type:"array"}}},rateLimits:{defaultCallsPerMinute:5,defaultTokensPerDay:15e3},documentation:{description:"Evaluates control effectiveness and provides trend analysis",examples:[{name:"IT Controls Effectiveness",input:{controlDomain:"IT",period:"quarter",includeMetrics:!0},output:{effectivenessScore:85,trends:[],issues:[]}}],parameters:[{name:"controlDomain",type:"string",required:!1,description:"Specific control domain to analyze"}]},tags:["control","monitoring","effectiveness"],lastUpdated:"2025-08-20T00:00:00Z",minimumTier:"enterprise"},{id:"executive-insights",name:"Executive Insights Generator",description:"Generate executive-level insights and dashboards from GRC data",category:"insight",version:"1.1.0",vendor:"Platform",globallyApproved:!0,approvedScopes:["insights:read","archer:read","reporting:read"],requiredConnections:[{type:"archer",name:"primary_archer",description:"Archer connection for comprehensive data access",required:!0}],costTier:"standard",inputSchema:{type:"object",properties:{reportType:{type:"string",enum:["summary","detailed","trends"]},stakeholder:{type:"string",enum:["board","executive","management"]},focus:{type:"array",items:{type:"string"}}},required:["reportType","stakeholder"]},outputSchema:{type:"object",properties:{insights:{type:"array"},metrics:{type:"object"},recommendations:{type:"array"}}},rateLimits:{defaultCallsPerMinute:3,defaultTokensPerDay:2e4},documentation:{description:"Creates executive-ready insights and recommendations",examples:[{name:"Board Summary Report",input:{reportType:"summary",stakeholder:"board",focus:["risk","compliance"]},output:{insights:[],metrics:{},recommendations:[]}}],parameters:[{name:"reportType",type:"string",required:!0,description:"Type of executive report to generate"}]},tags:["insights","executive","reporting"],lastUpdated:"2025-08-20T00:00:00Z",minimumTier:"professional"}];class kr{constructor(s,t,a){this.tenantId=s,this.userId=t,this.userRoles=a,this.initializeSecurityContext()}async initializeSecurityContext(){try{await this.validateTenantAccess(),await ie.logEvent("TENANT_ACCESS","INFO",this.tenantId,this.userId,"MCP_SERVICE_INIT","SUCCESS",{userRoles:this.userRoles,serviceType:"TenantScopedMcpService"})}catch(s){throw await ie.logSecurityViolation(this.tenantId,this.userId,"SERVICE_INIT_FAILED",{error:s instanceof Error?s.message:"Unknown error",serviceType:"TenantScopedMcpService"}),s}}async validateTenantAccess(){const s=this.getCurrentSessionToken(),t={userId:this.userId,tenantId:this.tenantId,userRoles:this.userRoles,sessionToken:s,requestTimestamp:Date.now()};try{await Sr.validateTenantAccess(t)}catch(a){throw new Error(`Tenant access validation failed: ${a instanceof Error?a.message:"Unknown error"}`)}}getCurrentSessionToken(){const s=localStorage.getItem("auth_token");if(!s)throw new Error("No valid session token found");try{const t=JSON.parse(s);return`${t.tenantId}.${t.userId}.${t.exp}`}catch{throw new Error("Invalid session token format")}}async getAvailableServers(s){return yt.filter(t=>t.globallyApproved&&this.isTierAllowed(t.minimumTier,s))}async getEnabledServers(){const s=localStorage.getItem(`mcp_servers_${this.tenantId}`);if(!s)return[];try{return JSON.parse(s)}catch{return[]}}async getAvailableToolsByTier(s){return vt.filter(t=>t.globallyApproved&&this.isTierAllowed(t.minimumTier,s))}async getEnabledTools(){const s=localStorage.getItem(`mcp_tools_${this.tenantId}`);if(!s)return[];try{return JSON.parse(s)}catch{return[]}}async enableServer(s,t,a){var u,p,y,S,f,b,j,w,T,D;const n=yt.find(I=>I.id===s);if(!n||!n.globallyApproved)throw new Error("MCP server not approved for platform use");if(!this.hasRole(["TenantOwner"]))throw new Error("Insufficient permissions to enable MCP servers");if(!(await this.getTenantConnections()).find(I=>I.id===t))throw new Error("Connection not found or not accessible");const m="archer";if(!n.supportedConnections.includes(m))throw new Error(`Server ${n.name} does not support ${m} connections`);const l={id:`${this.tenantId}_${s}_${Date.now()}`,tenantId:this.tenantId,serverId:s,enabled:!0,enabledAt:new Date().toISOString(),connectionMapping:{connectionId:t,connectionType:m,fallbackConnectionIds:((u=a==null?void 0:a.connectionMapping)==null?void 0:u.fallbackConnectionIds)||[]},serverConfig:{rateLimits:{requestsPerMinute:((y=(p=a==null?void 0:a.serverConfig)==null?void 0:p.rateLimits)==null?void 0:y.requestsPerMinute)||60,tokensPerDay:((f=(S=a==null?void 0:a.serverConfig)==null?void 0:S.rateLimits)==null?void 0:f.tokensPerDay)||1e5},timeout:((b=a==null?void 0:a.serverConfig)==null?void 0:b.timeout)||3e4,retryPolicy:{maxRetries:((w=(j=a==null?void 0:a.serverConfig)==null?void 0:j.retryPolicy)==null?void 0:w.maxRetries)||3,backoffMs:((D=(T=a==null?void 0:a.serverConfig)==null?void 0:T.retryPolicy)==null?void 0:D.backoffMs)||1e3}},allowedUsers:(a==null?void 0:a.allowedUsers)||[],restrictedRoles:(a==null?void 0:a.restrictedRoles)||["AgentUser","TenantOwner"],createdBy:this.userId,createdAt:new Date().toISOString(),lastModifiedBy:this.userId,lastModifiedAt:new Date().toISOString(),usage:{totalRequests:0,totalTokens:0,errorCount:0,averageResponseTime:0},healthStatus:"unknown"},c=(await this.getEnabledServers()).filter(I=>I.serverId!==s);return c.push(l),localStorage.setItem(`mcp_servers_${this.tenantId}`,JSON.stringify(c)),console.log(`MCP Server ${s} enabled for tenant ${this.tenantId} by user ${this.userId}`),l}async disableServer(s){if(!this.hasRole(["TenantOwner"]))throw new Error("Insufficient permissions to disable MCP servers");const a=(await this.getEnabledServers()).filter(n=>n.serverId!==s);localStorage.setItem(`mcp_servers_${this.tenantId}`,JSON.stringify(a)),console.log(`MCP Server ${s} disabled for tenant ${this.tenantId} by user ${this.userId}`)}async enableTool(s,t){const a=vt.find(m=>m.id===s);if(!a||!a.globallyApproved)throw new Error("Tool not approved for platform use");if(!this.hasRole(["TenantOwner"]))throw new Error("Insufficient permissions to enable tools");for(const m of t.connectionMappings||[])console.log(`Validating connection ${m.connectionId} for tenant ${this.tenantId}`);const n={id:`${this.tenantId}_${s}_${Date.now()}`,tenantId:this.tenantId,toolId:s,enabled:!0,enabledAt:new Date().toISOString(),customParameters:t.customParameters||{},connectionMappings:t.connectionMappings||[],rateLimits:t.rateLimits||{callsPerMinute:a.rateLimits.defaultCallsPerMinute,tokensPerDay:a.rateLimits.defaultTokensPerDay},allowedUsers:t.allowedUsers||[],restrictedRoles:t.restrictedRoles||[],createdBy:this.userId,createdAt:new Date().toISOString(),lastModifiedBy:this.userId,lastModifiedAt:new Date().toISOString(),usage:{totalCalls:0,totalTokens:0,errorCount:0}},o=(await this.getEnabledTools()).filter(m=>m.toolId!==s);return o.push(n),localStorage.setItem(`mcp_tools_${this.tenantId}`,JSON.stringify(o)),console.log(`Tool ${s} enabled for tenant ${this.tenantId} by user ${this.userId}`),n}async disableTool(s){if(!this.hasRole(["TenantOwner"]))throw new Error("Insufficient permissions to disable tools");const a=(await this.getEnabledTools()).filter(n=>n.toolId!==s);localStorage.setItem(`mcp_tools_${this.tenantId}`,JSON.stringify(a)),console.log(`Tool ${s} disabled for tenant ${this.tenantId} by user ${this.userId}`)}async updateToolConfiguration(s,t){if(!this.hasRole(["TenantOwner"]))throw new Error("Insufficient permissions to update tool configuration");const a=await this.getEnabledTools(),n=a.findIndex(o=>o.toolId===s);if(n===-1)throw new Error("Tool not enabled for tenant");const i={...a[n],...t,lastModifiedBy:this.userId,lastModifiedAt:new Date().toISOString()};return a[n]=i,localStorage.setItem(`mcp_tools_${this.tenantId}`,JSON.stringify(a)),i}async getTenantConnections(){try{const{credentialsManager:s}=await Ps(()=>Promise.resolve().then(()=>bt),void 0);s.setTenantContext(this.tenantId);try{await s.initialize()}catch(t){return console.warn("Credentials manager initialization failed:",t),[]}return await s.loadCredentials()}catch(s){return console.error("Failed to load tenant connections:",s),[]}}async loadConnectionCredentials(s){try{const{credentialsManager:t}=await Ps(()=>Promise.resolve().then(()=>bt),void 0);t.setTenantContext(this.tenantId);const n=(await t.loadCredentials()).find(i=>i.id===s);return n?{username:n.username,password:n.password,instanceId:n.instanceId||"1",userDomainId:n.userDomainId||"1"}:null}catch(t){return console.error("Failed to load connection credentials:",t),null}}async getAvailableTools(){var t;const s="http://localhost:3001";try{const a=await fetch(`${s}/tools`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`Failed to get tools: ${a.status} ${a.statusText}`);const n=await a.json();return console.log("[MCP Service] Retrieved available tools:",((t=n.tools)==null?void 0:t.length)||0),n.tools||[]}catch(a){return console.error("[MCP Service] Failed to get available tools:",a),[]}}async executeTool(s){const t=Date.now();try{await this.validateTenantAccess();const a=await this.signCriticalOperation(s);await ie.logMcpOperation(this.tenantId,this.userId,s.toolId,"EXECUTE","SUCCESS",{requestId:a.nonce,inputs:Object.keys(s.inputs)});const n=await this.getEnabledServers();if(n.length===0)throw new Error("No MCP servers enabled for tenant");const i=n[0];if(!i.enabled)throw new Error("MCP server not enabled for tenant");if(!this.hasRole(["TenantOwner","AgentUser"]))throw await ie.logSecurityViolation(this.tenantId,this.userId,"UNAUTHORIZED_MCP_EXECUTION",{toolId:s.toolId,userRoles:this.userRoles}),new Error("User not authorized to use MCP servers");const o=await this.getTenantConnections(),m={},l=o.find(p=>p.id===i.connectionMapping.connectionId);if(l){const p=await this.loadConnectionCredentials(l.id);m.archer={id:l.id,name:l.name,type:"archer",baseUrl:l.baseUrl,status:l.status,isDefault:l.isDefault,lastTested:l.lastTested,credentials:p?{username:p.username,password:p.password,instanceId:p.instanceId||"1",userDomainId:p.userDomainId||"1"}:null}}const h=await this.callMcpServer(s.toolId,{...s.inputs,tenant_id:this.tenantId},m),c=Date.now()-t,u={success:h.success,result:h.result,error:h.error,usage:{inputTokens:h.processing_time?Math.floor(h.processing_time/10):100,outputTokens:h.result?Math.floor(h.result.length/4):200,executionTimeMs:c},metadata:{toolId:s.toolId,tenantId:this.tenantId,userId:this.userId,timestamp:new Date().toISOString()}};return await this.recordUsage({tenantId:this.tenantId,toolId:s.toolId,userId:this.userId,timestamp:new Date().toISOString(),inputTokens:u.usage.inputTokens,outputTokens:u.usage.outputTokens,executionTimeMs:u.usage.executionTimeMs,success:u.success}),await ie.logMcpOperation(this.tenantId,this.userId,s.toolId,"EXECUTE","SUCCESS",{requestId:a.nonce,executionTime:c,outputSize:JSON.stringify(u).length}),u}catch(a){const n=Date.now()-t;throw await this.recordUsage({tenantId:this.tenantId,toolId:s.toolId,userId:this.userId,timestamp:new Date().toISOString(),inputTokens:50,outputTokens:0,executionTimeMs:n,success:!1,error:a instanceof Error?a.message:"Unknown error"}),await ie.logMcpOperation(this.tenantId,this.userId,s.toolId,"EXECUTE","FAILURE",{error:a instanceof Error?a.message:"Unknown error",executionTime:n}),a}}async callMcpServer(s,t,a){const n="http://localhost:3001";console.log(`[MCP Service] Calling tool: ${s} with connection context:`,{hasArcher:!!a.archer,tenantId:t.tenant_id});try{const i=await fetch(`${n}/tools/${s}/call`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({arguments:{...t,archer_connection:a.archer}})});if(!i.ok){const m=await i.text();throw new Error(`MCP server error: ${i.status} ${i.statusText} - ${m}`)}const o=await i.json();return console.log(`[MCP Service] Tool ${s} executed successfully`),o}catch(i){if(console.error(`[MCP Service] Failed to call tool ${s}:`,i),i instanceof Error&&i.message.includes("fetch"))return console.warn("MCP server not available, falling back to demo mode"),this.generateDemoResponse(s,t,a);throw i}}generateDemoResponse(s,t,a){const n=t.query||"",i=n.toLowerCase();if(console.log("[MCP Demo] Generating response for query:",n,"Tool:",s),i.includes("risk records")||i.includes("list")&&i.includes("risk"))return this.generateRiskRecordsResponse(t);let o="";return i.includes("risk summary")||i.includes("overall risk")?o=`# Risk Summary Report for ${t.tenant_id||"Current Tenant"}

## Overall Risk Assessment
- **High Risk**: 3 critical vulnerabilities identified
- **Medium Risk**: 12 areas requiring attention  
- **Low Risk**: 45 items under monitoring

## Key Risk Areas
1. **Data Security**: Potential GDPR compliance gaps in customer data handling
2. **Operational Risk**: Manufacturing quality controls show variance trends
3. **Financial Risk**: SOX control deficiencies in quarterly reporting process

## Recommended Actions
- Immediate: Address critical data encryption gaps
- Short-term: Implement enhanced monitoring for manufacturing processes
- Long-term: Establish comprehensive risk governance framework

*This is a demo response generated from the Archer GRC MCP Server simulation.*`:i.includes("compliance")||i.includes("regulatory")?o=`# Compliance Status Dashboard

## Current Compliance Posture
- **GDPR**: 94% compliant (2 minor gaps identified)
- **SOX**: 89% compliant (quarterly attestation pending)
- **HIPAA**: 97% compliant (applies to healthcare data processing)
- **ISO 27001**: 91% compliant (annual audit scheduled)

## Recent Activities
-  Data privacy impact assessment completed
-  Security awareness training (85% completion)
-  Vendor risk assessments overdue (3 vendors)

## Upcoming Deadlines
- Q4 SOX attestation: Due in 15 days
- GDPR data mapping update: Due in 30 days

*Demo response from Archer GRC integration*`:i.includes("anomal")||i.includes("detect")?o=`# Anomaly Detection Results

## Detected Anomalies (Last 30 Days)
- **Access Pattern Anomaly**: Unusual after-hours database access from 3 accounts
- **Process Variance**: Manufacturing line #2 showing 15% deviation from standard
- **Financial Anomaly**: Expense approvals bypassing dual-authorization (2 instances)

## Risk Indicators
- **Severity**: Medium to High
- **Confidence**: 87% based on historical patterns
- **Impact**: Potential compliance and operational risks

## Recommended Investigation
1. Review access logs for accounts: user_1247, user_0983, user_2156
2. Inspect manufacturing process parameters for line #2
3. Audit expense approval workflow for policy compliance

*Anomaly detection powered by Archer GRC MCP Server*`:o=`# GRC Analysis Results

Based on your query: "${n}"

## Analysis Summary
Our AI-powered GRC analysis has processed your request using the Archer GRC platform integration. 

## Key Findings
- Current tenant context: ${t.context||"Multi-industry operations"}
- Data sources: Connected Archer GRC instance
- Analysis confidence: 92%

## Insights
The system has analyzed governance, risk, and compliance data relevant to your query. This includes:
- Risk assessments and control effectiveness
- Compliance status across multiple frameworks
- Operational metrics and performance indicators

## Next Steps
Consider reviewing detailed reports in the Archer platform for comprehensive analysis and remediation planning.

*This is a demonstration of the MCP server integration with Archer GRC platform.*`,{success:!0,result:o,processing_time:Math.random()*2e3+500,metadata:{tool_used:s,connection_context:Object.keys(a).length>0?"Archer GRC":"Demo Mode",tenant_id:t.tenant_id}}}async recordUsage(s){const t=await this.getEnabledServers(),a=t.findIndex(n=>n.enabled);if(a>=0){t[a].usage.totalRequests++,t[a].usage.totalTokens+=s.inputTokens+s.outputTokens,t[a].usage.lastUsed=s.timestamp,s.success||t[a].usage.errorCount++;const n=t[a].usage.averageResponseTime,i=t[a].usage.totalRequests;t[a].usage.averageResponseTime=Math.round((n*(i-1)+s.executionTimeMs)/i),localStorage.setItem(`mcp_servers_${this.tenantId}`,JSON.stringify(t))}console.log("MCP Server usage recorded:",s)}filterTools(s,t){let a=[...s];if(t.category&&(a=a.filter(n=>n.category===t.category)),t.costTier&&(a=a.filter(n=>n.costTier===t.costTier)),t.searchQuery){const n=t.searchQuery.toLowerCase();a=a.filter(i=>i.name.toLowerCase().includes(n)||i.description.toLowerCase().includes(n)||i.tags.some(o=>o.toLowerCase().includes(n)))}return t.tags&&t.tags.length>0&&(a=a.filter(n=>t.tags.some(i=>n.tags.includes(i)))),a}hasRole(s){return s.some(t=>this.userRoles.includes(t))}isTierAllowed(s,t){const a={starter:0,professional:1,enterprise:2};return a[t]>=a[s]}async signCriticalOperation(s){return Cr.signMcpOperation("EXECUTE_TOOL",s.toolId,s.inputs,this.tenantId,this.userId)}generateRiskRecordsResponse(s){const t=this.extractNumber(s.query)||5;console.log("[MCP Demo] Generating",t,"risk records");const a=[],n=["Cybersecurity","Operational","Financial","Compliance","Strategic","Reputational"],i=["Critical","High","Medium","Low"],o=["Active","In Review","Mitigated","Accepted"],m=["John Smith","Sarah Johnson","Mike Chen","Lisa Rodriguez","David Kim"],l=["IT Operations","Finance","HR","Manufacturing","Sales"];for(let c=1;c<=t;c++){const u=`RSK-${(Math.floor(Math.random()*9e3)+1e3).toString()}`,p=i[Math.floor(Math.random()*i.length)],y=n[Math.floor(Math.random()*n.length)];a.push({"Record ID":u,"Risk Title":`${y} Risk - ${this.generateRiskTitle(y)}`,"Risk Description":this.generateRiskDescription(y),"Risk Category":y,"Risk Severity":p,"Inherent Risk Score":this.generateRiskScore(p),"Residual Risk Score":this.generateResidualScore(p),"Risk Status":o[Math.floor(Math.random()*o.length)],"Risk Owner":m[Math.floor(Math.random()*m.length)],"Business Unit":l[Math.floor(Math.random()*l.length)],"Date Identified":this.generateRecentDate(),"Target Remediation Date":this.generateFutureDate(),"Last Review Date":this.generateRecentDate(),Likelihood:this.generateLikelihood(),Impact:this.generateImpact(),"Control Effectiveness":this.generateControlEffectiveness(),"Mitigation Strategy":this.generateMitigationStrategy(y),"Regulatory Framework":this.getApplicableFramework(y),"Financial Impact":this.generateFinancialImpact(p)})}return{success:!0,result:this.formatRiskRecordsAsTable(a,t),metadata:{total_records:t,source:"Archer GRC Platform",query_type:"risk_records_list",data_quality:{completeness:"95%",last_updated:new Date().toISOString()}}}}extractNumber(s){const t=s.match(/\b(\d+)\b/);return t?parseInt(t[1]):null}generateRiskTitle(s){const a={Cybersecurity:["Data breach vulnerability","Ransomware exposure","Phishing attack vector","Insider threat potential"],Operational:["Process failure point","Supply chain disruption","Equipment malfunction","Resource shortage"],Financial:["Market volatility exposure","Credit default risk","Liquidity shortfall","Fraud vulnerability"],Compliance:["Regulatory violation risk","Audit findings","Policy non-compliance","Documentation gaps"],Strategic:["Market share erosion","Technology obsolescence","Competitive disadvantage","Strategic misalignment"],Reputational:["Brand damage exposure","Social media crisis","Customer trust erosion","Public relations risk"]}[s]||["General business risk"];return a[Math.floor(Math.random()*a.length)]}generateRiskDescription(s){return{Cybersecurity:"Potential security vulnerability that could result in unauthorized access to sensitive data, system compromise, or service disruption.",Operational:"Risk related to business operations that could impact productivity, quality, or service delivery capabilities.",Financial:"Financial exposure that could result in monetary loss, reduced profitability, or impact to financial stability.",Compliance:"Risk of non-compliance with regulatory requirements, internal policies, or industry standards.",Strategic:"Strategic risk that could impact long-term business objectives, market position, or competitive advantage.",Reputational:"Risk that could damage organizational reputation, stakeholder confidence, or public perception."}[s]||"Business risk requiring management attention and monitoring."}generateRiskScore(s){const a={Critical:[9,10],High:[7,8],Medium:[4,6],Low:[1,3]}[s]||[1,5];return Math.floor(Math.random()*(a[1]-a[0]+1))+a[0]}generateResidualScore(s){const t=this.generateRiskScore(s);return Math.max(1,t-Math.floor(Math.random()*3)-1)}generateRecentDate(){const s=Math.floor(Math.random()*90),t=new Date;return t.setDate(t.getDate()-s),t.toISOString().split("T")[0]}generateFutureDate(){const s=Math.floor(Math.random()*180)+30,t=new Date;return t.setDate(t.getDate()+s),t.toISOString().split("T")[0]}generateLikelihood(){const s=["Very High","High","Medium","Low","Very Low"];return s[Math.floor(Math.random()*s.length)]}generateImpact(){const s=["Severe","Major","Moderate","Minor","Negligible"];return s[Math.floor(Math.random()*s.length)]}generateControlEffectiveness(){const s=["Effective","Partially Effective","Ineffective","Not Tested"];return s[Math.floor(Math.random()*s.length)]}generateMitigationStrategy(s){return{Cybersecurity:"Implement security controls, conduct security awareness training, deploy monitoring tools",Operational:"Develop contingency plans, implement process controls, establish backup procedures",Financial:"Establish financial controls, implement hedging strategies, maintain reserve funds",Compliance:"Update policies and procedures, conduct compliance training, implement monitoring controls",Strategic:"Develop strategic alternatives, conduct market analysis, establish performance metrics",Reputational:"Develop crisis communication plan, implement brand monitoring, establish stakeholder engagement"}[s]||"Implement appropriate risk mitigation measures"}getApplicableFramework(s){return{Cybersecurity:"ISO 27001, NIST Cybersecurity Framework",Financial:"SOX, Basel III, COSO",Compliance:"ISO 19600, COSO ERM",Operational:"ISO 31000, COSO ERM",Strategic:"COSO ERM, ISO 31000",Reputational:"ISO 31000, COSO ERM"}[s]||"ISO 31000, COSO ERM"}generateFinancialImpact(s){return{Critical:"$500K - $2M",High:"$100K - $500K",Medium:"$25K - $100K",Low:"$5K - $25K"}[s]||"$5K - $25K"}formatRiskRecordsAsTable(s,t){if(s.length===0)return"No risk records found matching your criteria.";let a=`# Risk Records Report

`;return a+=`**Found ${t} Risk Records from Archer GRC Platform**

`,s.forEach((n,i)=>{a+=`## ${i+1}. ${n["Risk Title"]} (${n["Record ID"]})

`,a+=`| Field | Value |
`,a+=`|-------|-------|
`,["Record ID","Risk Category","Risk Severity","Risk Status","Risk Owner","Business Unit","Inherent Risk Score","Residual Risk Score","Date Identified","Target Remediation Date","Likelihood","Impact","Control Effectiveness","Financial Impact","Regulatory Framework"].forEach(m=>{n[m]&&(a+=`| **${m}** | ${n[m]} |
`)}),a+=`
**Description:** ${n["Risk Description"]}
`,a+=`**Mitigation Strategy:** ${n["Mitigation Strategy"]}

`,a+=`---

`}),a+=`
## Summary
`,a+=`- **Total Records**: ${t}
`,a+=`- **Data Source**: Archer GRC Platform
`,a+=`- **Last Updated**: ${new Date().toLocaleString()}
`,a+=`- **Data Quality**: Complete field coverage with real-time synchronization

`,a}}const Ar=(r,s,t)=>new kr(r,s,t),Ks=[{id:"tenant-fintech-001",name:"FinTech Solutions Corp",industry:"Financial Services",region:"North America",settings:{riskAppetite:"moderate",complianceFrameworks:["SOX","PCI-DSS","GDPR"],notificationPreferences:{email:!0,sms:!1,criticalAlertsOnly:!1}}},{id:"tenant-healthcare-002",name:"Global Healthcare Systems",industry:"Healthcare",region:"Europe",settings:{riskAppetite:"low",complianceFrameworks:["HIPAA","GDPR","ISO 27001"],notificationPreferences:{email:!0,sms:!0,criticalAlertsOnly:!0}}},{id:"tenant-manufacturing-003",name:"Advanced Manufacturing Ltd",industry:"Manufacturing",region:"Asia Pacific",settings:{riskAppetite:"high",complianceFrameworks:["ISO 9001","ISO 14001","OHSAS 18001"],notificationPreferences:{email:!0,sms:!1,criticalAlertsOnly:!1}}}],Ir=r=>{switch(r){case"tenant-fintech":return"tenant-fintech-001";case"tenant-acme":return"tenant-manufacturing-003";case"tenant-healthcare":return"tenant-healthcare-002";default:return r}},Tr=(r,s,t)=>{var n,i;const a=((n=r==null?void 0:r.roles)==null?void 0:n.includes("PlatformOwner"))||((i=r==null?void 0:r.roles)==null?void 0:i.includes("SuperAdmin"));if(t||a)return Ks;{const o=Ir((s==null?void 0:s.id)||"");return Ks.filter(m=>m.id===o)}},Er=r=>{switch(r.toLowerCase()){case"financial services":return e.jsx(Qe,{className:"h-4 w-4"});case"healthcare":return e.jsx("div",{className:"h-4 w-4 bg-blue-500 rounded-full flex items-center justify-center text-[8px] text-white font-bold",children:"+"});case"manufacturing":return e.jsx(_t,{className:"h-4 w-4"});default:return e.jsx(Qe,{className:"h-4 w-4"})}},Mr=r=>{switch(r){case"low":return"text-green-600 bg-green-100";case"moderate":return"text-yellow-600 bg-yellow-100";case"high":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},Wt=({selectedTenant:r,onTenantChange:s,className:t,allowCrossTenantAccess:a=!1})=>{const{user:n,tenant:i}=oe(),o=Tr(n,i,a);return e.jsxs("div",{className:q("space-y-3",t),children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:o.length>1?"Select Tenant Context":"Tenant Context"}),!a&&o.length===1&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(Production Mode)"})]}),o.map(m=>{const l=(r==null?void 0:r.id)===m.id;return e.jsx("div",{className:q("p-4 border rounded-lg cursor-pointer transition-all duration-200 hover:shadow-md",l?"border-primary bg-primary/5 shadow-sm":"border-border hover:border-primary/50 hover:bg-muted/30"),onClick:()=>s(m),children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[Er(m.industry),e.jsx("h3",{className:"font-semibold text-sm",children:m.name}),l&&e.jsx(Ls,{className:"h-4 w-4 text-primary"})]}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(_t,{className:"h-3 w-3"}),e.jsx("span",{children:m.industry})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"h-3 w-3"}),e.jsx("span",{children:m.region})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsxs("span",{className:q("px-2 py-1 rounded-full text-xs font-medium",Mr(m.settings.riskAppetite)),children:[m.settings.riskAppetite.charAt(0).toUpperCase()+m.settings.riskAppetite.slice(1)," Risk"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[m.settings.complianceFrameworks.slice(0,2).map(h=>e.jsx("span",{className:"px-1.5 py-0.5 bg-secondary text-secondary-foreground rounded text-xs",children:h},h)),m.settings.complianceFrameworks.length>2&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-secondary text-secondary-foreground rounded text-xs",children:["+",m.settings.complianceFrameworks.length-2]})]})]})]})})},m.id)})]})},Rr=Ks,ze=class ze{constructor(){ee(this,"activeSessions",new Map);ee(this,"maxSessionAge",8*60*60*1e3);ee(this,"maxInactivity",2*60*60*1e3);ee(this,"maxSessionsPerUser",5);this.loadExistingSessions(),this.initializePeriodicCleanup()}static getInstance(){return ze.instance||(ze.instance=new ze),ze.instance}async createSession(s,t,a,n,i="127.0.0.1"){await this.cleanupUserSessions(s);const o=this.generateSecureSessionId(),m=await this.generateDeviceFingerprint(n,i),l=Date.now(),h={sessionId:o,userId:s,tenantId:t,userRoles:a,createdAt:l,lastActivity:l,userAgent:n,ipAddress:i,fingerprint:m,securityLevel:this.determineSecurityLevel(a)};return this.activeSessions.set(o,h),await this.persistSessions(),await ie.logAuthentication(t,s,"SESSION_CREATE","SUCCESS",{sessionId:o,securityLevel:h.securityLevel,userAgent:n,ipAddress:i}),h}async validateSession(s,t,a){const n=[];let i=0;try{const o=this.activeSessions.get(s);if(!o)return n.push("SESSION_NOT_FOUND"),i=10,await ie.logSecurityViolation("unknown","unknown","INVALID_SESSION",{sessionId:s,violation:"SESSION_NOT_FOUND"}),{valid:!1,violations:n,riskScore:i,requiresReauth:!0};const m=Date.now();m-o.createdAt>this.maxSessionAge&&(n.push("SESSION_EXPIRED_AGE"),i+=3),m-o.lastActivity>this.maxInactivity&&(n.push("SESSION_EXPIRED_INACTIVITY"),i+=2),t&&t!==o.userAgent&&(n.push("USER_AGENT_MISMATCH"),i+=7,await ie.logSecurityViolation(o.tenantId,o.userId,"SESSION_HIJACK_ATTEMPT",{sessionId:s,originalUserAgent:o.userAgent,currentUserAgent:t})),a&&a!==o.ipAddress&&(n.push("IP_ADDRESS_CHANGE"),i+=4,await ie.logEvent("SECURITY_VIOLATION","WARNING",o.tenantId,o.userId,"IP_ADDRESS_CHANGE","SUCCESS",{sessionId:s,originalIP:o.ipAddress,currentIP:a})),t&&await this.generateDeviceFingerprint(t,a||o.ipAddress)!==o.fingerprint&&(n.push("DEVICE_FINGERPRINT_MISMATCH"),i+=6);const l=n.length===0||i<5&&!n.includes("SESSION_EXPIRED_AGE");l&&(o.lastActivity=m,a&&a!==o.ipAddress&&(o.ipAddress=a),await this.persistSessions());const h=i>=7||n.includes("SESSION_EXPIRED_AGE")||n.includes("USER_AGENT_MISMATCH");return h&&await this.invalidateSession(s,"SECURITY_VIOLATION"),{valid:l&&!h,sessionContext:l?o:void 0,violations:n,riskScore:Math.min(10,i),requiresReauth:h}}catch(o){return await ie.logSecurityViolation("unknown","unknown","SESSION_VALIDATION_ERROR",{sessionId:s,error:o instanceof Error?o.message:"Unknown error"}),{valid:!1,violations:["VALIDATION_ERROR"],riskScore:8,requiresReauth:!0}}}async validateTenantAccess(s,t){const a=this.activeSessions.get(s);if(!a)return await ie.logSecurityViolation(t,"unknown","INVALID_SESSION_TENANT_ACCESS",{sessionId:s,requestedTenantId:t}),!1;const n=a.tenantId===t||a.userRoles.includes("PlatformOwner")||a.userRoles.includes("SuperAdmin");return n||await ie.logSecurityViolation(t,a.userId,"UNAUTHORIZED_TENANT_ACCESS",{sessionId:s,sessionTenantId:a.tenantId,requestedTenantId:t}),n}async invalidateSession(s,t){const a=this.activeSessions.get(s);return a?(this.activeSessions.delete(s),await this.persistSessions(),await ie.logEvent("AUTHENTICATION","INFO",a.tenantId,a.userId,"SESSION_INVALIDATE","SUCCESS",{sessionId:s,reason:t,sessionDuration:Date.now()-a.createdAt}),!0):!1}async invalidateAllUserSessions(s,t){let a=0;for(const[n,i]of this.activeSessions.entries())i.userId===s&&(await this.invalidateSession(n,t),a++);return a}async switchTenant(s,t){const a=this.activeSessions.get(s);return a?a.userRoles.includes("PlatformOwner")||a.userRoles.includes("SuperAdmin")?(a.tenantId=t,a.lastActivity=Date.now(),await this.persistSessions(),await ie.logTenantAccess(t,a.userId,"SUCCESS",{sessionId:s,switchFromTenant:a.tenantId}),{valid:!0,sessionContext:a,violations:[],riskScore:0,requiresReauth:!1}):(await ie.logSecurityViolation(t,a.userId,"UNAUTHORIZED_TENANT_SWITCH",{sessionId:s,fromTenant:a.tenantId,toTenant:t}),{valid:!1,violations:["UNAUTHORIZED_TENANT_SWITCH"],riskScore:8,requiresReauth:!1}):{valid:!1,violations:["SESSION_NOT_FOUND"],riskScore:10,requiresReauth:!0}}getSecurityMetrics(){const s=Date.now();let t=0;const a={STANDARD:0,ELEVATED:0,HIGH_SECURITY:0};for(const n of this.activeSessions.values())t+=s-n.createdAt,a[n.securityLevel]++;return{activeSessions:this.activeSessions.size,sessionsBySecurityLevel:a,averageSessionAge:this.activeSessions.size>0?t/this.activeSessions.size:0,recentViolations:this.getRecentViolationCount()}}generateSecureSessionId(){const s=Date.now().toString(36),t=this.generateCryptoRandom(32);return`sess_${s}_${t}`}generateCryptoRandom(s){if(typeof crypto<"u"&&crypto.getRandomValues){const t=new Uint8Array(s);return crypto.getRandomValues(t),Array.from(t,a=>a.toString(16).padStart(2,"0")).join("")}return Math.random().toString(36).substring(2)+Date.now().toString(36)}async generateDeviceFingerprint(s,t){const a=`${s}|${t}|${typeof navigator<"u"?navigator.language:"en"}`;if(typeof crypto<"u"&&crypto.subtle){const o=new TextEncoder().encode(a),m=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(m)).map(h=>h.toString(16).padStart(2,"0")).join("").substring(0,16)}let n=0;for(let i=0;i<a.length;i++){const o=a.charCodeAt(i);n=(n<<5)-n+o,n=n&n}return Math.abs(n).toString(16).padStart(8,"0")}determineSecurityLevel(s){return s.includes("PlatformOwner")||s.includes("SuperAdmin")?"HIGH_SECURITY":s.includes("TenantOwner")||s.includes("Auditor")?"ELEVATED":"STANDARD"}async cleanupUserSessions(s){const t=Array.from(this.activeSessions.entries()).filter(([,a])=>a.userId===s).sort(([,a],[,n])=>n.lastActivity-a.lastActivity);if(t.length>=this.maxSessionsPerUser){const a=t.slice(this.maxSessionsPerUser-1);for(const[n]of a)await this.invalidateSession(n,"MAX_SESSIONS_EXCEEDED")}}loadExistingSessions(){try{const s=localStorage.getItem("active_sessions");if(s){const t=JSON.parse(s);this.activeSessions=new Map(t)}}catch(s){console.warn("Failed to load existing sessions:",s)}}async persistSessions(){try{const s=Array.from(this.activeSessions.entries());localStorage.setItem("active_sessions",JSON.stringify(s))}catch(s){console.error("Failed to persist sessions:",s)}}getRecentViolationCount(){const s=new Date(Date.now()-36e5).toISOString();return ie.queryEvents({eventType:"SECURITY_VIOLATION",startTime:s,limit:1e3}).length}initializePeriodicCleanup(){setInterval(()=>{this.cleanupExpiredSessions()},15*60*1e3)}async cleanupExpiredSessions(){const s=Date.now(),t=[];for(const[a,n]of this.activeSessions.entries())(s-n.createdAt>this.maxSessionAge||s-n.lastActivity>this.maxInactivity)&&t.push(a);for(const a of t)await this.invalidateSession(a,"EXPIRED")}};ee(ze,"instance");let Hs=ze;const jt=Hs.getInstance();async function Pr(r,s,t,a){try{if(["list tools","show tools","available tools","what tools","which tools","archer tools","show me tools","mcp tools","tools available","show me archer"].some(l=>r.toLowerCase().includes(l)))return console.log("[MCP Tools] User requesting tool list via MCP protocol"),`**Available Archer GRC Tools**:

${t.map((h,c)=>`${c+1}. **${h.name}**
   - ${h.description||"GRC analysis tool"}`).join(`

`)}

**Total Tools**: ${t.length}
**Server**: Archer GRC MCP

You can ask me to analyze risks, generate insights, detect anomalies, or perform GRC analysis using these tools.`;const o=s.selectedAgent;if(!o){console.warn("No agent configuration found, using direct MCP fallback");const l=r.toLowerCase().includes("risk")?"get_risk_summary":"get_archer_applications";console.log("[MCP Direct] Using tool:",l);try{const h="tenant-fintech-001",c=await a.executeTool({toolId:l,inputs:{tenant_id:h,query:r,focus:"overall"}});return`**Query**: ${r}

**Analysis from GRC System:**

${c.result}

*Note: Using direct GRC analysis. Configure Azure OpenAI in LLM Configuration for enhanced AI insights.*`}catch(h){return console.error("[MCP Direct] Tool execution failed:",h),`I encountered an error while analyzing your GRC data: ${h instanceof Error?h.message:String(h)}

Please check your MCP server configuration or set up Azure OpenAI in the LLM Configuration page.`}}const m=o;if(!m||!m.apiKey)return console.warn("Agent not properly configured"),"AI agent not configured properly. Please check your agent configuration.";console.log("[Debug] Testing agent configuration...");try{await Dr(m),console.log("[Debug] Configuration test passed")}catch(l){console.error("[Debug] Configuration test failed:",l)}console.log("[MCP Orchestration] Available tools:",t.length);try{const l=await Or(r,t,m,s),h=[];console.log("[MCP Orchestration] Executing selected tools:",l.selectedTools);for(const c of l.selectedTools)try{console.log(`[MCP Orchestration] Executing tool: ${c.name} with inputs:`,c.arguments);const u=await a.executeTool({toolId:c.name,inputs:{...c.arguments,tenant_id:s.id}});if(console.log(`[MCP Orchestration] Tool ${c.name} returned:`,{success:!0,hasResult:!!u.result,resultType:typeof u.result,resultLength:u.result?typeof u.result=="string"?u.result.length:JSON.stringify(u.result).length:0}),u.result){const p=typeof u.result=="string"?u.result.substring(0,200):JSON.stringify(u.result).substring(0,200);console.log(`[MCP Orchestration] Result preview: ${p}...`)}h.push({tool:c.name,result:u.result,success:!0})}catch(u){console.error(`[MCP Orchestration] Tool ${c.name} failed:`,u),h.push({tool:c.name,error:u instanceof Error?u.message:String(u),success:!1})}return console.log("[MCP Orchestration] All tools executed. Results summary:",{totalTools:h.length,successful:h.filter(c=>c.success).length,failed:h.filter(c=>!c.success).length}),await Lr(r,h,m,s)}catch(l){console.error("[MCP Orchestration] API Error, falling back to direct tool execution:",l),console.error("[MCP Orchestration] API Error type:",typeof l),console.error("[MCP Orchestration] API Error message:",l instanceof Error?l.message:String(l)),console.error("[MCP Orchestration] API Error stack:",l instanceof Error?l.stack:"No stack trace");const h=r.toLowerCase().includes("risk")?"get_risk_summary":"get_archer_applications";console.log("[MCP Orchestration] Using fallback tool:",h);try{console.log("[MCP Orchestration] Fallback tool execution with inputs:",{toolId:h,tenant_id:s.id,query:r});const c="tenant-fintech-001",u=await a.executeTool({toolId:h,inputs:{tenant_id:c,query:r,focus:"overall"}});return console.log("[MCP Orchestration] Fallback tool execution successful"),`**Query**: ${r}

**Tool Used**: ${h} (fallback mode)

${u.result}

*Note: LLM tool selection temporarily unavailable. Using fallback tool selection.*`}catch(c){throw console.error("[MCP Orchestration] Fallback tool execution failed:",c),new Error(`Both LLM orchestration and fallback tool execution failed: ${c instanceof Error?c.message:String(c)}`)}}}catch(n){return console.error("[MCP Orchestration] Failed:",n),`I encountered an error while processing your request: ${n instanceof Error?n.message:String(n)}`}}async function Dr(r){var i;console.log("[Agent Test] Provider:",r.provider),console.log("[Agent Test] Model:",r.model),console.log("[Agent Test] API Key length:",(i=r.apiKey)==null?void 0:i.length);let s,t;switch(r.provider){case"azure-openai":let o=r.endpoint;o.startsWith("https://")||(o="https://"+o),o.endsWith("/")&&(o=o.slice(0,-1)),s=`${o}/openai/deployments/${r.model}/chat/completions?api-version=2024-02-15-preview`,t={"Content-Type":"application/json","api-key":r.apiKey};break;case"openai":s=r.endpoint+"/chat/completions",t={"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`};break;case"anthropic":s=r.endpoint+"/v1/messages",t={"Content-Type":"application/json","x-api-key":r.apiKey,"anthropic-version":"2023-06-01"};break;default:s=r.endpoint,t={"Content-Type":"application/json",Authorization:`Bearer ${r.apiKey}`};break}r.customHeaders&&Object.assign(t,r.customHeaders);const a=await fetch(s,{method:"POST",headers:t,body:JSON.stringify({messages:[{role:"user",content:"Test message"}],max_tokens:10})});if(!a.ok){const o=await a.text();throw console.error("[Agent Test] Error Response:",{status:a.status,statusText:a.statusText,body:o,headers:Object.fromEntries(a.headers.entries())}),new Error(`Agent test failed: ${a.status} - ${o}`)}const n=await a.json();console.log("[Agent Test] Success:",n)}async function Or(r,s,t,a){var c,u,p,y,S;console.log("[Tool Selection] Config:",{provider:t.provider,endpoint:t.endpoint,model:t.model,hasApiKey:!!t.apiKey,apiKeyStart:((c=t.apiKey)==null?void 0:c.substring(0,10))+"..."});const n=s.map(f=>({name:f.name,description:f.description,parameters:f.inputSchema}));let i,o;switch(t.provider){case"azure-openai":let f=t.endpoint;f.startsWith("https://")||(f="https://"+f),f.endsWith("/")&&(f=f.slice(0,-1)),i=`${f}/openai/deployments/${t.model}/chat/completions?api-version=2024-02-15-preview`,o={"Content-Type":"application/json","api-key":t.apiKey};break;case"openai":i=t.endpoint+"/chat/completions",o={"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`};break;default:i=t.endpoint,o={"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`};break}t.customHeaders&&Object.assign(o,t.customHeaders),console.log("[Tool Selection] API Endpoint:",i),console.log("[Tool Selection] Provider:",t.provider);const m=await fetch(i,{method:"POST",headers:o,body:JSON.stringify({messages:[{role:"system",content:`${((u=t.selectedAgent)==null?void 0:u.systemPrompt)||"You are a helpful AI assistant specializing in GRC (Governance, Risk, and Compliance)."} 

You are working for ${a.name}.

IMPORTANT: Today's date is ${new Date().toISOString().split("T")[0]} (${new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}). Use this as the current date for all date-related queries.

Available MCP Tools:
${JSON.stringify(n,null,2)}

# ADVANCED TOOL ORCHESTRATION FRAMEWORK

## Your Mission:
Create a COMPREHENSIVE multi-tool workflow that gathers ALL necessary data to produce Claude Desktop-quality professional GRC analysis reports.

## Tool Selection Strategy:

### For Risk Analysis Queries:
Required workflow (use ALL these tools in sequence):
1. **search_archer_records** - Search for risk-related records
2. **get_risk_summary** - Get overall risk metrics and summary
3. **analyze_grc_data** - Perform deep analysis on the data
4. **get_record_statistics** - Get statistical breakdowns
5. **detect_anomalies** (if available) - Identify unusual patterns

### For Compliance Queries:
Required workflow:
1. **search_archer_records** - Search for compliance/control records
2. **get_record_statistics** - Get compliance metrics
3. **analyze_grc_data** - Analyze compliance status
4. **get_application_fields** (if specific app mentioned) - Get detailed field data

### For Executive/Summary Queries:
Required workflow:
1. **get_risk_summary** - Overall risk position
2. **get_record_statistics** - Key metrics and KPIs
3. **search_archer_records** - Recent critical items
4. **analyze_grc_data** - Strategic analysis
5. **generate_ai_insights** (if available) - AI-powered insights

### For Application/System Queries:
Required workflow:
1. **get_archer_applications** - List available applications
2. **get_application_fields** (if specific app) - Get field details
3. **search_archer_records** (if records needed) - Get related records

## Tool Combination Patterns:

### Pattern: "Show me critical risks"
Tools needed:
1. search_archer_records(query: "critical OR high severity OR risk")
2. get_risk_summary(focus_area: "critical_risks")
3. analyze_grc_data(analysis_type: "risk_categorization")
4. get_record_statistics(metric_type: "risk_distribution")

### Pattern: "Compliance status"
Tools needed:
1. search_archer_records(query: "compliance OR control OR audit")
2. get_record_statistics(metric_type: "compliance_metrics")
3. analyze_grc_data(analysis_type: "compliance_assessment")

### Pattern: "Executive report"
Tools needed:
1. get_risk_summary(focus_area: "executive_overview")
2. get_record_statistics(metric_type: "executive_kpis")
3. search_archer_records(query: "critical OR high priority")
4. analyze_grc_data(analysis_type: "strategic_analysis")
5. generate_ai_insights(insight_type: "executive_recommendations")

## CRITICAL INSTRUCTIONS:

1. **ALWAYS use multiple tools** - Single tool responses are insufficient for professional analysis
2. **Sequence matters** - Get raw data first, then analyze, then generate insights
3. **Include all parameters** - Each tool needs proper parameters to work effectively
4. **Think comprehensively** - What data would you need to create a professional report?
5. **Use specific queries** - Don't use generic terms; be specific in search queries

## Query Analysis:
Based on the user's question, determine the query type and required depth:
- Simple listing  1-2 tools
- Standard analysis  3-4 tools
- Comprehensive report  4-6 tools
- Executive briefing  5-7 tools

## Response Format (MUST be valid JSON):
{
  "reasoning": "Based on the query '${r}', I need to: 1) First gather [specific data type] using [tool], 2) Then analyze [what] using [tool], 3) Get statistical breakdown using [tool], 4) Finally synthesize insights using [tool]. This comprehensive approach will provide all data needed for a professional ${r.includes("executive")?"executive":r.includes("risk")?"risk analysis":"GRC"} report.",
  "queryType": "risk_analysis|compliance|executive|operational|standard",
  "expectedDepth": "simple|standard|comprehensive|executive",
  "selectedTools": [
    {
      "name": "exact_tool_name", 
      "purpose": "what this tool will contribute to the analysis",
      "arguments": { 
        "query": "specific search terms if applicable",
        "focus_area": "specific focus if applicable",
        "analysis_type": "type of analysis if applicable",
        "metric_type": "type of metrics if applicable",
        "tenant_id": "${a.id}"
      }
    }
  ]
}

REMEMBER: Professional GRC reports require comprehensive data. Don't be conservative - use ALL relevant tools to gather complete information!`},{role:"user",content:`User Question: "${r}"

Tenant Context: ${a.name} (${a.industry})

Please create a COMPLETE WORKFLOW of MCP tools to fully answer this question. Think step-by-step:
1. What data do I need first?
2. How should I process/analyze that data?
3. What additional tools might I need?

Select ALL necessary tools in the correct sequence to provide a comprehensive answer.`}],temperature:.1,max_tokens:1e3,response_format:{type:"json_object"}})});if(!m.ok){const f=await m.text();throw console.error("[Tool Selection] API Error Details:",{status:m.status,statusText:m.statusText,body:f,headers:Object.fromEntries(m.headers.entries())}),new Error(`Tool selection API error: ${m.status} ${m.statusText} - ${f}`)}const h=(S=(y=(p=(await m.json()).choices)==null?void 0:p[0])==null?void 0:y.message)==null?void 0:S.content;if(!h)throw new Error("No tool selection response from LLM");return JSON.parse(h)}async function Lr(r,s,t,a){var c,u,p,y,S;let n,i;switch(t.provider){case"azure-openai":let f=t.endpoint;f.startsWith("https://")||(f="https://"+f),f.endsWith("/")&&(f=f.slice(0,-1)),n=`${f}/openai/deployments/${t.model}/chat/completions?api-version=2024-02-15-preview`,i={"Content-Type":"application/json","api-key":t.apiKey};break;case"openai":n=t.endpoint+"/chat/completions",i={"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`};break;default:n=t.endpoint,i={"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`};break}t.customHeaders&&Object.assign(i,t.customHeaders),console.log("[Synthesis] Tool results to synthesize:",{count:s.length,tools:s.map(f=>({tool:f.tool,success:f.success,hasResult:!!f.result}))});const o=s.map(f=>f.success?{tool_name:f.tool,status:"success",data:f.result}:{tool_name:f.tool,status:"error",error_message:f.error}),m=await fetch(n,{method:"POST",headers:i,body:JSON.stringify({messages:[{role:"system",content:`${((c=t.selectedAgent)==null?void 0:c.systemPrompt)||"You are a helpful AI assistant specializing in GRC (Governance, Risk, and Compliance)."} 

You are working for ${a.name} in the ${a.industry} industry.

IMPORTANT: Today's date is ${new Date().toISOString().split("T")[0]} (${new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}). Use this as the current date for all date-related queries and responses.

Your persona: ${((u=t.selectedAgent)==null?void 0:u.persona)||"Professional and analytical assistant"}

# CRITICAL DATA PROCESSING INSTRUCTIONS

## Working with Tool Results:
1. You will receive tool results in a structured format with "tool_name", "status", and "data" fields
2. The "data" field contains the ACTUAL DATA retrieved from the GRC system - USE THIS DATA IN YOUR RESPONSE
3. DO NOT use placeholder values - extract and use real values from the data
4. Parse JSON data and extract specific metrics, counts, names, and values
5. If multiple tools were used, synthesize results into a cohesive analysis

## Response Quality Standards:

### For Simple Queries (e.g., "list applications", "show records"):
- Provide clear, direct answers with the actual data
- Format as a clean list or table
- Include relevant metadata (counts, last updated, etc.)
- Add brief context if helpful

### For Analysis Queries (e.g., "show critical risks", "analyze compliance"):
- Follow the comprehensive analysis framework in your system prompt
- Create professional reports with:
  * Executive summary with statistics
  * Categorized findings with visual indicators
  * Distribution analysis and tables
  * Actionable recommendations with timelines
  * Risk/compliance maturity assessments

### For Complex Queries (e.g., "executive report", "risk assessment"):
- Produce Claude Desktop-quality comprehensive reports
- Include all sections from your specialized framework
- Use professional formatting with clear sections
- Provide quantitative analysis with percentages and trends
- Add strategic recommendations and next steps

## Data Presentation Excellence:

### Visual Indicators:
- Risk Levels:  Critical,  High,  Medium,  Low
- Status:  Good,  Warning,  Critical,  Info
- Trends:  Increasing,  Decreasing,  Stable
- Performance:  Excellent,  Satisfactory,  Needs Improvement

### Structured Data Format:

**Section Title:**

| Metric Name | Value | Trend |
|-------------|-------|-------|
| Data Point  |  85%  |      |

### Statistical Presentation:
- Always include totals and breakdowns
- Show percentages alongside raw numbers
- Provide comparative analysis (vs. previous period, vs. benchmark)
- Include confidence levels for predictions

## Professional Report Sections:

1. **Executive Summary** (Always include for analysis queries)
   - Total items analyzed with severity breakdown
   - Key findings (top 3-5 critical items)
   - Overall health score or risk rating
   - Immediate actions required

2. **Detailed Analysis** (Core of the response)
   - Categorized findings by type/severity/business unit
   - Specific data points from tool results
   - Root cause analysis where applicable
   - Impact assessment (business, financial, operational)

3. **Recommendations** (Value-add section)
   - Prioritized action items (P1, P2, P3)
   - Timeline for implementation
   - Resource requirements
   - Expected outcomes

4. **Appendix** (For comprehensive reports)
   - Data sources and collection methods
   - Assumptions and limitations
   - Detailed metrics and calculations

## Response Calibration:

- **Simple query**  Clear, direct answer (1-2 paragraphs)
- **Standard analysis**  Structured report (3-5 sections)
- **Executive request**  Comprehensive analysis (full framework)
- **Critical finding**  Immediate alert + detailed analysis

## Quality Checklist:
 Used actual data from tool results
 Provided specific numbers and metrics
 Included visual indicators for clarity
 Structured response appropriately for query type
 Added actionable recommendations
 Maintained professional tone
 Included confidence levels where appropriate

Remember: You are producing professional GRC analysis that matches the quality of Claude Desktop and enterprise GRC platforms. Every response should demonstrate deep analytical capability and professional presentation.`},{role:"user",content:`User Question: "${r}"

MCP Tool Results (USE THE DATA IN THESE RESULTS):
${JSON.stringify(o,null,2)}

# RESPONSE GENERATION INSTRUCTIONS

## Query Analysis:
Based on the user's question "${r}", determine the appropriate response type:

${r.toLowerCase().includes("critical")||r.toLowerCase().includes("high")||r.toLowerCase().includes("risk")?`### This is a RISK ANALYSIS query - Provide:
1. Executive Summary with risk statistics
2. Risk categorization with  indicators
3. Detailed risk analysis for each critical/high risk
4. Risk distribution table by business unit
5. Prioritized recommendations with timelines
6. Risk maturity assessment`:r.toLowerCase().includes("compliance")||r.toLowerCase().includes("audit")?`### This is a COMPLIANCE query - Provide:
1. Compliance dashboard with scores
2. Framework coverage analysis
3. Control effectiveness assessment
4. Gap analysis with remediation priorities
5. Audit readiness evaluation`:r.toLowerCase().includes("executive")||r.toLowerCase().includes("board")||r.toLowerCase().includes("summary")?`### This is an EXECUTIVE query - Provide:
1. One-page executive dashboard
2. Strategic risk narrative
3. Board-level insights with benchmarking
4. Investment priorities matrix
5. Strategic recommendations`:`### This is a STANDARD ANALYSIS query - Provide:
1. Clear summary of findings
2. Detailed data presentation
3. Key insights and trends
4. Actionable next steps`}

## Data Extraction Requirements:
1. Extract ALL specific values from the tool results
2. Calculate percentages and distributions
3. Identify patterns and anomalies
4. Group and categorize findings
5. Prioritize by severity/importance

## Format Requirements:
- Use professional formatting with clear sections
- Include visual indicators (, , )
- Present data in tables where appropriate
- Provide specific counts, percentages, and metrics
- Include confidence levels for assessments

## Quality Standards:
- Match the quality of Claude Desktop's MCP integration
- Produce professional GRC analysis reports
- Include executive summaries for complex queries
- Provide actionable recommendations
- Use industry-standard GRC terminology

## Response Structure:
Organize your response following your specialized framework, ensuring:
- Professional presentation
- Comprehensive analysis
- Data-driven insights
- Strategic recommendations
- Clear next steps

Now, analyze the tool results and generate a professional GRC response that demonstrates the full analytical capabilities of an enterprise GRC platform.`}],temperature:t.temperature||.7,max_tokens:t.maxTokens||4e3})});if(!m.ok){const f=await m.text();throw console.error("[Synthesis] API error:",f),new Error(`Synthesis API error: ${m.status} ${m.statusText}`)}const h=(S=(y=(p=(await m.json()).choices)==null?void 0:p[0])==null?void 0:y.message)==null?void 0:S.content;return h?(console.log("[MCP Orchestration] Successfully synthesized tool results"),h):(console.warn("[Synthesis] No synthesized content, falling back to raw results"),s.map(f=>f.success?f.result:`Error: ${f.error}`).join(`

`))}const _r=()=>{const{user:r,tenant:s}=oe(),[t,a]=g.useState(""),[n,i]=g.useState(!1),[o,m]=g.useState(!0),[l,h]=g.useState(null),[c,u]=g.useState(null),[p,y]=g.useState([]),[S,f]=g.useState([{id:"1",type:"system",content:"GRC AI Assistant ready! Ask about compliance, risk, or governance using your enabled MCP servers.",timestamp:new Date().toISOString(),confidence:1}]),b=g.useRef(null),[j,w]=g.useState(()=>`conversation-${Date.now()}-${Math.random().toString(36).substr(2,9)}`);g.useEffect(()=>{var d;(d=b.current)==null||d.scrollIntoView({behavior:"smooth"})},[S]),g.useEffect(()=>{if(s&&!l){const d={id:s.id,name:s.name,industry:s.industry||"General",region:s.region||"Global",settings:{riskAppetite:"moderate",complianceFrameworks:["ISO27001","CPS230"],notificationPreferences:{email:!0,sms:!1,criticalAlertsOnly:!1}}};h(d),T(s.id),m(!1)}},[s,l]);const T=async d=>{try{const x=await Re(d).getEnabledAgents();y(x),x.length>0&&!c&&u(x[0].id)}catch(k){console.error("Error loading AI agents:",k),y([])}},I=(d=>{if(!d)return[];const k=["What are our current critical risks?","Show me our overall risk summary","Detect any anomalies in our GRC data"];return d.id==="tenant-fintech-001"?[...k,"Generate AI insights for financial services risks","What are the current high-risk findings in our SOX assessment?","Show me recent security incidents and their risk impact","Forecast our risk trajectory for next quarter","Predict control failures in our trading systems","Create executive summary of our risk posture"]:d.id==="tenant-healthcare-002"?[...k,"Generate AI insights for healthcare compliance","Analyze our HIPAA compliance status and identify privacy risks","What controls need attention for patient data protection?","Show me any unusual access patterns in patient records","Predict patient data security risks","Executive summary of compliance status"]:[...k,"Generate AI insights for manufacturing operations","Analyze supply chain disruption risks","What are our operational risk exposures?","Show production quality control anomalies","Forecast operational risk trends","Executive recommendations for risk management"]})(l),N=()=>{const d=`conversation-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;w(d),f([{id:"1",type:"system",content:"GRC AI Assistant ready! Ask about compliance, risk, or governance using your enabled MCP servers.",timestamp:new Date().toISOString(),confidence:1}]),a("")},G=d=>{h(d);const k={id:Date.now().toString(),type:"system",content:`Switched to ${d.name} (${d.industry}). Context updated with ${d.settings.complianceFrameworks.join(", ")} frameworks.`,timestamp:new Date().toISOString(),confidence:1};f(x=>[...x,k])},V=async()=>{var k;if(!t.trim()||!r||!s||!c||n)return;i(!0);try{const x=localStorage.getItem("auth_token");if(x){const L=JSON.parse(x),K=`sess_${L.tenantId}_${L.userId}`,v=await jt.validateSession(K,navigator.userAgent,"127.0.0.1");if(!v.valid||v.requiresReauth){const B={id:`${j}-${Date.now()}`,type:"assistant",content:"Security validation failed. Please refresh and log in again.",timestamp:new Date().toISOString(),confidence:0};f(A=>[...A,B]),i(!1);return}if(!await jt.validateTenantAccess(K,(l==null?void 0:l.id)||s.id)){const B={id:`${j}-${Date.now()}`,type:"assistant",content:"Access denied to the selected tenant context.",timestamp:new Date().toISOString(),confidence:0};f(A=>[...A,B]),i(!1);return}}}catch(x){console.warn("Session validation warning:",x)}const d={id:`${j}-${Date.now()}`,type:"user",content:t,timestamp:new Date().toISOString(),confidence:1};f(x=>[...x,d]),a("");try{await ie.logAgentInteraction((l==null?void 0:l.id)||s.id,r.id,c,"CHAT_QUERY","SUCCESS",{query:t.substring(0,100),queryLength:t.length,conversationId:j});const x=Ar(s.id,r.id,r.roles),L=await x.getAvailableTools(),K=Re(s.id),v=c?await K.getAgentWithContext(c):null;if(!v)throw new Error("Selected AI agent not found or not properly configured");const _=Date.now(),B=await Z(t,s,L,x,v),A={id:`${j}-${Date.now()+1}`,type:"assistant",content:B.content||"No response available",timestamp:new Date().toISOString(),confidence:.95,toolsUsed:B.toolsUsed||[],processingTime:Date.now()-_};f(U=>[...U,A]),await ie.logAgentInteraction((l==null?void 0:l.id)||s.id,r.id,c,"CHAT_RESPONSE","SUCCESS",{responseLength:((k=B.content)==null?void 0:k.length)||0,processingTime:Date.now()-_,toolsUsed:B.toolsUsed||[],conversationId:j})}catch(x){console.error("MCP query error:",x),await ie.logAgentInteraction((l==null?void 0:l.id)||s.id,r.id,c,"CHAT_ERROR","FAILURE",{error:x instanceof Error?x.message:"Unknown error",conversationId:j});const L={id:`${j}-${Date.now()+2}`,type:"assistant",content:`Error: ${x instanceof Error?x.message:"Unknown error occurred"}`,timestamp:new Date().toISOString(),confidence:0};f(K=>[...K,L])}finally{i(!1)}},Z=async(d,k,x,L,K)=>{if(!K)return{content:"No AI agent selected. Please select an agent from the sidebar.",toolsUsed:[]};if(["hello","hi","hey","good morning","good afternoon","good evening","how are you","what can you do","help"].some(xe=>d.toLowerCase().includes(xe))){const{agent:xe}=K;return{content:`Hello! I'm **${xe.name}** ${xe.avatar||""}, your ${xe.useCase} specialist.

${xe.description}

**My specialization**: ${xe.persona}

I can help you with GRC analysis, compliance assessments, risk management, and governance reporting using Archer data. Ask me about:
 Archer applications and records
 Risk analysis and insights  
 Compliance status and reporting
 Control monitoring and effectiveness
 Executive summaries and recommendations

Just ask me naturally - I'll determine which tools to use based on your question. For example:
- "List applications in Archer"
- "Show me recent risk assessments"
- "Generate insights about our compliance status"

How can I assist you today?`,toolsUsed:["conversation"]}}if(["list tools","show tools","available tools","what tools","which tools","archer tools","show me tools","mcp tools","tools available","show me archer"].some(xe=>d.toLowerCase().includes(xe))){console.log("[Agent Tools] User requesting tool list");const xe=x.map((C,E)=>`${E+1}. **${C.name}**
   - ${C.description||"GRC analysis tool"}`).join(`

`),{agent:ae}=K;return{content:`**${ae.name} Available Tools** ${ae.avatar||""}

${xe}

**Total Tools**: ${x.length}
**Server**: Archer GRC MCP
**Agent**: ${ae.name} (${ae.useCase})

You can ask me to analyze risks, generate insights, detect anomalies, or perform GRC analysis using these tools.`,toolsUsed:["list_tools"]}}const{agent:U,llmConfig:H}=K;if(!H){console.log(`[Agent Demo] Using agent "${U.name}" without LLM config - providing direct GRC analysis`);const xe=U.persona||"Professional GRC analyst";let ae="analyze_grc_data";const C=d.toLowerCase();C.includes("application")||C.includes("list")&&C.includes("archer")||C.includes("archer applications")||C.includes("show applications")||C.includes("get applications")?ae="get_archer_applications":C.includes("field")||C.includes("fields")||C.includes("application fields")||C.includes("show fields")||C.includes("list fields")?ae="get_application_fields":C.includes("insight")||C.includes("recommendation")?ae="get_archer_applications":C.includes("search")||C.includes("record")?ae="search_archer_records":(C.includes("stat")||C.includes("summary"))&&(ae="get_record_statistics");try{let W={tenant_id:"tenant-fintech-001",query:d,focus_area:"overall"};if(ae==="get_application_fields"){const fe=d.match(/fields?\s+(?:for|of|in)\s+([^?]+)/i)||d.match(/([^?]+)\s+fields?/i);if(fe)W={applicationName:fe[1].trim()};else throw new Error('Please specify an application name. For example: "show fields for Risk Register" or "list fields in Controls"')}const se=await L.executeTool({toolId:ae,inputs:W});return await Re(k.id).recordUsage(U.id),{content:`**${U.name} Analysis** ${U.avatar||""}

**Query**: ${d}

**GRC Analysis** (${U.useCase}):

${se.result}

---
*Analysis provided by ${U.name} using ${ae} tool*
*Agent Persona: ${xe}*
*Note: For enhanced AI insights with custom prompts, configure LLM settings in the Settings page.*`,toolsUsed:[ae]}}catch(E){console.error("[Agent Demo] Tool execution failed:",E);let W=`I attempted to use the **${ae}** tool to answer your question, but encountered an error.`,se="";return ae==="get_archer_applications"?se=`

**What I was trying to do**: List all Archer applications available for analysis

**Error Details**: ${E instanceof Error?E.message:String(E)}

**This usually means**:
- Archer server connection needs to be configured
- Authentication credentials need to be updated
- The Archer instance may be unavailable

**To fix this**: Please check your Archer connection settings in the Settings page.`:se=`

**Error Details**: ${E instanceof Error?E.message:String(E)}

**Please check your MCP server configuration and Archer connection settings.**`,{content:`**${U.name} Analysis** ${U.avatar||""}

**Query**: ${d}

${W}${se}

---
*Tool attempted: ${ae}*
*Agent: ${U.name} (${U.useCase})*`,toolsUsed:[ae]}}}const Te={...k,selectedAgent:{id:U.id,name:U.name,persona:U.persona,systemPrompt:U.systemPrompt,provider:H.provider,model:H.model,endpoint:H.endpoint,apiKey:H.apiKey,maxTokens:H.maxTokens,temperature:H.temperature}};return await Re(k.id).recordUsage(U.id),{content:await Pr(d,Te,x,L),toolsUsed:["LLM-orchestrated"]}};return o?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Connecting to MCP Server..."})]})}):e.jsxs("div",{className:"h-full flex flex-col space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"GRC AI Assistant"}),e.jsx("p",{className:"text-muted-foreground",children:"Ask questions about compliance, risk, and governance using your tenant-scoped MCP tools"})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-12 gap-4 min-h-0",children:[e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Wt,{selectedTenant:l,onTenantChange:G,allowCrossTenantAccess:!1}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h3",{className:"font-medium text-sm mb-3 flex items-center space-x-2",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{children:"AI Agent"})]}),e.jsx("div",{className:"space-y-3",children:p.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:c||"",onChange:d=>u(d.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"",children:"Select an AI Agent..."}),p.map(d=>e.jsxs("option",{value:d.id,children:[d.avatar," ",d.name," - ",d.useCase]},d.id))]}),c&&(()=>{const d=p.find(k=>k.id===c);return d?e.jsxs("div",{className:"p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:"text-lg",children:d.avatar}),e.jsx("div",{className:"font-medium text-blue-800",children:d.name})]}),e.jsx("div",{className:"text-blue-600 text-xs mb-2",children:d.description}),e.jsx("div",{className:"flex flex-wrap gap-1",children:d.capabilities.map(k=>e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs",children:k},k))}),e.jsxs("div",{className:"mt-2 text-xs text-blue-600",children:[e.jsxs("div",{children:["Use Case: ",d.useCase]}),e.jsxs("div",{children:["Usage: ",d.usageCount," times"]})]})]}):null})()]}):e.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded text-xs",children:[e.jsx("div",{className:"font-medium text-yellow-800",children:"No AI Agents Available"}),e.jsx("div",{className:"text-yellow-600 mt-1",children:"Configure LLM settings and create AI agents to get started"})]})})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h3",{className:"font-medium text-sm mb-3 flex items-center space-x-2",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{children:"MCP Tools"})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"p-3 border rounded-lg bg-green-50 border-green-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"h-2 w-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("h4",{className:"font-medium text-sm text-green-800",children:"Archer GRC Server"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-800 rounded text-xs",children:"Risk Analysis"}),e.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-800 rounded text-xs",children:"Compliance"}),e.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-800 rounded text-xs",children:"Control Monitoring"})]})]})})]})]})}),e.jsx("div",{className:"col-span-9 flex flex-col",children:e.jsxs(P,{className:"flex-1 flex flex-col min-h-0",children:[e.jsx(F,{className:"shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(fs,{className:"h-5 w-5"}),e.jsx("span",{children:"Conversation"}),e.jsxs("span",{className:"text-xs text-muted-foreground font-normal",children:["#",j.split("-")[1]]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{onClick:N,variant:"outline",size:"sm",className:"text-xs",children:"New Chat"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Server:"}),e.jsx("span",{className:"font-medium",children:"Archer GRC MCP"})]})]})]})}),e.jsxs(O,{className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 pr-2",children:[S.map(d=>{var k;return e.jsxs("div",{className:q("p-4 rounded-lg",d.type==="user"?"bg-primary text-primary-foreground ml-8":d.type==="system"?"bg-muted/50 text-center text-sm text-muted-foreground":"bg-muted mr-8"),children:[d.type!=="system"&&e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"h-6 w-6 rounded-full flex items-center justify-center text-xs font-medium flex-shrink-0",children:d.type==="user"?e.jsx("div",{className:"h-full w-full bg-primary text-primary-foreground rounded-full flex items-center justify-center",children:(k=r==null?void 0:r.name)==null?void 0:k.charAt(0).toUpperCase()}):e.jsx("div",{className:"h-full w-full bg-primary/10 text-primary rounded-full flex items-center justify-center",children:e.jsx(Se,{className:"h-4 w-4"})})}),e.jsx("div",{className:"font-medium text-sm",children:d.type==="user"?r==null?void 0:r.name:"GRC AI Assistant"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(d.timestamp).toLocaleTimeString()}),d.confidence&&d.confidence<1&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(d.confidence*100),"% confidence"]}),d.processingTime&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[d.processingTime,"ms"]})]}),e.jsx("div",{className:"whitespace-pre-wrap",children:d.content}),d.toolsUsed&&d.toolsUsed.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(de,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs font-medium",children:"Tools Used:"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:d.toolsUsed.map(x=>e.jsxs("span",{className:"px-2 py-1 bg-background/50 rounded text-xs flex items-center space-x-1",children:[x==="archer-connector"&&e.jsx(ve,{className:"h-3 w-3"}),x==="analyze_grc_data"&&e.jsx(Pe,{className:"h-3 w-3"}),x==="get_risk_summary"&&e.jsx(re,{className:"h-3 w-3"}),x==="detect_anomalies"&&e.jsx(cs,{className:"h-3 w-3"}),e.jsx("span",{children:x})]},x))})]}),d.complianceFlags&&d.complianceFlags.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(re,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs font-medium",children:"Compliance Alerts:"})]}),d.complianceFlags.map((x,L)=>e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[x.severity==="critical"&&e.jsx(ue,{className:"h-3 w-3 text-red-500"}),x.severity==="warning"&&e.jsx(ue,{className:"h-3 w-3 text-yellow-500"}),x.severity==="info"&&e.jsx(Y,{className:"h-3 w-3 text-blue-500"}),e.jsxs("span",{children:[x.framework," ",x.rule,": ",x.severity]})]},L))]})]},d.id)}),n&&e.jsxs("div",{className:"bg-muted mr-8 p-4 rounded-lg border border-border/50",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"h-6 w-6 bg-primary/10 rounded-full flex items-center justify-center",children:e.jsx(Se,{className:"h-4 w-4 text-primary"})}),e.jsx("div",{className:"font-medium text-sm",children:"GRC AI Assistant"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"h-1 w-1 bg-primary rounded-full animate-pulse"}),e.jsx("div",{className:"h-1 w-1 bg-primary rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("div",{className:"h-1 w-1 bg-primary rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx("div",{className:"animate-pulse",children:"Analyzing with MCP tools..."})})]}),e.jsx("div",{ref:b})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:t,onChange:d=>a(d.target.value),onKeyDown:d=>d.key==="Enter"&&!d.shiftKey&&V(),placeholder:l?c?"Ask about compliance, risks, or governance...":"Select an AI agent first...":"Select a tenant first...",className:"flex-1 px-3 py-2 border border-input bg-background rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-ring transition-all duration-200 focus:border-primary disabled:opacity-50 disabled:cursor-not-allowed",disabled:n||!l||!c}),e.jsx(M,{onClick:V,disabled:n||!t.trim()||!l||!c,size:"sm",className:"px-4 py-2 transition-all duration-200 hover:scale-105 active:scale-95",children:n?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}):e.jsx(sn,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(os,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Suggested queries:"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.slice(0,3).map((d,k)=>e.jsx("button",{onClick:()=>a(d),className:"px-3 py-1.5 bg-muted hover:bg-primary/10 hover:border-primary/20 border border-transparent rounded-md text-xs text-left transition-all duration-200 hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",disabled:n||!l||!c,children:d},k))}),l&&e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"space-y-2",children:[c&&(()=>{const d=p.find(k=>k.id===c);return d?e.jsxs("div",{className:"flex items-center space-x-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:d.avatar}),e.jsx("span",{className:"font-medium",children:"Agent:"}),e.jsx("span",{children:d.name})]}),e.jsx("div",{className:"text-muted-foreground/50",children:""}),e.jsx("span",{children:d.useCase})]}):null})(),e.jsxs("div",{className:"flex items-center space-x-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"font-medium",children:"MCP:"}),e.jsx("span",{children:"Archer GRC Server"})]}),e.jsx("div",{className:"text-muted-foreground/50",children:""}),e.jsxs("span",{children:["Tenant: ",l.name]})]}),e.jsx("div",{className:"text-xs text-muted-foreground/70 italic",children:" Ask naturally - the AI agent will select the right tools automatically"})]})})]})]})]})]})})]})]})},Ur=()=>e.jsx("div",{className:"h-full",children:e.jsx(_r,{})}),Fr=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Audit Trail"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"View detailed audit logs and compliance evidence"})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsx($,{children:"Audit Log Management"})}),e.jsxs(O,{children:[e.jsx("p",{className:"text-muted-foreground",children:"Audit trail interface will be available here. This would include:"}),e.jsxs("ul",{className:"mt-2 text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:" Search and filter audit events"}),e.jsx("li",{children:" Export audit logs for compliance"}),e.jsx("li",{children:" View detailed event information"}),e.jsx("li",{children:" Track user activities and system changes"}),e.jsx("li",{children:" Generate audit reports"})]})]})]})]}),$r=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"User Management"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage tenant users, roles, and permissions"})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsx($,{children:"Tenant User Management"})}),e.jsxs(O,{children:[e.jsx("p",{className:"text-muted-foreground",children:"User management interface will be available here. This would include:"}),e.jsxs("ul",{className:"mt-2 text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:" Invite and manage tenant users"}),e.jsx("li",{children:" Assign roles (Tenant Owner, Agent User, Auditor)"}),e.jsx("li",{children:" Configure user permissions"}),e.jsx("li",{children:" Monitor user activity"}),e.jsx("li",{children:" Manage user access to MCP tools"})]})]})]})]});class zr{constructor(){ee(this,"isConnected",!1);ee(this,"availableTools",[]);ee(this,"proxyUrl","http://localhost:3001")}async connect(){try{console.log("[MCP Client] Connecting to MCP server via HTTP proxy...");const s=await fetch(`${this.proxyUrl}/tools`);if(!s.ok)throw new Error(`MCP bridge server not accessible: ${s.status}`);const t=await s.json();return console.log("[MCP Client] Tools response:",t),this.availableTools=t.tools?t.tools.map(a=>({name:a.name,description:a.description,inputSchema:a.inputSchema})):[],this.isConnected=!0,console.log(`[MCP Client] Connected to MCP server. Available tools: ${this.availableTools.map(a=>a.name).join(", ")}`),!0}catch(s){return console.error("[MCP Client] Failed to connect:",s),this.isConnected=!1,!1}}isClientConnected(){return this.isConnected}getAvailableTools(){return this.availableTools}async callTool(s,t){if(!this.isConnected)throw new Error("MCP client not connected. Call connect() first.");const a=Date.now();try{console.log(`[MCP Client] Calling tool: ${s} with parameters:`,t);const n=await fetch(`${this.proxyUrl}/tools/${s}/call`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({arguments:t})});if(!n.ok){const h=await n.json().catch(()=>({error:"Unknown error"}));throw new Error(h.error||`HTTP ${n.status}`)}const i=await n.json(),o=typeof i=="string"?i:JSON.stringify(i,null,2),m=.89,l=Date.now()-a;return{content:o,confidence:m,toolsUsed:[s],evidence:[{source:"Archer GRC Platform",excerpt:o.substring(0,200)+"...",relevance:m}],complianceFlags:this.extractComplianceFlags(o),processingTime:l}}catch(n){throw console.error(`[MCP Client] Tool call failed for ${s}:`,n),new Error(`Failed to execute tool ${s}: ${n instanceof Error?n.message:"Unknown error"}`)}}extractComplianceFlags(s){const t=[];return s.toLowerCase().includes("hipaa")&&t.push({framework:"HIPAA",rule:"Patient Data Protection",severity:"critical"}),(s.toLowerCase().includes("sox")||s.toLowerCase().includes("sarbanes"))&&t.push({framework:"SOX",rule:"Financial Controls",severity:"warning"}),(s.toLowerCase().includes("gdpr")||s.toLowerCase().includes("data protection"))&&t.push({framework:"GDPR",rule:"Data Privacy",severity:"warning"}),t}async disconnect(){this.isConnected=!1,this.availableTools=[],console.log("[MCP Client] Disconnected from MCP server")}}const Ve=new zr,Gr=({rawContent:r})=>{const s=u=>{const p=u.split(`
`),y={title:"",metadata:{industry:"",focus:"",type:"",generated:"",confidence:0},sections:[],keyFindings:[],recommendations:[],footer:""};let S=null,f=null;for(let b=0;b<p.length;b++){const j=p[b].trim();if(j.startsWith("# ")&&j.includes("AI-Generated Insights")&&(y.title=j.replace("# ","").replace(" ","")),j.includes("**Industry**:")){const w=j.match(/\*\*Industry\*\*:\s*([^|]+)\s*\|\s*\*\*Focus\*\*:\s*([^|]+)\s*\|\s*\*\*Type\*\*:\s*(.+)/);w&&(y.metadata.industry=w[1].trim(),y.metadata.focus=w[2].trim(),y.metadata.type=w[3].trim())}if(j.includes("**Analysis Generated**:")&&(y.metadata.generated=j.replace("**Analysis Generated**: ","")),j.includes("**AI Confidence**:")){const w=j.match(/(\d+)%/);w&&(y.metadata.confidence=parseInt(w[1]))}if(j.startsWith("## ")){S&&y.sections.push(S);const w=j.replace("## ","").replace(/^[]+\s*/,"");S={title:w,type:t(w),content:[]},f=null}if(j.startsWith("### ")&&(f&&S&&S.content.push(f),f={type:"subsection",title:j.replace("### ",""),content:"",items:[]}),j.startsWith("- ")&&S){const w=j.replace("- ",""),T=w.match(/\*\*([^*]+)\*\*:\s*(.+)/);if(T){const D=T[1],I=T[2];f?(f.items=f.items||[],f.items.push(`${D}: ${I}`)):S.content.push({type:"metric",title:D,content:I,trend:a(I),severity:n(I)})}else f?(f.items=f.items||[],f.items.push(w)):S.content.push({type:"list",content:w})}if(j.includes(" Key Findings")||j.includes("** Key Findings**"))for(let w=b+1;w<p.length&&p[w].trim().startsWith("- ");w++)y.keyFindings.push(p[w].trim().replace("- ",""));if(j.includes(" Recommendations")||j.includes("** Recommendations**"))for(let w=b+1;w<p.length&&p[w].trim().startsWith("- ");w++){const D=p[w].trim().replace("- ","").match(/^([^:]+):\s*(.+)/);D&&y.recommendations.push({category:D[1],content:D[2],priority:i(D[1])})}j.includes("Generated by AI Insights Engine")&&(y.footer=j.replace(/^\*/,"").replace(/\*$/,""))}return f&&S&&S.content.push(f),S&&y.sections.push(S),y},t=u=>{const p=u.toLowerCase();return p.includes("compliance")?"compliance":p.includes("prediction")||p.includes("forecast")?"predictions":p.includes("recommendation")?"recommendations":p.includes("executive")?"executive":p.includes("risk")||p.includes("control")?"analysis":p.includes("profile")||p.includes("overview")?"overview":"summary"},a=u=>u.includes("")||u.includes("increasing")||u.includes("improving")?"up":u.includes("")||u.includes("decreasing")||u.includes("declining")?"down":"stable",n=u=>{const p=u.toLowerCase();return p.includes("critical")||p.includes("urgent")?"critical":p.includes("high")||p.includes("significant")?"high":p.includes("low")||p.includes("minimal")?"low":"medium"},i=u=>{const p=u.toLowerCase();return p.includes("priority")||p.includes("urgent")?"urgent":p.includes("enhancement")||p.includes("improvement")?"high":p.includes("monitoring")||p.includes("maintenance")?"medium":"low"},o=u=>{switch(u){case"overview":return e.jsx(Pe,{className:"h-5 w-5"});case"analysis":return e.jsx(Je,{className:"h-5 w-5"});case"compliance":return e.jsx(Ut,{className:"h-5 w-5"});case"predictions":return e.jsx(es,{className:"h-5 w-5"});case"recommendations":return e.jsx(mt,{className:"h-5 w-5"});case"executive":return e.jsx(Ye,{className:"h-5 w-5"});default:return e.jsx(he,{className:"h-5 w-5"})}},m=u=>u==="up"?e.jsx(es,{className:"h-4 w-4 text-green-500"}):u==="down"?e.jsx(Kt,{className:"h-4 w-4 text-red-500"}):e.jsx(Va,{className:"h-4 w-4 text-gray-500"}),l=u=>{switch(u){case"critical":return"text-red-600 bg-red-50 border-red-200";case"high":return"text-orange-600 bg-orange-50 border-orange-200";case"medium":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"low":return"text-green-600 bg-green-50 border-green-200";default:return"text-blue-600 bg-blue-50 border-blue-200"}},h=u=>{switch(u){case"urgent":return e.jsx(ue,{className:"h-4 w-4 text-red-500"});case"high":return e.jsx(X,{className:"h-4 w-4 text-orange-500"});case"medium":return e.jsx(he,{className:"h-4 w-4 text-yellow-500"});default:return e.jsx(gs,{className:"h-4 w-4 text-green-500"})}},c=s(r);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(P,{className:"border-primary/20 bg-primary/5",children:e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(me,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx($,{className:"text-xl",children:c.title}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx("span",{children:c.metadata.industry})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{children:c.metadata.focus})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{children:c.metadata.type})]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-lg font-semibold text-primary",children:[e.jsx(tn,{className:"h-5 w-5"}),e.jsxs("span",{children:[c.metadata.confidence,"%"]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"AI Confidence"}),c.metadata.generated&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-muted-foreground mt-1",children:[e.jsx(Ie,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(c.metadata.generated).toLocaleString()})]})]})]})})}),c.sections.map((u,p)=>e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[o(u.type),e.jsx("span",{children:u.title})]})}),e.jsx(O,{className:"space-y-4",children:u.content.map((y,S)=>e.jsxs("div",{children:[y.type==="subsection"&&e.jsxs("div",{className:"border-l-4 border-primary/20 pl-4 py-2",children:[e.jsx("h4",{className:"font-semibold text-lg mb-2",children:y.title}),y.items&&y.items.length>0&&e.jsx("div",{className:"space-y-2",children:y.items.map((f,b)=>e.jsxs("div",{className:"flex items-start space-x-2 text-sm",children:[e.jsx("div",{className:"h-1.5 w-1.5 bg-primary rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{children:f})]},b))})]}),y.type==="metric"&&e.jsxs("div",{className:q("p-3 rounded-lg border flex items-center justify-between",l(y.severity)),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:y.title}),y.trend&&m(y.trend)]}),e.jsx("span",{className:"font-mono text-sm",children:y.content})]}),y.type==="list"&&e.jsxs("div",{className:"flex items-start space-x-2 text-sm",children:[e.jsx(gs,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:y.content})]}),y.type==="text"&&e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:y.content})]},S))})]},p)),(c.keyFindings.length>0||c.recommendations.length>0)&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[c.keyFindings.length>0&&e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(Je,{className:"h-5 w-5 text-primary"}),e.jsx("span",{children:"Key Findings"})]})}),e.jsx(O,{children:e.jsx("div",{className:"space-y-3",children:c.keyFindings.map((u,p)=>e.jsxs("div",{className:"flex items-start space-x-2 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx(he,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm text-blue-800",children:u})]},p))})})]}),c.recommendations.length>0&&e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(mt,{className:"h-5 w-5 text-primary"}),e.jsx("span",{children:"Recommendations"})]})}),e.jsx(O,{children:e.jsx("div",{className:"space-y-3",children:c.recommendations.map((u,p)=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-muted/30 rounded-lg",children:[h(u.priority),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm",children:u.category}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:u.content})]})]},p))})})]})]}),c.footer&&e.jsx(P,{className:"border-muted",children:e.jsx(O,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-center text-sm text-muted-foreground",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:c.footer})]})})})]})},qr=()=>{var xe,ae;const[r,s]=g.useState(Rr[0]),[t,a]=g.useState("overall"),[n,i]=g.useState("summary"),[o,m]=g.useState(null),[l,h]=g.useState([]),[c,u]=g.useState(!1),[p,y]=g.useState(""),[S,f]=g.useState(!0),[b,j]=g.useState(""),[w,T]=g.useState(0),[D,I]=g.useState(!0),[N,G]=g.useState("auto"),[V,Z]=g.useState(null),d=[{id:"overall",label:"Overall",icon:me,description:"Comprehensive organizational insights"},{id:"risks",label:"Risk Analysis",icon:X,description:"Risk-focused predictions and analysis"},{id:"controls",label:"Control Effectiveness",icon:re,description:"Control performance and optimization"},{id:"compliance",label:"Compliance",icon:Ut,description:"Regulatory and compliance insights"}],k=[{id:"summary",label:"Summary",description:"High-level overview and key metrics"},{id:"predictions",label:"Predictions",description:"ML-powered forecasts and trends"},{id:"recommendations",label:"Recommendations",description:"Actionable improvement suggestions"},{id:"alerts",label:"Alerts",description:"Priority issues requiring attention"}],x=async(C=!1)=>{if(r){u(!0),h([]),m(null),j("");try{if(!Ve.isClientConnected()&&(console.log("[AI Insights] MCP client not connected, attempting to connect..."),!await Ve.connect()))throw new Error("Failed to connect to MCP server");console.log(`[AI Insights] Generating insights for ${r.name}`),console.log(`[AI Insights] Focus: ${t}, Type: ${n}, Executive: ${C}`);const E=await Ve.callTool("generate_insights",{tenant_id:r.id,focus_area:t,insight_type:n,executive_summary:C,use_agents:D,agent_mode:N});console.log("[AI Insights] Raw response:",E),j(E.content||""),T(E.processingTime||0),y(new Date().toISOString()),E.agentMode||E.content&&E.content.includes("Agent")?Z("agents"):Z("direct");const W=L(E.content||"");h(W.insights),C&&W.executiveSummary&&m(W.executiveSummary)}catch(E){console.error("[AI Insights] Generation failed:",E),h([{id:"error",type:"narrative",title:"Error Generating Insights",content:`Failed to generate AI insights: ${E instanceof Error?E.message:"Unknown error"}`,confidence:0,severity:"critical",category:"system",timestamp:new Date().toISOString()}])}finally{u(!1)}}},L=C=>{const E=[];let W;const se=C.match(/ Executive Summary[\s\S]*?(?=\n##|\n|\n|$)/i);if(se){const te=se[0],Me=K(te,/ Key Findings:([\s\S]*?)(?=\n\*\*|$)/i),Oe=K(te,/Priority Actions:([\s\S]*?)(?=\n\*\*|$)/i);W={overview:v(te,/Overview:([\s\S]*?)(?=\*\*|$)/i)||"Executive summary available",keyFindings:Me.length>0?Me:["AI-generated insights available"],priorityActions:Oe.length>0?Oe:["Review AI recommendations"],riskLevel:B(C),confidence:_(C),lastGenerated:new Date().toISOString()}}const je=C.match(/\*\*(.*?)\*\*:\s*(.*?)(?=\n\*\*|\n-|\n#|$)/g);je&&je.forEach((te,Me)=>{const[,Oe,tt]=te.match(/\*\*(.*?)\*\*:\s*(.*)/s)||[];Oe&&tt&&E.push({id:`narrative-${Me}`,type:"narrative",title:Oe.trim(),content:tt.trim(),confidence:_(te),severity:A(te),category:t,timestamp:new Date().toISOString()})});const fe=C.match(/ (.*?)(?=\n|$)/g);return fe&&fe.forEach((te,Me)=>{const Oe=te.replace(" ","").trim();E.push({id:`recommendation-${Me}`,type:"recommendation",title:"AI Recommendation",content:Oe,confidence:_(C),severity:"medium",category:"recommendation",timestamp:new Date().toISOString()})}),K(C,/Key Findings:([\s\S]*?)(?=\n##|\n|$)/i).forEach((te,Me)=>{E.push({id:`finding-${Me}`,type:"finding",title:"Key Finding",content:te,confidence:_(C),severity:A(te),category:"finding",timestamp:new Date().toISOString()})}),{insights:E,executiveSummary:W}},K=(C,E)=>{const W=C.match(E);return W?W[1].split(`
`).map(se=>se.replace(/^[\s\-\*]+/,"").trim()).filter(se=>se.length>0):[]},v=(C,E)=>{const W=C.match(E);return W?W[1].trim():null},_=C=>{const E=C.match(/(\d+)%\s*(?:confidence|conf\.)/i);return E?parseInt(E[1]):85},B=C=>{const E=C.toLowerCase();return E.includes("critical")||E.includes("urgent")?"critical":E.includes("high risk")||E.includes("significant")?"high":E.includes("low risk")||E.includes("minimal")?"low":"medium"},A=C=>{const E=C.toLowerCase();return E.includes("critical")||E.includes("severe")?"critical":E.includes("high")||E.includes("significant")?"high":E.includes("low")||E.includes("minor")?"low":"medium"},U=C=>{switch(C){case"critical":return e.jsx(ue,{className:"h-4 w-4 text-red-500"});case"high":return e.jsx(X,{className:"h-4 w-4 text-orange-500"});case"medium":return e.jsx(he,{className:"h-4 w-4 text-yellow-500"});case"low":return e.jsx(gs,{className:"h-4 w-4 text-green-500"});default:return e.jsx(he,{className:"h-4 w-4 text-blue-500"})}},H=C=>{switch(C){case"critical":return"border-red-200 bg-red-50";case"high":return"border-orange-200 bg-orange-50";case"medium":return"border-yellow-200 bg-yellow-50";case"low":return"border-green-200 bg-green-50";default:return"border-blue-200 bg-blue-50"}},Te=async()=>{if(r)try{const C=await Ve.callTool("generate_insights",{tenant_id:r.id,focus_area:"overall",insight_type:"summary",executive_summary:!0}),E=Ke(C.content,r),W=new Blob([E],{type:"text/html"}),se=URL.createObjectURL(W),je=document.createElement("a");je.href=se,je.download=`${r.name.replace(/\s+/g,"_")}_Executive_Report_${new Date().toISOString().split("T")[0]}.html`,document.body.appendChild(je),je.click(),document.body.removeChild(je),URL.revokeObjectURL(se)}catch(C){console.error("Failed to export executive report:",C)}},Ke=(C,E)=>{const W=new Date().toLocaleString(),se=new Date().toLocaleDateString();return`
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Executive Risk Report - ${E.name}</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #fff;
        }
        .header {
            border-bottom: 3px solid #2563eb;
            margin-bottom: 30px;
            padding-bottom: 20px;
        }
        .header h1 {
            color: #1e40af;
            margin: 0;
            font-size: 28px;
            font-weight: 700;
        }
        .header .subtitle {
            color: #6b7280;
            font-size: 16px;
            margin: 5px 0;
        }
        .metadata {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .metadata-item {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 8px;
        }
        .metadata-label {
            font-weight: 600;
            color: #374151;
        }
        .metadata-value {
            color: #6b7280;
        }
        .section {
            margin: 30px 0;
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 25px;
        }
        .section h2 {
            color: #1f2937;
            font-size: 20px;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .section h3 {
            color: #374151;
            font-size: 16px;
            margin: 20px 0 10px 0;
            border-left: 4px solid #2563eb;
            padding-left: 12px;
        }
        .key-findings {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
        }
        .recommendations {
            background: #f0fdf4;
            border-left: 4px solid #10b981;
        }
        .critical-alert {
            background: #fef2f2;
            border-left: 4px solid #ef4444;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric-card {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
        }
        .metric-label {
            font-size: 14px;
            color: #6b7280;
            margin-top: 5px;
        }
        .finding-item, .recommendation-item {
            margin: 10px 0;
            padding: 10px 15px;
            border-radius: 6px;
            border-left: 3px solid #e5e7eb;
        }
        .finding-item {
            background: #f8fafc;
            border-left-color: #3b82f6;
        }
        .recommendation-item {
            background: #f0fdf4;
            border-left-color: #10b981;
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
            text-align: center;
            font-size: 12px;
            color: #6b7280;
        }
        .confidence-badge {
            display: inline-block;
            background: #2563eb;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        @media print {
            body { padding: 20px; }
            .section { break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1> Executive Risk Assessment Report</h1>
        <div class="subtitle">${E.name}  ${E.industry} Industry</div>
        <div class="subtitle">Generated: ${W} <span class="confidence-badge">87% AI Confidence</span></div>
    </div>

    <div class="metadata">
        <div class="metadata-item">
            <span class="metadata-label">Organization:</span>
            <span class="metadata-value">${E.name}</span>
        </div>
        <div class="metadata-item">
            <span class="metadata-label">Industry:</span>
            <span class="metadata-value">${E.industry}</span>
        </div>
        <div class="metadata-item">
            <span class="metadata-label">Report Date:</span>
            <span class="metadata-value">${se}</span>
        </div>
        <div class="metadata-item">
            <span class="metadata-label">Analysis Type:</span>
            <span class="metadata-value">Executive Summary</span>
        </div>
    </div>

    ${Ee(C)}

    <div class="footer">
        <p><strong> Generated by AI Insights Engine v2.0</strong></p>
        <p>This report contains AI-generated insights with ${E.industry}-specific intelligence  Confidential</p>
        <p>Report ID: ${Date.now().toString(36).toUpperCase()}  Generated: ${W}</p>
    </div>
</body>
</html>`},Ee=C=>{let E="";const W=C.split(`
`);let se=[],je=[];for(let fe=0;fe<W.length;fe++){const ts=W[fe].trim();if(ts.includes(" Key Findings")||ts.includes("** Key Findings**"))for(let te=fe+1;te<W.length&&W[te].trim().startsWith("- ");te++)se.push(W[te].trim().replace("- ",""));if(ts.includes(" Recommendations")||ts.includes("** Recommendations**"))for(let te=fe+1;te<W.length&&W[te].trim().startsWith("- ");te++)je.push(W[te].trim().replace("- ",""))}return E+=`
    <div class="section">
        <h2> Executive Summary</h2>
        <p>This report provides an AI-powered assessment of the current risk posture and compliance status for the organization. Key metrics and strategic recommendations are highlighted for executive decision-making.</p>
    </div>`,se.length>0&&(E+=`
      <div class="section key-findings">
          <h2> Key Findings</h2>`,se.forEach(fe=>{E+=`<div class="finding-item">${fe}</div>`}),E+="</div>"),je.length>0&&(E+=`
      <div class="section recommendations">
          <h2> Priority Recommendations</h2>`,je.forEach(fe=>{E+=`<div class="recommendation-item">${fe}</div>`}),E+="</div>"),E+=`
    <div class="section">
        <h2> Risk Metrics Overview</h2>
        <div class="metric-grid">
            <div class="metric-card">
                <div class="metric-value">7.2/10</div>
                <div class="metric-label">Average Risk Score</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">73%</div>
                <div class="metric-label">Control Effectiveness</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">2</div>
                <div class="metric-label">Critical Risks</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">94%</div>
                <div class="metric-label">Compliance Score</div>
            </div>
        </div>
    </div>`,E};return g.useEffect(()=>{(async()=>{Ve.isClientConnected()||(console.log("[AI Insights] Initializing MCP client connection..."),await Ve.connect())})()},[]),g.useEffect(()=>{r&&x(S)},[r,t,n]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center space-x-3",children:[e.jsx(me,{className:"h-8 w-8 text-primary"}),e.jsx("span",{children:"AI Insights"})]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"AI-powered natural language insights and executive summaries from your GRC data"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(M,{onClick:()=>x(S),disabled:c||!r,variant:"outline",size:"sm",children:[e.jsx(Ne,{className:q("h-4 w-4",c&&"animate-spin")}),"Refresh"]}),S&&e.jsxs(M,{onClick:Te,variant:"outline",size:"sm",children:[e.jsx(Ot,{className:"h-4 w-4"}),"Export Report"]})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsx("div",{className:"col-span-3",children:e.jsx(Wt,{selectedTenant:r,onTenantChange:s,allowCrossTenantAccess:!0})}),e.jsx("div",{className:"col-span-5",children:e.jsxs(P,{children:[e.jsx(F,{className:"pb-3",children:e.jsxs($,{className:"text-sm flex items-center space-x-2",children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{children:"Focus Area"})]})}),e.jsx(O,{className:"pt-0",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:d.map(C=>{const E=C.icon;return e.jsxs("button",{onClick:()=>a(C.id),className:q("p-3 border rounded-lg text-left transition-all hover:scale-[1.02]",t===C.id?"border-primary bg-primary/5 text-primary":"hover:bg-muted/50"),children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium text-sm",children:C.label})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:C.description})]},C.id)})})})]})}),e.jsx("div",{className:"col-span-4",children:e.jsxs(P,{children:[e.jsx(F,{className:"pb-3",children:e.jsxs($,{className:"text-sm flex items-center space-x-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{children:"Analysis Type"})]})}),e.jsxs(O,{className:"pt-0 space-y-3",children:[e.jsx("div",{className:"space-y-2",children:k.map(C=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:C.id,checked:n===C.id,onChange:E=>i(E.target.value),className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:C.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:C.description})]})]},C.id))}),e.jsxs("div",{className:"border-t pt-3 space-y-3",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:C=>f(C.target.checked),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Include Executive Summary"})]}),e.jsxs("div",{className:"border-t pt-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:D,onChange:C=>I(C.target.checked),className:"w-4 h-4"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ye,{className:"h-3 w-3"}),e.jsx("span",{className:"text-sm font-medium",children:"Use AI Agents"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground ml-6",children:"Enable specialized AI agents for enhanced analysis"})]}),D&&e.jsxs("div",{className:"mt-3 ml-6 space-y-2",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Agent Mode:"}),e.jsx("div",{className:"space-y-1",children:[{id:"auto",label:"Auto Select",desc:"Automatically choose best agents"},{id:"single",label:"Single Agent",desc:"Use one specialized agent"},{id:"multi",label:"Multi-Agent",desc:"Coordinate multiple agents"}].map(C=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"agentMode",value:C.id,checked:N===C.id,onChange:E=>G(E.target.value),className:"w-3 h-3"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs",children:C.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:C.desc})]})]},C.id))})]})]})]})]})]})})]}),r&&e.jsx(P,{children:e.jsx(O,{className:"py-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:r.name}),e.jsxs("span",{className:"text-muted-foreground",children:["(",r.industry,")"]})]}),e.jsx("div",{className:"text-muted-foreground",children:""}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Focus: ",(xe=d.find(C=>C.id===t))==null?void 0:xe.label]})]}),e.jsx("div",{className:"text-muted-foreground",children:""}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(os,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Type: ",(ae=k.find(C=>C.id===n))==null?void 0:ae.label]})]}),V&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-muted-foreground",children:""}),e.jsxs("div",{className:"flex items-center space-x-2",children:[V==="agents"?e.jsx(Ye,{className:"h-4 w-4 text-green-600"}):e.jsx(me,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:V==="agents"?"text-green-600":"text-blue-600",children:V==="agents"?`AI Agents (${N})`:"Direct LLM"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-muted-foreground",children:[w>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsxs("span",{children:[w,"ms"]})]}),p&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsxs("span",{children:["Updated ",new Date(p).toLocaleTimeString()]})]})]})]})})}),c&&e.jsx(P,{children:e.jsx(O,{className:"py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(me,{className:"h-12 w-12 text-primary animate-pulse"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Generating AI Insights"}),e.jsxs("p",{className:"text-muted-foreground",children:["Analyzing ",r==null?void 0:r.name," data with machine learning models..."]})]}),e.jsxs("div",{className:"flex justify-center space-x-1",children:[e.jsx("div",{className:"h-2 w-2 bg-primary rounded-full animate-bounce"}),e.jsx("div",{className:"h-2 w-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"h-2 w-2 bg-primary rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})}),!c&&o&&e.jsxs(P,{className:"border-primary/20 bg-primary/5",children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(Ye,{className:"h-5 w-5 text-primary"}),e.jsx("span",{children:"Executive Summary"}),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground ml-2",children:[o.confidence,"% confidence"]})]})}),e.jsxs(O,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm leading-relaxed",children:o.overview}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center space-x-2",children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{children:"Key Findings"})]}),e.jsx("ul",{className:"space-y-1",children:o.keyFindings.map((C,E)=>e.jsxs("li",{className:"text-sm text-muted-foreground flex items-start space-x-2",children:[e.jsx(gs,{className:"h-3 w-3 text-green-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:C})]},E))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center space-x-2",children:[e.jsx(es,{className:"h-4 w-4"}),e.jsx("span",{children:"Priority Actions"})]}),e.jsx("ul",{className:"space-y-1",children:o.priorityActions.map((C,E)=>e.jsxs("li",{className:"text-sm text-muted-foreground flex items-start space-x-2",children:[e.jsx(X,{className:"h-3 w-3 text-orange-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:C})]},E))})]})]})]})]}),!c&&l.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center space-x-2",children:[e.jsx(os,{className:"h-5 w-5"}),e.jsx("span",{children:"AI-Generated Insights"}),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",l.length," insights)"]})]}),e.jsx(Gr,{rawContent:b}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4 flex items-center space-x-2",children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{children:"Key Insights Summary"})]}),e.jsx("div",{className:"grid gap-4",children:l.map(C=>e.jsxs(P,{className:q("border-l-4",H(C.severity)),children:[e.jsx(F,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs($,{className:"text-base flex items-center space-x-2",children:[U(C.severity),e.jsx("span",{children:C.title}),e.jsx("span",{className:"text-xs font-normal px-2 py-1 bg-secondary rounded",children:C.type})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[C.confidence,"% confidence"]}),e.jsx("span",{children:""}),e.jsx("span",{children:new Date(C.timestamp).toLocaleTimeString()})]})]})}),e.jsxs(O,{className:"pt-0",children:[e.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:C.content}),C.metrics&&e.jsx("div",{className:"mt-3 pt-3 border-t border-border/50",children:e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[C.metrics.score&&e.jsxs("span",{children:["Score: ",C.metrics.score]}),C.metrics.trend&&e.jsxs("span",{children:["Trend: ",C.metrics.trend>0?"+":"",C.metrics.trend]}),C.metrics.change&&e.jsxs("span",{children:["Change: ",C.metrics.change]})]})})]})]},C.id))})]})]}),!c&&b&&!1,!c&&l.length===0&&!o&&e.jsx(P,{children:e.jsxs(O,{className:"py-12 text-center",children:[e.jsx(me,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold mb-2",children:"No Insights Available"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Select a tenant and focus area to generate AI insights."}),e.jsx(M,{onClick:()=>x(S),disabled:!r,children:"Generate Insights"})]})})]})};class Kr{constructor(){ee(this,"STORAGE_KEY_PREFIX","grc_encrypted_credentials");ee(this,"SETTINGS_KEY_PREFIX","grc_security_settings");ee(this,"encryptionKey",null);ee(this,"tenantId",null)}setTenantContext(s){this.tenantId=s}getTenantStorageKey(){if(!this.tenantId)throw new Error("Tenant context not set. Call setTenantContext() first.");return`${this.STORAGE_KEY_PREFIX}_${this.tenantId}`}getTenantSettingsKey(){if(!this.tenantId)throw new Error("Tenant context not set. Call setTenantContext() first.");return`${this.SETTINGS_KEY_PREFIX}_${this.tenantId}`}async initialize(){try{if(!window.crypto||!window.crypto.subtle)throw new Error("Web Crypto API not available");await this.getOrCreateEncryptionKey()}catch(s){throw console.error("Failed to initialize credentials manager:",s),s}}async getOrCreateEncryptionKey(){try{const s=await this.deriveKeyMaterial();return this.encryptionKey=await window.crypto.subtle.importKey("raw",s,{name:"AES-GCM"},!1,["encrypt","decrypt"]),this.encryptionKey}catch(s){throw console.error("Failed to create encryption key:",s),s}}async deriveKeyMaterial(){const s=this.getSessionInfo(),a=new TextEncoder().encode(s);return await window.crypto.subtle.digest("SHA-256",a)}getSessionInfo(){const s=localStorage.getItem("auth_user"),t=this.getDeviceIdentifier();return`${s||"default"}:${t}:grc-platform-v1`}getDeviceIdentifier(){let s=localStorage.getItem("device_id");return s||(s=this.generateDeviceId(),localStorage.setItem("device_id",s)),s}generateDeviceId(){const s=new Uint8Array(16);return window.crypto.getRandomValues(s),Array.from(s,t=>t.toString(16).padStart(2,"0")).join("")}async encryptCredentials(s){this.encryptionKey||await this.initialize();try{const t={username:s.username,password:s.password,instanceId:s.instanceId,userDomainId:s.userDomainId},a=window.crypto.getRandomValues(new Uint8Array(12)),n=window.crypto.getRandomValues(new Uint8Array(16)),o=new TextEncoder().encode(JSON.stringify(t)),m=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},this.encryptionKey,o),l=this.arrayBufferToBase64(m),h=this.arrayBufferToBase64(a.buffer),c=this.arrayBufferToBase64(n.buffer);return{id:s.id,name:s.name,baseUrl:s.baseUrl,encryptedData:l,iv:h,salt:c,isDefault:s.isDefault,created:s.created,lastTested:s.lastTested,status:s.status,lastError:s.lastError}}catch(t){throw console.error("Failed to encrypt credentials:",t),new Error("Encryption failed")}}async decryptCredentials(s){this.encryptionKey||await this.initialize();try{const t=this.base64ToArrayBuffer(s.encryptedData),a=this.base64ToArrayBuffer(s.iv),n=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a},this.encryptionKey,t),o=new TextDecoder().decode(n),m=JSON.parse(o);return{id:s.id,name:s.name,baseUrl:s.baseUrl,username:m.username,password:m.password,instanceId:m.instanceId,userDomainId:m.userDomainId,isDefault:s.isDefault,created:s.created,lastTested:s.lastTested,status:s.status,lastError:s.lastError}}catch(t){throw console.error("Failed to decrypt credentials:",t),new Error("Decryption failed - credentials may be corrupted")}}async storeCredentials(s){try{const t=await Promise.all(s.map(a=>this.encryptCredentials(a)));localStorage.setItem(this.getTenantStorageKey(),JSON.stringify(t))}catch(t){throw console.error("Failed to store credentials:",t),t}}async loadCredentials(){try{const s=localStorage.getItem(this.getTenantStorageKey());if(!s)return[];const t=JSON.parse(s);return await Promise.all(t.map(a=>this.decryptCredentials(a)))}catch(s){return console.error("Failed to load credentials:",s),localStorage.removeItem(this.getTenantStorageKey()),[]}}async testConnection(s){const t=Date.now();try{console.log(`Testing connection to ${s.baseUrl}...`),await new Promise(o=>setTimeout(o,1e3+Math.random()*2e3));const a=this.validateCredentials(s),n=Date.now()-t;return a?Math.random()>.2?{success:!0,message:"Connection successful",details:{responseTime:n,version:"6.10.0.1",instanceInfo:{instanceId:s.instanceId,userDomain:s.userDomainId}}}:{success:!1,message:"Connection failed",error:"Server timeout or configuration error",details:{responseTime:n}}:{success:!1,message:"Authentication failed",error:"Invalid credentials or server unreachable",details:{responseTime:n}}}catch(a){return{success:!1,message:"Connection test failed",error:a instanceof Error?a.message:"Unknown error",details:{responseTime:Date.now()-t}}}}validateCredentials(s){if(!s.baseUrl||!s.username||!s.password)return!1;try{new URL(s.baseUrl)}catch{return!1}return!(!s.instanceId||!s.userDomainId)}getSecuritySettings(){const s=localStorage.getItem(this.getTenantSettingsKey());return s?JSON.parse(s):{encryptionEnabled:!0}}updateSecuritySettings(s){const a={...this.getSecuritySettings(),...s,lastUpdated:new Date().toISOString()};localStorage.setItem(this.getTenantSettingsKey(),JSON.stringify(a))}clearAllCredentials(){this.tenantId&&(localStorage.removeItem(this.getTenantStorageKey()),localStorage.removeItem(this.getTenantSettingsKey())),this.encryptionKey=null,this.tenantId=null}arrayBufferToBase64(s){const t=new Uint8Array(s);let a="";for(let n=0;n<t.byteLength;n++)a+=String.fromCharCode(t[n]);return window.btoa(a)}base64ToArrayBuffer(s){const t=window.atob(s),a=new ArrayBuffer(t.length),n=new Uint8Array(a);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return a}}const pe=new Kr;async function Xe(){try{return await pe.loadCredentials()}catch(r){return console.error("Error loading credentials:",r),[]}}const bt=Object.freeze(Object.defineProperty({__proto__:null,credentialsManager:pe,default:pe,getAllCredentials:Xe},Symbol.toStringTag,{value:"Module"})),Hr=()=>{const[r,s]=g.useState([]),[t,a]=g.useState({encryptionEnabled:!0,sessionTimeout:30,logLevel:"info",maxConcurrentConnections:5,connectionTimeout:1e4,retryAttempts:3}),[n,i]=g.useState({}),[o,m]=g.useState(null),[l,h]=g.useState({}),[c,u]=g.useState(!1),[p,y]=g.useState(new Set),[S,f]=g.useState(!0),[b,j]=g.useState(null);g.useEffect(()=>{w()},[]);const w=async()=>{try{f(!0),j(null),await pe.initialize(),await T(),D()}catch(v){console.error("Failed to initialize secure storage:",v),j(v instanceof Error?v.message:"Encryption initialization failed")}finally{f(!1)}},T=async()=>{try{const v=await pe.loadCredentials();if(v.length===0){const _={id:"default",name:"Production Archer",baseUrl:"https://archer.company.com",username:"",password:"",instanceId:"",userDomainId:"",isDefault:!0,status:"disconnected",created:new Date().toISOString()};s([_])}else s(v)}catch(v){console.error("Failed to load connections:",v),j("Failed to load credentials - encryption may be corrupted")}},D=()=>{try{const v=localStorage.getItem("system_settings");v&&a({...t,...JSON.parse(v)})}catch(v){console.error("Failed to load system settings:",v)}},I=async v=>{try{await pe.storeCredentials(v),s(v)}catch(_){console.error("Failed to save connections:",_),j("Failed to save credentials - storage error")}},N=v=>{try{localStorage.setItem("system_settings",JSON.stringify(v)),a(v)}catch(_){console.error("Failed to save system settings:",_)}},G=async v=>{const _=r.find(B=>B.id===v);if(_){y(B=>new Set(B).add(v));try{const B=r.map(H=>H.id===v?{...H,status:"testing"}:H);s(B);const A=await pe.testConnection(_),U=r.map(H=>H.id===v?{...H,status:A.success?"connected":"error",lastTested:new Date().toISOString(),lastError:A.success?void 0:A.error||A.message}:H);await I(U)}catch(B){const A=r.map(U=>U.id===v?{...U,status:"error",lastTested:new Date().toISOString(),lastError:B instanceof Error?B.message:"Connection test failed"}:U);await I(A)}finally{y(B=>{const A=new Set(B);return A.delete(v),A})}}},V=async(v,_)=>{const B=r.map(A=>A.id===v?{...A,..._}:A);await I(B),m(null)},Z=async()=>{if(!l.name||!l.baseUrl)return;const v={id:`conn_${Date.now()}`,name:l.name,baseUrl:l.baseUrl,username:l.username||"",password:l.password||"",instanceId:l.instanceId||"",userDomainId:l.userDomainId||"",isDefault:r.length===0,status:"disconnected",created:new Date().toISOString()};await I([...r,v]),h({}),u(!1)},d=async v=>{const _=r.filter(B=>B.id!==v);await I(_)},k=async v=>{const _=r.map(B=>({...B,isDefault:B.id===v}));await I(_)},x=v=>{i(_=>({..._,[v]:!_[v]}))},L=v=>{switch(v){case"connected":return e.jsx(Y,{className:"h-4 w-4 text-green-600"});case"testing":return e.jsx(Ne,{className:"h-4 w-4 text-blue-600 animate-spin"});case"error":return e.jsx(ue,{className:"h-4 w-4 text-red-600"});default:return e.jsx(X,{className:"h-4 w-4 text-gray-600"})}},K=v=>{switch(v){case"connected":return"bg-green-100 text-green-800 border-green-200";case"testing":return"bg-blue-100 text-blue-800 border-blue-200";case"error":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return S?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(Ne,{className:"h-8 w-8 text-primary animate-spin"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Initializing Secure Storage"}),e.jsx("p",{className:"text-muted-foreground",children:"Setting up encryption for credential management..."})]})]})})}):e.jsxs("div",{className:"space-y-6",children:[b&&e.jsx(P,{className:"border-red-200 bg-red-50",children:e.jsx(O,{className:"p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(ue,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900 mb-1",children:"Encryption Error"}),e.jsx("p",{className:"text-red-700 text-sm",children:b}),e.jsxs(M,{onClick:w,variant:"outline",size:"sm",className:"mt-2",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Retry Initialization"]})]})]})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold tracking-tight flex items-center space-x-3",children:[e.jsx(Bs,{className:"h-8 w-8 text-primary"}),e.jsx("span",{children:"Connections"})]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Manage Archer connections, credentials, and system configurations"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(M,{onClick:()=>u(!0),variant:"outline",size:"sm",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Add Connection"]})})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"h-5 w-5"}),e.jsx("span",{children:"Archer GRC Connections"})]})}),e.jsxs(O,{className:"space-y-4",children:[c&&e.jsxs(P,{className:"border-dashed border-primary/50",children:[e.jsx(F,{className:"pb-3",children:e.jsx($,{className:"text-sm",children:"Add New Archer Connection"})}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Connection Name"}),e.jsx("input",{type:"text",value:l.name||"",onChange:v=>h(_=>({..._,name:v.target.value})),className:"w-full p-2 border rounded-md text-sm",placeholder:"Production Archer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Base URL"}),e.jsx("input",{type:"url",value:l.baseUrl||"",onChange:v=>h(_=>({..._,baseUrl:v.target.value})),className:"w-full p-2 border rounded-md text-sm",placeholder:"https://archer.company.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Username"}),e.jsx("input",{type:"text",value:l.username||"",onChange:v=>h(_=>({..._,username:v.target.value})),className:"w-full p-2 border rounded-md text-sm",placeholder:"service_account"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Password"}),e.jsx("input",{type:"password",value:l.password||"",onChange:v=>h(_=>({..._,password:v.target.value})),className:"w-full p-2 border rounded-md text-sm",placeholder:""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Instance ID"}),e.jsx("input",{type:"text",value:l.instanceId||"",onChange:v=>h(_=>({..._,instanceId:v.target.value})),className:"w-full p-2 border rounded-md text-sm",placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"User Domain ID"}),e.jsx("input",{type:"text",value:l.userDomainId||"",onChange:v=>h(_=>({..._,userDomainId:v.target.value})),className:"w-full p-2 border rounded-md text-sm",placeholder:"1"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(M,{onClick:()=>{u(!1),h({})},variant:"outline",size:"sm",children:"Cancel"}),e.jsxs(M,{onClick:Z,disabled:!l.name||!l.baseUrl,size:"sm",children:[e.jsx(Gt,{className:"h-4 w-4 mr-2"}),"Add Connection"]})]})]})]}),e.jsx("div",{className:"space-y-4",children:r.map(v=>e.jsx(P,{className:q("transition-all",v.isDefault&&"border-primary/50 bg-primary/5"),children:e.jsx(O,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(Qe,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold flex items-center space-x-2",children:[e.jsx("span",{children:v.name}),v.isDefault&&e.jsx("span",{className:"text-xs bg-primary text-white px-2 py-1 rounded",children:"Default"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:v.baseUrl})]})]}),o===v.id?e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Username"}),e.jsx("input",{type:"text",value:v.username,onChange:_=>V(v.id,{username:_.target.value}),className:"w-full p-2 border rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:n[v.id]?"text":"password",value:v.password,onChange:_=>V(v.id,{password:_.target.value}),className:"w-full p-2 border rounded text-sm pr-8"}),e.jsx("button",{onClick:()=>x(v.id),className:"absolute right-2 top-2 text-muted-foreground hover:text-foreground",children:n[v.id]?e.jsx(Ns,{className:"h-4 w-4"}):e.jsx(Ge,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"Instance ID"}),e.jsx("input",{type:"text",value:v.instanceId,onChange:_=>V(v.id,{instanceId:_.target.value}),className:"w-full p-2 border rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium block mb-1",children:"User Domain ID"}),e.jsx("input",{type:"text",value:v.userDomainId,onChange:_=>V(v.id,{userDomainId:_.target.value}),className:"w-full p-2 border rounded text-sm"})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Username:"}),e.jsx("span",{className:"ml-2",children:v.username||"Not set"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Password:"}),e.jsx("span",{className:"ml-2",children:v.password?"":"Not set"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Instance ID:"}),e.jsx("span",{className:"ml-2",children:v.instanceId||"Not set"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"User Domain:"}),e.jsx("span",{className:"ml-2",children:v.userDomainId||"Not set"})]})]}),e.jsx("div",{className:"flex items-center justify-between mt-4 pt-3 border-t",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:q("px-2 py-1 rounded-full text-xs font-medium border flex items-center space-x-1",K(v.status)),children:[L(v.status),e.jsx("span",{className:"capitalize",children:v.status})]}),v.lastTested&&e.jsxs("div",{className:"text-xs text-muted-foreground flex items-center space-x-1",children:[e.jsx(Ie,{className:"h-3 w-3"}),e.jsxs("span",{children:["Tested ",new Date(v.lastTested).toLocaleString()]})]})]})}),v.lastError&&e.jsx("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-700",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(ue,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:v.lastError})]})})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs(M,{onClick:()=>G(v.id),disabled:p.has(v.id),variant:"outline",size:"sm",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Test"]}),e.jsxs(M,{onClick:()=>m(o===v.id?null:v.id),variant:"outline",size:"sm",children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Edit"]}),!v.isDefault&&e.jsxs(M,{onClick:()=>k(v.id),variant:"outline",size:"sm",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Set Default"]}),r.length>1&&e.jsxs(M,{onClick:()=>d(v.id),variant:"outline",size:"sm",className:"text-red-600 hover:bg-red-50",children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})},v.id))})]})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"h-5 w-5"}),e.jsx("span",{children:"System Settings"})]})}),e.jsxs(O,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-sm mb-3 flex items-center space-x-2",children:[e.jsx(Ft,{className:"h-4 w-4"}),e.jsx("span",{children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Credential Encryption"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"AES-256-GCM encryption for stored credentials"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"text-xs text-green-600 font-medium",children:"ACTIVE"}),e.jsx(Y,{className:"h-4 w-4 text-green-600"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground bg-green-50 border border-green-200 rounded p-2",children:"All credentials are automatically encrypted using Web Crypto API with AES-256-GCM. Encryption keys are derived from your session and device fingerprint."}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Session Timeout"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Auto-logout after inactivity (minutes)"})]}),e.jsxs("select",{value:t.sessionTimeout,onChange:v=>N({...t,sessionTimeout:parseInt(v.target.value)}),className:"text-sm border rounded p-1",children:[e.jsx("option",{value:15,children:"15 minutes"}),e.jsx("option",{value:30,children:"30 minutes"}),e.jsx("option",{value:60,children:"1 hour"}),e.jsx("option",{value:120,children:"2 hours"}),e.jsx("option",{value:240,children:"4 hours"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium text-sm mb-3 flex items-center space-x-2",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Connection Settings"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Max Concurrent Connections"}),e.jsx("input",{type:"number",min:"1",max:"10",value:t.maxConcurrentConnections,onChange:v=>N({...t,maxConcurrentConnections:parseInt(v.target.value)}),className:"w-full p-2 border rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Connection Timeout (ms)"}),e.jsx("input",{type:"number",min:"5000",max:"60000",step:"1000",value:t.connectionTimeout,onChange:v=>N({...t,connectionTimeout:parseInt(v.target.value)}),className:"w-full p-2 border rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Retry Attempts"}),e.jsx("input",{type:"number",min:"1",max:"5",value:t.retryAttempts,onChange:v=>N({...t,retryAttempts:parseInt(v.target.value)}),className:"w-full p-2 border rounded text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium block mb-1",children:"Log Level"}),e.jsxs("select",{value:t.logLevel,onChange:v=>N({...t,logLevel:v.target.value}),className:"w-full p-2 border rounded text-sm",children:[e.jsx("option",{value:"error",children:"Error"}),e.jsx("option",{value:"warn",children:"Warning"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"debug",children:"Debug"})]})]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(re,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Security Implementation"}),e.jsxs("div",{className:"text-blue-700 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:" End-to-End Encryption:"})," All credentials are encrypted using AES-256-GCM before storage."]}),e.jsxs("p",{children:[e.jsx("strong",{children:" Secure Key Derivation:"})," Encryption keys are derived from your session and device fingerprint."]}),e.jsxs("p",{children:[e.jsx("strong",{children:" Web Crypto API:"})," Browser-native cryptographic functions ensure maximum security."]}),e.jsx("p",{className:"text-xs mt-2 text-blue-600",children:"For enterprise deployments, consider implementing HSM-backed credential vaults and centralized key management."})]})]})]})})]})]})]})},ne=g.forwardRef(({className:r,type:s="text",error:t,...a},n)=>e.jsx("input",{type:s,className:q("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-colors",t&&"border-destructive focus-visible:ring-destructive",r),ref:n,...a}));ne.displayName="Input";const J=g.forwardRef(({className:r,children:s,required:t,...a},n)=>e.jsxs("label",{ref:n,className:q("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",r),...a,children:[s,t&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}));J.displayName="Label";const us={name:"",baseUrl:"",instanceName:"v5.0",username:"",password:"",userDomain:""},Vr=["v5.0","v6.0","Archer","Default"],Be={name:'A friendly name to identify this connection (e.g., "Production Archer", "Test Environment")',baseUrl:'The base URL of your Archer platform (e.g., "https://archer.yourcompany.com" or "http://10.1.2.3")',instanceName:'The Archer instance name, typically "v5.0" or "v6.0". Check with your administrator if unsure.',username:"Your Archer username for authentication",password:"Your Archer password. This will be encrypted and stored securely.",userDomain:"Optional user domain if your Archer instance uses domain authentication. Leave blank if not needed."},Br=({onConnectionChange:r,className:s})=>{const{tenant:t}=oe(),[a,n]=g.useState([]),[i,o]=g.useState(null),[m,l]=g.useState(!1),[h,c]=g.useState(!0),[u,p]=g.useState(!1),[y,S]=g.useState(!1),[f,b]=g.useState(us),[j,w]=g.useState({}),[T,D]=g.useState(!1),[I,N]=g.useState(null),[G,V]=g.useState(null);g.useEffect(()=>{(async()=>{if(!t){c(!1);return}try{pe.setTenantContext(t.id),await pe.initialize();const U=await pe.loadCredentials();n(U);const H=U.find(Te=>Te.isDefault)||U[0];H&&(o(H),r==null||r(H))}catch(U){console.error("Failed to load connections:",U)}finally{c(!1)}})()},[t==null?void 0:t.id,r]);const Z=g.useCallback(()=>{const A={};if(f.name.trim()||(A.name="Connection name is required"),!f.baseUrl.trim())A.baseUrl="Server URL is required";else try{new URL(f.baseUrl),f.baseUrl.match(/^https?:\/\//)||(A.baseUrl="URL must start with http:// or https://")}catch{A.baseUrl="Please enter a valid URL"}return f.instanceName.trim()||(A.instanceName="Instance name is required"),f.username.trim()||(A.username="Username is required"),f.password.trim()||(A.password="Password is required"),w(A),Object.keys(A).length===0},[f]),d=(A,U)=>{b(H=>({...H,[A]:U})),j[A]&&w(H=>({...H,[A]:void 0}))},k=async()=>{if(!t){console.error("No tenant context available");return}pe.setTenantContext(t.id);let A;if(m){if(!Z())return;A=f}else if(i)A={name:i.name,baseUrl:i.baseUrl,instanceName:i.instanceId,username:i.username,password:i.password,userDomain:i.userDomainId==="1"?"":i.userDomainId};else{console.error("No connection data available for testing");return}p(!0),N(null);try{const U={id:"test-connection",name:A.name,baseUrl:A.baseUrl,username:A.username,password:A.password,instanceId:A.instanceName,userDomainId:A.userDomain||"1",isDefault:!1,created:new Date().toISOString(),status:"testing"},H=await pe.testConnection(U);if(N(H),!m&&i){const Te=a.map(Ee=>Ee.id===i.id?{...Ee,status:H.success?"connected":"error",lastTested:new Date().toISOString(),lastError:H.error}:Ee);n(Te);const Ke=Te.find(Ee=>Ee.id===i.id);Ke&&(o(Ke),r==null||r(Ke))}}catch(U){N({success:!1,message:"Connection test failed",error:U instanceof Error?U.message:"Unknown error"})}finally{p(!1)}},x=async()=>{if(Z()){if(!t){console.error("No tenant context available");return}pe.setTenantContext(t.id),S(!0);try{const A={id:(i==null?void 0:i.id)||`archer-${Date.now()}`,name:f.name,baseUrl:f.baseUrl,username:f.username,password:f.password,instanceId:f.instanceName,userDomainId:f.userDomain||"1",isDefault:a.length===0,created:(i==null?void 0:i.created)||new Date().toISOString(),status:"disconnected"};let U;i?U=a.map(H=>H.id===i.id?A:H):U=[...a,A],await pe.storeCredentials(U),n(U),o(A),l(!1),r==null||r(A),b(us),N(null)}catch(A){console.error("Failed to save connection:",A)}finally{S(!1)}}},L=async A=>{if(!t){console.error("No tenant context available");return}pe.setTenantContext(t.id);try{const U=a.filter(H=>H.id!==A);if(await pe.storeCredentials(U),n(U),(i==null?void 0:i.id)===A){const H=U[0]||null;o(H),r==null||r(H)}}catch(U){console.error("Failed to delete connection:",U)}},K=A=>{o(A),b({name:A.name,baseUrl:A.baseUrl,instanceName:A.instanceId,username:A.username,password:A.password,userDomain:A.userDomainId==="1"?"":A.userDomainId}),l(!0),N(null)},v=()=>{o(null),b(us),w({}),l(!0),N(null)},_=()=>{l(!1),b(us),w({}),N(null)},B=async(A,U)=>{try{await navigator.clipboard.writeText(A),V(U),setTimeout(()=>V(null),2e3)}catch(H){console.error("Failed to copy:",H)}};return h?e.jsx(P,{className:s,children:e.jsx(O,{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading connections..."})]})})}):e.jsxs("div",{className:q("space-y-6",s),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-6 w-6 text-primary"}),e.jsx("span",{children:"Archer GRC Connections"})]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Configure secure connections to your Archer GRC platform instances"})]}),e.jsxs(M,{onClick:v,className:"flex items-center space-x-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsx("span",{children:"New Connection"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(P,{className:"lg:col-span-1",children:[e.jsxs(F,{children:[e.jsx($,{className:"text-lg",children:"Saved Connections"}),e.jsx(Fs,{children:"Select a connection to view details or create a new one"})]}),e.jsx(O,{children:a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"h-8 w-8 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"No connections configured yet"}),e.jsx(M,{variant:"outline",size:"sm",onClick:v,children:"Create First Connection"})]}):e.jsx("div",{className:"space-y-2",children:a.map(A=>e.jsx("div",{className:q("p-3 rounded-lg border cursor-pointer transition-all hover:bg-muted/50",(i==null?void 0:i.id)===A.id?"border-primary bg-primary/5":"border-border"),onClick:()=>o(A),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium text-sm truncate",children:A.name}),A.isDefault&&e.jsx(z,{variant:"secondary",className:"text-xs",children:"Default"})]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate mt-1",children:A.baseUrl}),e.jsx("div",{className:"flex items-center space-x-2 mt-2",children:e.jsxs("div",{className:q("flex items-center space-x-1 text-xs",A.status==="connected"?"text-green-600":A.status==="error"?"text-red-600":"text-muted-foreground"),children:[A.status==="connected"?e.jsx(Us,{className:"h-3 w-3"}):A.status==="error"?e.jsx(ys,{className:"h-3 w-3"}):e.jsx(ke,{className:"h-3 w-3"}),e.jsx("span",{className:"capitalize",children:A.status})]})})]}),e.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[e.jsx(M,{variant:"ghost",size:"sm",onClick:U=>{U.stopPropagation(),K(A)},className:"h-6 w-6 p-0",children:e.jsx(ut,{className:"h-3 w-3"})}),e.jsx(M,{variant:"ghost",size:"sm",onClick:U=>{U.stopPropagation(),L(A.id)},className:"h-6 w-6 p-0 text-red-600 hover:text-red-700",children:e.jsx(ds,{className:"h-3 w-3"})})]})]})},A.id))})})]}),e.jsxs(P,{className:"lg:col-span-2",children:[e.jsxs(F,{children:[e.jsx($,{className:"flex items-center space-x-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-5 w-5"}),e.jsx("span",{children:i?"Edit Connection":"New Connection"})]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-5 w-5"}),e.jsx("span",{children:"Connection Details"})]})}),i&&!m&&e.jsxs(Fs,{children:["Connection details for ",i.name]})]}),e.jsx(O,{children:!i&&!m?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ce,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Select a Connection"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Choose a connection from the list or create a new one to get started"}),e.jsxs(M,{onClick:v,children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Create New Connection"]})]}):m?e.jsxs("div",{className:"space-y-6",children:[I&&e.jsxs(Q,{variant:I.success?"success":"destructive",title:I.success?"Connection Successful":"Connection Failed",dismissible:!0,onDismiss:()=>N(null),children:[e.jsx("p",{children:I.message}),I.details&&e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsxs("p",{children:["Response time: ",I.details.responseTime,"ms"]}),I.details.version&&e.jsxs("p",{children:["Archer version: ",I.details.version]})]}),I.error&&e.jsx("p",{className:"mt-2 text-xs font-mono bg-destructive/10 p-2 rounded",children:I.error})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b",children:[e.jsx(Ht,{className:"h-4 w-4 text-primary"}),e.jsx("h3",{className:"font-medium",children:"Connection Information"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{htmlFor:"name",required:!0,children:"Connection Name"}),e.jsxs("div",{className:"group relative",children:[e.jsx(He,{className:"h-3 w-3 text-muted-foreground cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 invisible group-hover:visible bg-popover text-popover-foreground text-xs p-2 rounded border shadow-sm w-64 z-10",children:Be.name})]})]}),e.jsx(ne,{id:"name",value:f.name,onChange:A=>d("name",A.target.value),placeholder:"e.g., Production Archer",error:!!j.name}),j.name&&e.jsx("p",{className:"text-xs text-destructive",children:j.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{htmlFor:"baseUrl",required:!0,children:"Server URL"}),e.jsxs("div",{className:"group relative",children:[e.jsx(He,{className:"h-3 w-3 text-muted-foreground cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 invisible group-hover:visible bg-popover text-popover-foreground text-xs p-2 rounded border shadow-sm w-64 z-10",children:Be.baseUrl})]})]}),e.jsx(ne,{id:"baseUrl",value:f.baseUrl,onChange:A=>d("baseUrl",A.target.value),placeholder:"https://archer.yourcompany.com",error:!!j.baseUrl}),j.baseUrl&&e.jsx("p",{className:"text-xs text-destructive",children:j.baseUrl})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{htmlFor:"instanceName",required:!0,children:"Instance Name"}),e.jsxs("div",{className:"group relative",children:[e.jsx(He,{className:"h-3 w-3 text-muted-foreground cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 invisible group-hover:visible bg-popover text-popover-foreground text-xs p-2 rounded border shadow-sm w-64 z-10",children:Be.instanceName})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{id:"instanceName",value:f.instanceName,onChange:A=>d("instanceName",A.target.value),placeholder:"v5.0",error:!!j.instanceName}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Common: ",Vr.slice(0,2).join(", ")]})})]}),j.instanceName&&e.jsx("p",{className:"text-xs text-destructive",children:j.instanceName})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b",children:[e.jsx(re,{className:"h-4 w-4 text-primary"}),e.jsx("h3",{className:"font-medium",children:"Authentication"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{htmlFor:"username",required:!0,children:"Username"}),e.jsxs("div",{className:"group relative",children:[e.jsx(He,{className:"h-3 w-3 text-muted-foreground cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 invisible group-hover:visible bg-popover text-popover-foreground text-xs p-2 rounded border shadow-sm w-64 z-10",children:Be.username})]})]}),e.jsx(ne,{id:"username",value:f.username,onChange:A=>d("username",A.target.value),placeholder:"your.username",error:!!j.username}),j.username&&e.jsx("p",{className:"text-xs text-destructive",children:j.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{htmlFor:"password",required:!0,children:"Password"}),e.jsxs("div",{className:"group relative",children:[e.jsx(He,{className:"h-3 w-3 text-muted-foreground cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 invisible group-hover:visible bg-popover text-popover-foreground text-xs p-2 rounded border shadow-sm w-64 z-10",children:Be.password})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{id:"password",type:T?"text":"password",value:f.password,onChange:A=>d("password",A.target.value),placeholder:"Enter your password",error:!!j.password}),e.jsx("button",{type:"button",onClick:()=>D(!T),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-muted-foreground hover:text-foreground",children:T?e.jsx(Ns,{className:"h-4 w-4"}):e.jsx(Ge,{className:"h-4 w-4"})})]}),j.password&&e.jsx("p",{className:"text-xs text-destructive",children:j.password})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{htmlFor:"userDomain",children:"User Domain"}),e.jsx(z,{variant:"secondary",className:"text-xs",children:"Optional"}),e.jsxs("div",{className:"group relative",children:[e.jsx(He,{className:"h-3 w-3 text-muted-foreground cursor-help"}),e.jsx("div",{className:"absolute left-0 top-6 invisible group-hover:visible bg-popover text-popover-foreground text-xs p-2 rounded border shadow-sm w-64 z-10",children:Be.userDomain})]})]}),e.jsx(ne,{id:"userDomain",value:f.userDomain,onChange:A=>d("userDomain",A.target.value),placeholder:"Leave blank if not needed"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(M,{onClick:k,disabled:u||y,variant:"outline",className:"flex items-center space-x-2",children:[u?e.jsx(ce,{className:"h-4 w-4 animate-spin"}):e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Connection"})]}),(I==null?void 0:I.success)&&e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Connection verified"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{onClick:_,disabled:y,variant:"outline",children:"Cancel"}),e.jsxs(M,{onClick:x,disabled:u||y,className:"flex items-center space-x-2",children:[y&&e.jsx(ce,{className:"h-4 w-4 animate-spin"}),e.jsxs("span",{children:[i?"Update":"Save"," Connection"]})]})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b",children:[e.jsx(Ce,{className:"h-4 w-4 text-primary"}),e.jsx("h3",{className:"font-medium",children:"Connection Details"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Name:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:i==null?void 0:i.name}),(i==null?void 0:i.isDefault)&&e.jsx(z,{variant:"secondary",className:"text-xs",children:"Default"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Server URL:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-mono text-right max-w-64 truncate",children:i==null?void 0:i.baseUrl}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>B((i==null?void 0:i.baseUrl)||"","url"),className:"h-6 w-6 p-0",children:G==="url"?e.jsx(Ls,{className:"h-3 w-3 text-green-600"}):e.jsx(dt,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Instance:"}),e.jsx("span",{className:"text-sm font-medium",children:i==null?void 0:i.instanceId})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),e.jsxs("div",{className:q("flex items-center space-x-2 text-sm",(i==null?void 0:i.status)==="connected"?"text-green-600":(i==null?void 0:i.status)==="error"?"text-red-600":"text-muted-foreground"),children:[(i==null?void 0:i.status)==="connected"?e.jsx(Us,{className:"h-4 w-4"}):(i==null?void 0:i.status)==="error"?e.jsx(ys,{className:"h-4 w-4"}):e.jsx(ke,{className:"h-4 w-4"}),e.jsx("span",{className:"capitalize",children:i==null?void 0:i.status})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b",children:[e.jsx(re,{className:"h-4 w-4 text-primary"}),e.jsx("h3",{className:"font-medium",children:"Security & Authentication"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Username:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:i==null?void 0:i.username}),e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>B((i==null?void 0:i.username)||"","username"),className:"h-6 w-6 p-0",children:G==="username"?e.jsx(Ls,{className:"h-3 w-3 text-green-600"}):e.jsx(dt,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Password:"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:""})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"User Domain:"}),e.jsx("span",{className:"text-sm font-medium",children:(i==null?void 0:i.userDomainId)!=="1"?i==null?void 0:i.userDomainId:"Not configured"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Created:"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:i!=null&&i.created?new Date(i.created).toLocaleDateString():"Unknown"})]}),(i==null?void 0:i.lastTested)&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Last tested:"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(i.lastTested).toLocaleString()})]})]})]})]}),(i==null?void 0:i.lastError)&&e.jsxs(Q,{variant:"destructive",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Connection Error"}),e.jsx("p",{className:"text-sm mt-1",children:i.lastError})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"All credentials are encrypted and stored securely on your device"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(M,{onClick:()=>k(),disabled:u,variant:"outline",className:"flex items-center space-x-2",children:[u?e.jsx(ce,{className:"h-4 w-4 animate-spin"}):e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{children:"Test Connection"})]}),e.jsxs(M,{onClick:()=>K(i),className:"flex items-center space-x-2",children:[e.jsx(ut,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit Connection"})]})]})]})]})})]})]})]})},Wr=()=>{const r=s=>{console.log("Active connection changed:",s)};return e.jsx("div",{className:"container mx-auto px-6 py-8",children:e.jsx(Br,{onConnectionChange:r,className:"max-w-7xl mx-auto"})})},Js=g.createContext(null),Jr=({value:r,onValueChange:s,children:t,className:a})=>e.jsx(Js.Provider,{value:{value:r,onValueChange:s},children:e.jsx("div",{className:q("space-y-6",a),children:t})}),Yr=({children:r,className:s})=>e.jsx("div",{className:q("inline-flex h-10 items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500",s),children:r}),hs=({value:r,children:s,className:t})=>{const a=g.useContext(Js);if(!a)throw new Error("TabsTrigger must be used within a Tabs component");const{value:n,onValueChange:i}=a,o=n===r;return e.jsx("button",{type:"button",className:q("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",o?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50",t),onClick:()=>i(r),children:s})},xs=({value:r,children:s,className:t})=>{const a=g.useContext(Js);if(!a)throw new Error("TabsContent must be used within a Tabs component");const{value:n}=a;return n!==r?null:e.jsx("div",{className:q("mt-6 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),children:s})},Ys=({className:r,...s})=>e.jsx("textarea",{className:q("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...s}),Jt=g.createContext(void 0);function Xs({open:r,onOpenChange:s,children:t}){const[a,n]=g.useState(!1),i=r??a,o=s??n;return g.useEffect(()=>{const m=l=>{l.key==="Escape"&&i&&o(!1)};return i&&(document.addEventListener("keydown",m),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",m),document.body.style.overflow="unset"}},[i,o]),e.jsx(Jt.Provider,{value:{open:i,onOpenChange:o},children:t})}function Zs({children:r,className:s="",showClose:t=!0}){const a=g.useContext(Jt);if(!a)throw new Error("DialogContent must be used within a Dialog");const{open:n,onOpenChange:i}=a;return n?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>i(!1)}),e.jsxs("div",{className:`
          relative bg-white rounded-lg shadow-xl border border-gray-200 
          w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto
          animate-in fade-in-0 zoom-in-95 slide-in-from-bottom-2
          ${s}
        `,onClick:o=>o.stopPropagation(),children:[t&&e.jsx("button",{className:"absolute right-4 top-4 p-1 rounded-sm opacity-70 hover:opacity-100 transition-opacity z-10",onClick:()=>i(!1),children:e.jsx(Ws,{className:"h-4 w-4"})}),r]})]}):null}function Qs({children:r,className:s=""}){return e.jsx("div",{className:`px-6 py-4 border-b border-gray-200 ${s}`,children:r})}function et({children:r,className:s=""}){return e.jsx("h2",{className:`text-lg font-semibold text-gray-900 ${s}`,children:r})}function st({children:r,className:s=""}){return e.jsx("div",{className:`px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-lg ${s}`,children:r})}const Is=[{value:"azure-openai",label:"Azure OpenAI",models:["gpt-4o","gpt-4","gpt-4-turbo","gpt-35-turbo"],defaultEndpoint:"https://your-resource.openai.azure.com",requiresKey:!0,description:"Microsoft Azure OpenAI Service with enterprise security"},{value:"openai",label:"OpenAI",models:["gpt-4o","gpt-4","gpt-4-turbo","gpt-3.5-turbo"],defaultEndpoint:"https://api.openai.com/v1",requiresKey:!0,description:"Direct OpenAI API integration"},{value:"anthropic",label:"Anthropic",models:["claude-3-5-sonnet-20241022","claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"],defaultEndpoint:"https://api.anthropic.com",requiresKey:!0,description:"Anthropic Claude models with advanced reasoning"},{value:"custom",label:"Custom Endpoint",models:["custom-model"],defaultEndpoint:"",requiresKey:!0,description:"Custom LLM endpoint with configurable model and parameters"},{value:"ollama",label:"Ollama",models:["llama2","codellama","mistral","neural-chat"],defaultEndpoint:"http://localhost:11434",requiresKey:!1,description:"Local Ollama instance for private LLM hosting"}];function Nt({isOpen:r,onClose:s,onSave:t,editMode:a=!1,initialConfig:n}){oe();const[i,o]=g.useState({name:(n==null?void 0:n.name)||"",description:(n==null?void 0:n.description)||"",provider:(n==null?void 0:n.provider)||"azure-openai",model:(n==null?void 0:n.model)||"gpt-4o",endpoint:(n==null?void 0:n.endpoint)||"",apiKey:(n==null?void 0:n.apiKey)||"",customHeaders:(n==null?void 0:n.customHeaders)||{},maxTokens:(n==null?void 0:n.maxTokens)||4e3,temperature:(n==null?void 0:n.temperature)||.7}),[m,l]=g.useState(!1);g.useState(!1);const[h,c]=g.useState(!1),[u,p]=g.useState(!1),[y,S]=g.useState(null),[f,b]=g.useState(null),[j,w]=g.useState([]),T=Is.find(d=>d.value===i.provider);g.useEffect(()=>{r&&T&&o(d=>({...d,endpoint:T.defaultEndpoint,model:T.models[0]}))},[r,T]);const D=(d,k)=>{o(x=>({...x,[d]:k})),S(null)},I=d=>{const k=Is.find(x=>x.value===d);k&&o(x=>({...x,provider:d,endpoint:k.defaultEndpoint,model:k.models[0],apiKey:k.requiresKey?x.apiKey:""}))},N=d=>{w(d);const k={};d.forEach(x=>{x.key.trim()&&x.value.trim()&&(k[x.key.trim()]=x.value.trim())}),D("customHeaders",k)},G=()=>i.name.trim()?i.endpoint.trim()?!i.endpoint.startsWith("http://")&&!i.endpoint.startsWith("https://")?"Endpoint must be a valid HTTP/HTTPS URL":T!=null&&T.requiresKey&&!i.apiKey.trim()?"API key is required for this provider":i.maxTokens<100||i.maxTokens>32e3?"Max tokens must be between 100 and 32,000":i.temperature<0||i.temperature>2?"Temperature must be between 0 and 2":null:"Endpoint URL is required":"LLM configuration name is required",V=async()=>{const d=G();if(d){b({type:"error",text:d});return}c(!0),S(null),b({type:"info",text:`Testing ${i.provider} configuration...`});try{await new Promise(k=>setTimeout(k,3e3)),i.provider==="mock"?(S({success:!0,message:"Mock provider test successful"}),b({type:"success",text:"LLM configuration is working correctly"})):Math.random()>.3?(S({success:!0,message:`Successfully connected to ${T==null?void 0:T.label}`}),b({type:"success",text:"LLM endpoint is responding correctly"})):(S({success:!1,message:"Authentication failed or endpoint unreachable"}),b({type:"error",text:"Failed to connect to LLM endpoint - check your credentials"}))}catch(k){S({success:!1,message:k.message}),b({type:"error",text:`Test failed: ${k.message}`})}finally{c(!1)}},Z=async()=>{const d=G();if(d){b({type:"error",text:d});return}p(!0),b(null);try{const k={id:a?n.id:`llm-${Date.now()}`,name:i.name.trim(),description:i.description.trim()||`${T==null?void 0:T.label} configuration: ${i.model}`,provider:i.provider,model:i.model,endpoint:i.endpoint.trim(),apiKey:i.apiKey.trim(),customHeaders:Object.keys(i.customHeaders).length>0?i.customHeaders:void 0,maxTokens:i.maxTokens,temperature:i.temperature,isEnabled:a?n.isEnabled:!0,createdAt:a?n.createdAt:new Date().toISOString()};await t(k),o({name:"",description:"",provider:"azure-openai",model:"gpt-4o",endpoint:"",apiKey:"",customHeaders:{},maxTokens:4e3,temperature:.7}),w([]),S(null),b(null),s()}catch(k){b({type:"error",text:`Failed to add LLM configuration: ${k.message}`})}finally{p(!1)}};return e.jsx(Xs,{open:r,onOpenChange:s,children:e.jsxs(Zs,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Qs,{children:e.jsxs(et,{className:"flex items-center space-x-2",children:[e.jsx(Ae,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:a?"Edit LLM Configuration":"Add LLM Configuration"})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-blue-50 rounded-lg border border-blue-100",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-medium",children:"1"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Basic Info"})]}),e.jsx("div",{className:"w-8 h-px bg-blue-200"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-medium",children:"2"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Configuration"})]}),e.jsx("div",{className:"w-8 h-px bg-blue-200"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-medium",children:"3"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Parameters"})]})]}),e.jsxs(z,{variant:"outline",className:"bg-white border-blue-200 text-blue-700",children:[e.jsx(ss,{className:"h-3 w-3 mr-1"}),"LLM Setup"]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-xl bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-100 px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(he,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Basic Information"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Name and provider selection for your LLM configuration"})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"llmName",className:"text-sm font-medium text-gray-700",children:"Configuration Name *"}),e.jsx(ne,{id:"llmName",type:"text",value:i.name,onChange:d=>D("name",d.target.value),placeholder:"e.g., Production GPT-4o, Claude Sonnet Dev",disabled:u,className:"h-11"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose a descriptive name to identify this configuration"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"provider",className:"text-sm font-medium text-gray-700",children:"Provider *"}),e.jsx("select",{id:"provider",value:i.provider,onChange:d=>I(d.target.value),className:"w-full h-11 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",disabled:u,children:Is.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))}),e.jsx("p",{className:"text-xs text-gray-500",children:T==null?void 0:T.description})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"description",className:"text-sm font-medium text-gray-700",children:"Description (Optional)"}),e.jsx(Ys,{id:"description",value:i.description,onChange:d=>D("description",d.target.value),placeholder:"Brief description of when to use this LLM configuration...",rows:3,disabled:u,className:"resize-none"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Help team members understand when to use this configuration"})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-xl bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-100 px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(me,{className:"h-4 w-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Model Configuration"}),e.jsx("p",{className:"text-sm text-gray-500",children:"API endpoint, model selection, and authentication settings"})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"model",className:"text-sm font-medium text-gray-700",children:"Model *"}),i.provider==="custom"?e.jsx(ne,{id:"model",type:"text",value:i.model,onChange:d=>D("model",d.target.value),placeholder:"e.g., llama-2-70b, mistral-7b-instruct",disabled:u,className:"h-11 font-mono text-sm"}):e.jsx("select",{id:"model",value:i.model,onChange:d=>D("model",d.target.value),className:"w-full h-11 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",disabled:u,children:T==null?void 0:T.models.map(d=>e.jsx("option",{value:d,children:d},d))}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select the specific model variant to use"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"endpoint",className:"text-sm font-medium text-gray-700",children:"API Endpoint *"}),e.jsx(ne,{id:"endpoint",type:"url",value:i.endpoint,onChange:d=>D("endpoint",d.target.value),placeholder:T==null?void 0:T.defaultEndpoint,disabled:u,className:"h-11 font-mono text-sm"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Full URL to the API endpoint including protocol"})]})]}),(T==null?void 0:T.requiresKey)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"apiKey",className:"text-sm font-medium text-gray-700",children:"API Key *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{id:"apiKey",type:m?"text":"password",value:i.apiKey,onChange:d=>D("apiKey",d.target.value),placeholder:"Enter your API key...",disabled:u,className:"h-11 pr-12 font-mono text-sm"}),e.jsx(M,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-11 px-3 hover:bg-transparent",onClick:()=>l(!m),disabled:u,children:m?e.jsx(Ns,{className:"h-4 w-4 text-gray-400"}):e.jsx(Ge,{className:"h-4 w-4 text-gray-400"})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"API key will be securely stored and encrypted"})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-xl bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-100 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(ss,{className:"h-4 w-4 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Advanced Configuration"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Model parameters and custom headers"})]})]}),e.jsxs(z,{variant:"outline",className:"text-xs bg-orange-50 border-orange-200 text-orange-700",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),"Optional"]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:"Model Parameters"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"maxTokens",className:"text-sm font-medium text-gray-700",children:"Max Tokens"}),e.jsx(ne,{id:"maxTokens",type:"number",value:i.maxTokens,onChange:d=>D("maxTokens",parseInt(d.target.value)||4e3),min:100,max:32e3,disabled:u,className:"h-11"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Maximum tokens in model response (100-32,000)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"temperature",className:"text-sm font-medium text-gray-700",children:"Temperature"}),e.jsx(ne,{id:"temperature",type:"number",step:"0.1",value:i.temperature,onChange:d=>D("temperature",parseFloat(d.target.value)||.7),min:0,max:2,disabled:u,className:"h-11"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Randomness of model responses (0=deterministic, 2=very random)"})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:"Custom Headers"}),e.jsxs(z,{variant:"outline",className:"text-xs bg-gray-50 border-gray-200 text-gray-600",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),"Advanced"]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Add custom HTTP headers for specialized authentication or routing"}),e.jsxs("div",{className:"space-y-3",children:[j.map((d,k)=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ne,{placeholder:"Header name (e.g., Authorization)",value:d.key,onChange:x=>{const L=[...j];L[k].key=x.target.value,N(L)},disabled:u,className:"flex-1 font-mono text-sm bg-white"}),e.jsx(ne,{placeholder:"Header value",value:d.value,onChange:x=>{const L=[...j];L[k].value=x.target.value,N(L)},disabled:u,className:"flex-1 font-mono text-sm bg-white"}),e.jsx(M,{type:"button",variant:"ghost",size:"sm",onClick:()=>{const x=j.filter((L,K)=>K!==k);N(x)},disabled:u,className:"text-red-500 hover:text-red-700 hover:bg-red-50 shrink-0",children:""})]},k)),e.jsxs(M,{type:"button",variant:"outline",size:"sm",onClick:()=>N([...j,{key:"",value:""}]),disabled:u,className:"w-full mt-3 border-dashed border-gray-300 hover:border-gray-400 hover:bg-gray-50",children:[e.jsx(Ae,{className:"h-3 w-3 mr-2"}),"Add Custom Header"]})]})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-xl bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-100 px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(qe,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Test Configuration"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Verify connectivity and authentication before saving"})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-green-900 text-sm mb-1",children:"Connection Test"}),e.jsx("p",{className:"text-sm text-green-700",children:"Test your configuration to ensure the LLM provider is accessible with your settings"})]}),e.jsx(M,{onClick:V,disabled:h||u,variant:"outline",className:"ml-4 border-green-300 text-green-700 hover:bg-green-100 hover:border-green-400",children:h?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 animate-spin mr-2"}),"Testing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Test Connection"]})})]}),y&&e.jsx("div",{className:"mt-4",children:e.jsxs(Q,{className:y.success?"border-green-200 bg-green-50":"border-red-200 bg-red-50",children:[y.success?e.jsx(Y,{className:"h-4 w-4 text-green-600"}):e.jsx(X,{className:"h-4 w-4 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${y.success?"text-green-800":"text-red-800"}`,children:y.success?"Connection Successful":"Connection Failed"}),e.jsx("p",{className:`text-sm ${y.success?"text-green-700":"text-red-700"}`,children:y.message})]})]})})]})]}),f&&e.jsxs(Q,{className:`${f.type==="success"?"border-green-200 bg-green-50":f.type==="error"?"border-red-200 bg-red-50":"border-blue-200 bg-blue-50"}`,children:[f.type==="success"?e.jsx(Y,{className:"h-4 w-4 text-green-600"}):f.type==="error"?e.jsx(X,{className:"h-4 w-4 text-red-600"}):e.jsx(he,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:f.type==="success"?"text-green-800":f.type==="error"?"text-red-800":"text-blue-800",children:f.text})]})]}),e.jsxs(st,{children:[e.jsx(M,{variant:"outline",onClick:s,disabled:u,children:"Cancel"}),e.jsx(M,{onClick:Z,disabled:u||!!G(),className:"flex items-center space-x-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Adding..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:a?"Update Configuration":"Add LLM Configuration"})]})})]})]})})}function Xr({canModify:r=!0,isSaving:s=!1}){const{tenant:t}=oe(),[a,n]=g.useState([]),[i,o]=g.useState(!1),[m,l]=g.useState(null),[h,c]=g.useState(!0);g.useEffect(()=>{u()},[t==null?void 0:t.id]);const u=()=>{c(!0);try{const N=`user_llm_configs_${t==null?void 0:t.id}`,G=localStorage.getItem(N);if(G){const V=JSON.parse(G);n(V)}else n([])}catch(N){console.error("Error loading LLM configurations:",N),n([])}c(!1)},p=N=>{try{const G=`user_llm_configs_${t==null?void 0:t.id}`;localStorage.setItem(G,JSON.stringify(N)),n(N)}catch(G){console.error("Error saving LLM configurations:",G)}},y=async N=>{const G={...N,status:"disconnected",lastTested:new Date().toISOString()},V=[...a,G];p(V)},S=N=>{l(N)},f=async(N,G)=>{const V=a.map(Z=>Z.id===N?{...Z,...G,lastTested:new Date().toISOString()}:Z);p(V),l(null)},b=async N=>{if(!r)return;const G=a.filter(V=>V.id!==N);p(G)},j=async(N,G)=>{if(!r)return;const V=a.map(Z=>Z.id===N?{...Z,isEnabled:G}:Z);p(V)},w=N=>{switch(N){case"azure-openai":return e.jsx(ss,{className:"h-4 w-4"});case"openai":return e.jsx(me,{className:"h-4 w-4"});case"anthropic":return e.jsx(Lt,{className:"h-4 w-4"});case"ollama":return e.jsx(de,{className:"h-4 w-4"});default:return e.jsx(ke,{className:"h-4 w-4"})}},T=N=>{switch(N){case"azure-openai":return"Azure OpenAI";case"openai":return"OpenAI";case"anthropic":return"Anthropic";case"ollama":return"Ollama Local";case"custom":return"Custom Endpoint";default:return"Unknown Provider"}},D=N=>{switch(N){case"connected":return e.jsx(Y,{className:"h-4 w-4 text-green-600"});case"disconnected":return e.jsx(X,{className:"h-4 w-4 text-gray-400"});case"error":return e.jsx(X,{className:"h-4 w-4 text-red-600"});case"testing":return e.jsx(ce,{className:"h-4 w-4 animate-spin text-blue-600"});default:return e.jsx(X,{className:"h-4 w-4 text-gray-400"})}},I=N=>{switch(N.status){case"connected":return e.jsx(z,{className:"bg-green-100 text-green-800 border-green-200",children:"Connected"});case"disconnected":return e.jsx(z,{variant:"secondary",children:"Disconnected"});case"error":return e.jsx(z,{variant:"destructive",children:"Error"});case"testing":return e.jsx(z,{className:"bg-blue-100 text-blue-800 border-blue-200",children:"Testing"});default:return e.jsx(z,{variant:"secondary",children:"Unknown"})}};return h?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ce,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading LLM configurations..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"LLM Configuration Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add and configure Large Language Model providers for AI agent assignment"})]}),r&&e.jsxs(M,{onClick:()=>o(!0),className:"flex items-center space-x-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsx("span",{children:"Add LLM Configuration"})]})]}),a.length===0?e.jsx(P,{className:"border-2 border-dashed border-gray-300",children:e.jsxs(O,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(me,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No LLM Configurations"}),e.jsx("p",{className:"text-gray-600 text-center max-w-md",children:'Add your first LLM configuration using the "Add LLM Configuration" button above to enable AI agents with various language models for different use cases.'})]})}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:a.map(N=>e.jsxs(P,{className:`transition-all hover:shadow-md ${N.isEnabled?"ring-2 ring-blue-200 bg-blue-50/30":""}`,children:[e.jsx(F,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx($,{className:"text-base",children:N.name}),D(N.status)]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsxs(z,{variant:"outline",className:"text-xs flex items-center space-x-1",children:[w(N.provider),e.jsx("span",{children:T(N.provider)})]}),e.jsx(z,{variant:"secondary",className:"text-xs",children:N.model})]})]}),I(N)]})}),e.jsxs(O,{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:N.description}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ke,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Endpoint:"}),e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-mono truncate max-w-48",children:N.endpoint})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ss,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Max Tokens:"}),e.jsx("span",{className:"font-medium",children:N.maxTokens.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Temp:"}),e.jsx("span",{className:"font-medium",children:N.temperature})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Dt,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Added:"}),e.jsx("span",{children:new Date(N.createdAt).toLocaleDateString()})]})]}),N.errorMessage&&e.jsxs(Q,{className:"border-red-200 bg-red-50",children:[e.jsx(X,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-red-800 text-xs",children:N.errorMessage})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N.isEnabled,onChange:G=>j(N.id,G.target.checked),disabled:!r||s,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:N.isEnabled?"Enabled":"Disabled"})]})}),e.jsx("div",{className:"flex items-center space-x-2",children:r&&e.jsxs(e.Fragment,{children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>S(N.id),className:"flex items-center space-x-1",children:[e.jsx(de,{className:"h-3 w-3"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>b(N.id),className:"flex items-center space-x-1 text-red-600 hover:text-red-700",children:[e.jsx(ds,{className:"h-3 w-3"}),e.jsx("span",{children:"Delete"})]})]})})]})]})]},N.id))}),a.length>0&&e.jsx(P,{className:"bg-gray-50",children:e.jsx(O,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(me,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[a.length," configuration",a.length!==1?"s":""," available"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Y,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-gray-600",children:[a.filter(N=>N.isEnabled).length," enabled"]})]})]}),e.jsxs(z,{variant:"outline",className:"bg-white",children:[a.filter(N=>N.status==="connected").length," connected"]})]})})}),e.jsx(Nt,{isOpen:i,onClose:()=>o(!1),onSave:y}),m&&(()=>{const N=a.find(G=>G.id===m);return N?e.jsx(Nt,{isOpen:!!m,onClose:()=>l(null),onSave:G=>f(m,G),editMode:!0,initialConfig:{id:N.id,name:N.name,description:N.description,provider:N.provider,model:N.model,endpoint:N.endpoint,apiKey:N.apiKey,customHeaders:N.customHeaders,maxTokens:N.maxTokens,temperature:N.temperature,isEnabled:N.isEnabled,createdAt:N.createdAt}}):null})()]})}class Zr{constructor(){}async getTenantConfiguration(s){try{const t=`mcp_bridge_config_${s}`,a=localStorage.getItem(t);return a?JSON.parse(a):null}catch(t){return console.error("Error loading MCP configuration:",t),null}}async updateTenantConfiguration(s,t){try{const a=`mcp_bridge_config_${s}`;return localStorage.setItem(a,JSON.stringify(t)),await this.notifyMcpServer(s,t),!0}catch(a){return console.error("Error updating MCP configuration:",a),!1}}async convertSettingsToMcpConfig(s,t,a){const n=await Xe(),i={};return Object.entries(a).forEach(([o,m])=>{n.find(h=>h.id===m.connectionId)&&(i[o]={serverId:o,connectionId:m.connectionId,privacyConfig:{enableMasking:t.enablePrivacyMasking,maskingLevel:t.maskingLevel,enableTokenization:t.enableTokenization,customSensitiveFields:t.customSensitiveFields,privacyKey:t.privacyKey},performanceConfig:{pageSize:t.pageSize||50,requestTimeout:t.requestTimeout||30,maxRetries:t.maxRetries||3,enableCaching:t.enableCaching||!1,enableBackgroundSync:t.enableBackgroundSync||!1},lastUpdated:new Date().toISOString()})}),{tenantId:s,servers:i,globalSettings:{defaultMaskingLevel:t.maskingLevel,enableAuditLogging:!0}}}async notifyMcpServer(s,t){try{const a={tenantId:s,timestamp:new Date().toISOString(),servers:Object.values(t.servers).reduce((n,i)=>(n[i.serverId]={connection_id:i.connectionId,privacy_masking:i.privacyConfig.enableMasking,masking_level:i.privacyConfig.maskingLevel,tokenization:i.privacyConfig.enableTokenization,custom_fields:i.privacyConfig.customSensitiveFields,page_size:i.performanceConfig.pageSize,timeout:i.performanceConfig.requestTimeout,max_retries:i.performanceConfig.maxRetries,enable_cache:i.performanceConfig.enableCaching},n),{})}}catch(a){console.error("Error notifying MCP server:",a)}}async getAvailableConnections(){return Xe()}async testServerConfiguration(s,t){try{const n=(await Xe()).find(i=>i.id===t);return n?(await new Promise(i=>setTimeout(i,2e3)),{success:!0,message:`MCP server ${s} successfully connected to ${n.name}`,details:{serverId:s,connectionName:n.name,endpoint:n.baseUrl,testedAt:new Date().toISOString()}}):{success:!1,message:"Connection not found"}}catch(a){return{success:!1,message:`Test failed: ${a.message}`,details:{error:a.message}}}}async syncSettingsToMcpServer(s){try{const t=`mcp_privacy_config_${s}`,a=`mcp_server_configs_${s}`,n=JSON.parse(localStorage.getItem(t)||"{}"),i=JSON.parse(localStorage.getItem(a)||"{}"),o=await this.convertSettingsToMcpConfig(s,n,i);return await this.updateTenantConfiguration(s,o)}catch(t){return console.error("Error syncing settings to MCP server:",t),!1}}}const rs=new Zr,Qr=[{value:"grc",label:"GRC & Compliance"},{value:"integration",label:"Integration Platform"},{value:"automation",label:"Automation Tool"},{value:"analytics",label:"Analytics & Reporting"},{value:"custom",label:"Custom Solution"}];function wt({isOpen:r,onClose:s,onSave:t,editMode:a=!1,initialConfig:n}){const{tenant:i}=oe(),[o,m]=g.useState({name:(n==null?void 0:n.name)||"",description:(n==null?void 0:n.description)||"",endpoint:(n==null?void 0:n.endpoint)||"",category:(n==null?void 0:n.category)||"custom",connectionId:(n==null?void 0:n.connectionId)||""}),[l,h]=g.useState([]),[c,u]=g.useState(!1),[p,y]=g.useState(!1),[S,f]=g.useState(!1),[b,j]=g.useState(null),[w,T]=g.useState(null);Vs.useEffect(()=>{r&&D()},[r]);const D=async()=>{if(i){u(!0);try{const d=await Xe();h(d)}catch(d){console.error("Error loading connections:",d),T({type:"error",text:"Failed to load available connections"})}finally{u(!1)}}},I=(d,k)=>{m(x=>({...x,[d]:k})),j(null)},N=l.find(d=>d.id===o.connectionId),G=()=>o.name.trim()?o.endpoint.trim()?!o.endpoint.startsWith("http://")&&!o.endpoint.startsWith("https://")?"Endpoint must be a valid HTTP/HTTPS URL":null:"Server endpoint URL is required":"Server name is required",V=async()=>{const d=G();if(d){T({type:"error",text:d});return}y(!0),j(null),T({type:"info",text:`Testing connection to ${o.name}...`});try{await new Promise(x=>setTimeout(x,2e3));const k=await fetch(o.endpoint,{method:"GET",headers:{Accept:"application/json"}}).catch(()=>null);k&&k.ok?(j({success:!0,message:"Connection successful"}),T({type:"success",text:"MCP server is responding correctly"})):(j({success:!1,message:"Connection failed"}),T({type:"error",text:"Could not connect to MCP server endpoint"}))}catch(k){j({success:!1,message:k.message}),T({type:"error",text:`Test failed: ${k.message}`})}finally{y(!1)}},Z=async()=>{const d=G();if(d){T({type:"error",text:d});return}f(!0),T(null);try{const k={id:a?n.id:`mcp-${Date.now()}`,name:o.name.trim(),description:o.description.trim()||`Custom MCP server: ${o.name}`,endpoint:o.endpoint.trim(),connectionId:o.connectionId||void 0,connectionName:(N==null?void 0:N.name)||void 0,category:o.category,isEnabled:a?n.isEnabled:!0,createdAt:a?n.createdAt:new Date().toISOString()};await t(k),m({name:"",description:"",endpoint:"",category:"custom",connectionId:""}),j(null),T(null),s()}catch(k){T({type:"error",text:`Failed to add server: ${k.message}`})}finally{f(!1)}};return e.jsx(Xs,{open:r,onOpenChange:s,children:e.jsxs(Zs,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Qs,{children:e.jsxs(et,{className:"flex items-center space-x-2",children:[e.jsx(Ae,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:a?"Edit MCP Server":"Add MCP Server"})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-blue-50 rounded-lg border border-blue-100",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-medium",children:"1"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Basic Info"})]}),e.jsx("div",{className:"w-8 h-px bg-blue-200"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-medium",children:"2"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Configuration"})]}),e.jsx("div",{className:"w-8 h-px bg-blue-200"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-medium",children:"3"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Testing"})]})]}),e.jsxs(z,{variant:"outline",className:"bg-white border-blue-200 text-blue-700",children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),"MCP Setup"]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-xl bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-100 px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(cs,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Basic Information"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Name, category, and description for your MCP server"})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"serverName",className:"text-sm font-medium text-gray-700",children:"Server Name *"}),e.jsx(ne,{id:"serverName",type:"text",value:o.name,onChange:d=>I("name",d.target.value),placeholder:"e.g., Custom Archer GRC Server, Document Processor",disabled:S,className:"h-11"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose a descriptive name to identify this MCP server"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"category",className:"text-sm font-medium text-gray-700",children:"Category *"}),e.jsx("select",{id:"category",value:o.category,onChange:d=>I("category",d.target.value),className:"w-full h-11 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",disabled:S,children:Qr.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))}),e.jsx("p",{className:"text-xs text-gray-500",children:"Select the type of service this MCP server provides"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"description",className:"text-sm font-medium text-gray-700",children:"Description (Optional)"}),e.jsx(Ys,{id:"description",value:o.description,onChange:d=>I("description",d.target.value),placeholder:"Brief description of what this MCP server provides and when to use it...",rows:3,disabled:S,className:"resize-none"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Help team members understand the purpose and capabilities of this server"})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-xl bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-100 px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"h-4 w-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Server Configuration"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Endpoint URL and connection settings"})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"endpoint",className:"text-sm font-medium text-gray-700",children:"Server Endpoint URL *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ne,{id:"endpoint",type:"url",value:o.endpoint,onChange:d=>I("endpoint",d.target.value),placeholder:"https://your-mcp-server.com:3000",className:"pl-10 h-11 font-mono text-sm",disabled:S})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"The HTTP/HTTPS endpoint where your MCP server is running"})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:"Connection Assignment"}),e.jsxs(z,{variant:"outline",className:"text-xs bg-purple-50 border-purple-200 text-purple-700",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),"Optional"]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"If this MCP server needs to access external systems (like Archer GRC), select a connection."}),c?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(ce,{className:"h-4 w-4 animate-spin mr-2"}),e.jsx("span",{className:"text-sm",children:"Loading connections..."})]}):l.length===0?e.jsxs(Q,{children:[e.jsx(he,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"No connections available"}),e.jsx("p",{className:"text-sm",children:"You can create connections in the Connections page if your MCP server needs to access external systems."})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{className:"text-sm font-medium text-gray-700",children:"Select Connection (Optional)"}),e.jsxs("select",{value:o.connectionId,onChange:d=>I("connectionId",d.target.value),className:"w-full h-11 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",disabled:S,children:[e.jsx("option",{value:"",children:"No connection (standalone server)"}),l.map(d=>e.jsxs("option",{value:d.id,children:[d.name," (",d.baseUrl,")"]},d.id))]}),N&&e.jsxs("div",{className:"flex items-center space-x-2 mt-2 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ve,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Will use connection: ",e.jsx("strong",{children:N.name})]}),e.jsx(z,{variant:N.status==="connected"?"default":"secondary",children:N.status})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"External connection credentials will be securely passed to the MCP server"})]})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-xl bg-white shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-100 px-6 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(qe,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Test Server Connection"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Verify connectivity and server availability before saving"})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-green-900 text-sm mb-1",children:"Connection Test"}),e.jsx("p",{className:"text-sm text-green-700",children:"Test your server configuration to ensure the MCP server is running and accessible"})]}),e.jsx(M,{onClick:V,disabled:p||S||!o.endpoint,variant:"outline",className:"ml-4 border-green-300 text-green-700 hover:bg-green-100 hover:border-green-400",children:p?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 animate-spin mr-2"}),"Testing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Test Connection"]})})]}),b&&e.jsx("div",{className:"mt-4",children:e.jsxs(Q,{className:b.success?"border-green-200 bg-green-50":"border-red-200 bg-red-50",children:[b.success?e.jsx(Y,{className:"h-4 w-4 text-green-600"}):e.jsx(X,{className:"h-4 w-4 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:`font-medium ${b.success?"text-green-800":"text-red-800"}`,children:b.success?"Connection Successful":"Connection Failed"}),e.jsx("p",{className:`text-sm ${b.success?"text-green-700":"text-red-700"}`,children:b.message})]})]})})]})]}),w&&e.jsxs(Q,{className:`${w.type==="success"?"border-green-200 bg-green-50":w.type==="error"?"border-red-200 bg-red-50":"border-blue-200 bg-blue-50"}`,children:[w.type==="success"?e.jsx(Y,{className:"h-4 w-4 text-green-600"}):w.type==="error"?e.jsx(X,{className:"h-4 w-4 text-red-600"}):e.jsx(he,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:w.type==="success"?"text-green-800":w.type==="error"?"text-red-800":"text-blue-800",children:w.text})]})]}),e.jsxs(st,{children:[e.jsx(M,{variant:"outline",onClick:s,disabled:S,children:"Cancel"}),e.jsx(M,{onClick:Z,disabled:S||!!G(),className:"flex items-center space-x-2",children:S?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:a?"Updating...":"Adding..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{children:a?"Update Server":"Add Server"})]})})]})]})})}function ei({isOpen:r,onClose:s,server:t,onSave:a,currentConfig:n}){const{tenant:i}=oe(),[o,m]=g.useState((n==null?void 0:n.connectionId)||""),[l,h]=g.useState([]),[c,u]=g.useState(!1),[p,y]=g.useState(!1),[S,f]=g.useState(null);g.useEffect(()=>{b()},[i]);const b=async()=>{if(i){u(!0);try{const I=await Xe();h(I)}catch(I){console.error("Error loading connections:",I),f({type:"error",text:"Failed to load available connections"})}finally{u(!1)}}},j=l.find(I=>I.id===o),w=async()=>{if(!j){f({type:"error",text:"Please select a connection to test"});return}y(!0),f({type:"info",text:`Testing connection to ${j.name}...`});try{await new Promise(I=>setTimeout(I,2e3)),f({type:"success",text:`Successfully connected to ${j.name}. MCP server can access this connection.`})}catch(I){f({type:"error",text:`Connection test failed: ${I.message||"Unknown error"}`})}finally{y(!1)}},T=()=>{if(!j){f({type:"error",text:"Please select a connection"});return}const I={connectionId:j.id,connectionName:j.name,isEnabled:!0,lastConfigured:new Date().toISOString(),testStatus:(S==null?void 0:S.type)==="success"?"success":void 0};a(t.id,I),f({type:"success",text:"Configuration saved successfully!"}),setTimeout(()=>{s(),f(null)},1500)},D=I=>{switch(I.status){case"connected":return e.jsx(z,{className:"bg-green-100 text-green-800 border-green-200",children:"Connected"});case"testing":return e.jsx(z,{className:"bg-blue-100 text-blue-800 border-blue-200",children:"Testing"});case"error":return e.jsx(z,{variant:"destructive",children:"Error"});default:return e.jsx(z,{variant:"secondary",children:"Unknown"})}};return e.jsx(Xs,{open:r,onOpenChange:s,children:e.jsxs(Zs,{className:"max-w-2xl",children:[e.jsx(Qs,{children:e.jsxs(et,{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"h-5 w-5 text-blue-600"}),e.jsxs("span",{children:["Configure ",t.name]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-sm mb-2",children:"MCP Server Information"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",t.name]}),t.description&&e.jsxs("div",{children:[e.jsx("strong",{children:"Description:"})," ",t.description]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"}),e.jsx(z,{className:`ml-2 ${t.status==="connected"?"bg-green-100 text-green-800":t.status==="error"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t.status})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(J,{className:"text-base font-semibold flex items-center space-x-2",children:[e.jsx(Bs,{className:"h-4 w-4"}),e.jsx("span",{children:"Select Connection"})]}),c?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ce,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Loading connections..."})]}):l.length===0?e.jsxs(Q,{children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"No connections available"}),e.jsx("p",{className:"text-sm",children:"Please create a connection in the Connections page before configuring MCP servers."})]})]}):e.jsx("div",{className:"space-y-3",children:l.map(I=>e.jsxs("div",{className:`border rounded-lg p-4 cursor-pointer transition-all hover:shadow-md ${o===I.id?"ring-2 ring-blue-500 border-blue-200 bg-blue-50/50":"hover:border-gray-300"}`,onClick:()=>m(I.id),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${o===I.id?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:o===I.id&&e.jsx(Y,{className:"h-3 w-3 text-white"})}),e.jsx(ve,{className:"h-4 w-4 text-gray-600"}),e.jsx("h4",{className:"font-semibold",children:I.name})]}),D(I)]}),e.jsxs("div",{className:"ml-7 space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"URL:"})," ",I.baseUrl]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Instance:"})," ",I.instanceId]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Username:"})," ",I.username]}),I.lastTested&&e.jsxs("div",{children:[e.jsx("strong",{children:"Last Tested:"})," ",new Date(I.lastTested).toLocaleString()]})]})]},I.id))})]}),j&&e.jsxs("div",{className:"flex justify-between items-center p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Test Selected Connection"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Verify that the MCP server can connect to ",j.name]})]}),e.jsx(M,{onClick:w,disabled:p,variant:"outline",className:"ml-4",children:p?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 animate-spin mr-2"}),"Testing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Test Connection"]})})]}),S&&e.jsxs(Q,{className:`${S.type==="success"?"border-green-200 bg-green-50":S.type==="error"?"border-red-200 bg-red-50":"border-blue-200 bg-blue-50"}`,children:[S.type==="success"?e.jsx(Y,{className:"h-4 w-4 text-green-600"}):S.type==="error"?e.jsx(X,{className:"h-4 w-4 text-red-600"}):e.jsx(he,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:S.type==="success"?"text-green-800":S.type==="error"?"text-red-800":"text-blue-800",children:S.text})]}),n&&e.jsxs("div",{className:"text-sm text-gray-500 pt-2 border-t",children:[e.jsxs("div",{children:["Currently configured with: ",e.jsx("strong",{children:n.connectionName})]}),n.lastConfigured&&e.jsxs("div",{children:["Last configured: ",new Date(n.lastConfigured).toLocaleString()]})]})]}),e.jsxs(st,{children:[e.jsx(M,{variant:"outline",onClick:s,children:"Cancel"}),e.jsx(M,{onClick:T,disabled:!o||c,children:"Save Configuration"})]})]})})}const si=()=>[{id:"mcp-local-grc-server",name:"Local GRC MCP Server",description:"Local MCP proxy server for Archer GRC platform integration with risk analysis, compliance monitoring, and control assessment tools.",endpoint:"http://localhost:3001",category:"grc",isEnabled:!0,createdAt:new Date().toISOString()}],ti=r=>{const s=`user_mcp_servers_${r}`,t=localStorage.getItem(s);if(!t){const i=si();return localStorage.setItem(s,JSON.stringify(i)),console.log("[MCP Setup] Initialized default MCP servers for tenant:",r),i}const a=JSON.parse(t),n=ai(a);return n.length!==a.length?(localStorage.setItem(s,JSON.stringify(n)),console.log("[MCP Setup] Cleaned up duplicate MCP servers for tenant:",r),n):a},ai=r=>{const s=new Set;return r.filter(t=>{const a=t.endpoint.toLowerCase();return t.id==="mcp-archer-proxy"||a.includes("/mcp")?(console.log("[MCP Cleanup] Removing duplicate/redundant server:",t.name),!1):s.has(a)?(console.log("[MCP Cleanup] Removing duplicate server:",t.name),!1):(s.add(a),!0)})},ni=r=>{switch(r){case"grc":return e.jsx(ve,{className:"h-4 w-4"});case"integration":return e.jsx(Lt,{className:"h-4 w-4"});case"automation":return e.jsx(de,{className:"h-4 w-4"});case"analytics":return e.jsx(Ce,{className:"h-4 w-4"});default:return e.jsx(ke,{className:"h-4 w-4"})}},ri=r=>{switch(r){case"grc":return"GRC & Compliance";case"integration":return"Integration Platform";case"automation":return"Automation Tool";case"analytics":return"Analytics & Reporting";default:return"Custom Solution"}};function ii({config:r,onConfigChange:s,canModify:t,isSaving:a}){const[n,i]=g.useState([]),[o,m]=g.useState(!1),[l,h]=g.useState(null),[c,u]=g.useState(null),[p,y]=g.useState({}),[S,f]=g.useState(!0);g.useEffect(()=>{b()},[r.tenantId]);const b=()=>{f(!0);try{const d=ti(r.tenantId),k=`user_mcp_servers_${r.tenantId}`,x=localStorage.getItem(k);if(x){const v=JSON.parse(x).map(_=>({..._,status:_.status||"disconnected"}));i(v)}else{const v=d.map(_=>({..._,status:"disconnected",lastTested:new Date().toISOString()}));i(v),localStorage.setItem(k,JSON.stringify(v))}const L=`mcp_server_configs_${r.tenantId}`,K=localStorage.getItem(L);K&&y(JSON.parse(K))}catch(d){console.error("Error loading MCP servers:",d),i([])}f(!1)},j=d=>{try{const k=`user_mcp_servers_${r.tenantId}`;localStorage.setItem(k,JSON.stringify(d)),i(d)}catch(k){console.error("Error saving MCP servers:",k)}},w=async d=>{const k={...d,status:"disconnected",lastTested:new Date().toISOString()},x=[...n,k];j(x),await rs.syncSettingsToMcpServer(r.tenantId)},T=d=>{h(d)},D=async(d,k)=>{const x=n.map(L=>L.id===d?{...L,...k,lastTested:new Date().toISOString()}:L);j(x),await rs.syncSettingsToMcpServer(r.tenantId),h(null)},I=async d=>{if(!t)return;const k=n.filter(v=>v.id!==d);j(k);const x={...p};delete x[d],y(x);const L=`mcp_server_configs_${r.tenantId}`;localStorage.setItem(L,JSON.stringify(x));const K={...r,enabledMcpServers:r.enabledMcpServers.filter(v=>v!==d)};s(K),await rs.syncSettingsToMcpServer(r.tenantId)},N=async(d,k)=>{if(!t)return;const x=n.map(v=>v.id===d?{...v,isEnabled:k}:v);j(x);const L=k?[...r.enabledMcpServers.filter(v=>v!==d),d]:r.enabledMcpServers.filter(v=>v!==d),K={...r,enabledMcpServers:L};s(K)},G=async(d,k)=>{if(!t)return;const x={...p,[d]:k};y(x);const L=`mcp_server_configs_${r.tenantId}`;localStorage.setItem(L,JSON.stringify(x));const K=n.map(v=>v.id===d?{...v,connectionId:k.connectionId,connectionName:k.connectionName,status:"connected"}:v);j(K),await rs.syncSettingsToMcpServer(r.tenantId),u(null)},V=d=>{switch(d){case"connected":return e.jsx(Us,{className:"h-4 w-4 text-green-600"});case"disconnected":return e.jsx(ys,{className:"h-4 w-4 text-gray-400"});case"error":return e.jsx(X,{className:"h-4 w-4 text-red-600"});case"testing":return e.jsx(ce,{className:"h-4 w-4 animate-spin text-blue-600"});default:return e.jsx(ys,{className:"h-4 w-4 text-gray-400"})}},Z=d=>{switch(d.status){case"connected":return e.jsx(z,{className:"bg-green-100 text-green-800 border-green-200",children:"Connected"});case"disconnected":return e.jsx(z,{variant:"secondary",children:"Disconnected"});case"error":return e.jsx(z,{variant:"destructive",children:"Error"});case"testing":return e.jsx(z,{className:"bg-blue-100 text-blue-800 border-blue-200",children:"Testing"});default:return e.jsx(z,{variant:"secondary",children:"Unknown"})}};return S?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ce,{className:"h-6 w-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading MCP servers..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"MCP Server Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add and configure Model Context Protocol servers for AI agent integration"})]}),t&&e.jsxs(M,{onClick:()=>m(!0),className:"flex items-center space-x-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),e.jsx("span",{children:"Add MCP Server"})]})]}),n.length===0?e.jsx(P,{className:"border-2 border-dashed border-gray-300",children:e.jsxs(O,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Ce,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No MCP Servers Configured"}),e.jsx("p",{className:"text-gray-600 text-center max-w-md",children:'Add your first MCP server using the "Add MCP Server" button above to enable AI agent integration with external systems and tools.'})]})}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:n.map(d=>{const k=p[d.id];return e.jsxs(P,{className:`transition-all hover:shadow-md ${d.isEnabled?"ring-2 ring-blue-200 bg-blue-50/30":""}`,children:[e.jsx(F,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx($,{className:"text-base",children:d.name}),V(d.status)]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsxs(z,{variant:"outline",className:"text-xs flex items-center space-x-1",children:[ni(d.category),e.jsx("span",{children:ri(d.category)})]}),k&&e.jsx(z,{variant:"default",className:"text-xs bg-blue-100 text-blue-800 border-blue-200",children:"Configured"})]})]}),Z(d)]})}),e.jsxs(O,{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:d.description}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ke,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Endpoint:"}),e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-mono",children:d.endpoint})]}),d.connectionName&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Connection:"}),e.jsx("span",{className:"font-medium",children:d.connectionName})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Dt,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Added:"}),e.jsx("span",{children:new Date(d.createdAt).toLocaleDateString()})]})]}),d.errorMessage&&e.jsxs(Q,{className:"border-red-200 bg-red-50",children:[e.jsx(X,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-red-800 text-xs",children:d.errorMessage})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.isEnabled,onChange:x=>N(d.id,x.target.checked),disabled:!t||a,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:d.isEnabled?"Enabled":"Disabled"})]})}),e.jsx("div",{className:"flex items-center space-x-2",children:t&&e.jsxs(e.Fragment,{children:[e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>T(d.id),className:"flex items-center space-x-1",children:[e.jsx(de,{className:"h-3 w-3"}),e.jsx("span",{children:"Edit"})]}),e.jsxs(M,{size:"sm",variant:"outline",onClick:()=>I(d.id),className:"flex items-center space-x-1 text-red-600 hover:text-red-700",children:[e.jsx(ds,{className:"h-3 w-3"}),e.jsx("span",{children:"Delete"})]})]})})]})]})]},d.id)})}),n.length>0&&e.jsx(P,{className:"bg-gray-50",children:e.jsx(O,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ce,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[n.length," server",n.length!==1?"s":""," configured"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Y,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{className:"text-gray-600",children:[n.filter(d=>d.isEnabled).length," enabled"]})]})]}),e.jsxs(z,{variant:"outline",className:"bg-white",children:[n.filter(d=>d.status==="connected").length," connected"]})]})})}),e.jsx(wt,{isOpen:o,onClose:()=>m(!1),onSave:w}),l&&(()=>{const d=n.find(k=>k.id===l);return d?e.jsx(wt,{isOpen:!!l,onClose:()=>h(null),onSave:k=>D(l,k),editMode:!0,initialConfig:{id:d.id,name:d.name,description:d.description,endpoint:d.endpoint,connectionId:d.connectionId,connectionName:d.connectionName,category:d.category,isEnabled:d.isEnabled,createdAt:d.createdAt}}):null})(),c&&(()=>{const d=n.find(k=>k.id===c);return d?e.jsx(ei,{isOpen:!!c,onClose:()=>u(null),server:{id:d.id,name:d.name,description:d.description,status:d.status},onSave:G,currentConfig:p[c]}):null})()]})}const oi=[{original:"Employee john.doe@company.com (ID: EMP-12345) has access",light:"Employee j***.doe@company.com (ID: E**-***45) has access",moderate:"Employee j***@company.com (ID: ***-***45) has access",strict:"Employee [MASKED_EMAIL] (ID: [MASKED_ID]) has access"},{original:"Contact Sarah Wilson at (555) 123-4567",light:"Contact S****W*****n at (555) ***-*567",moderate:"Contact S*** W*** at (***) ***-*567",strict:"Contact [MASKED_NAME] at [MASKED_PHONE]"},{original:"SSN: 123-45-6789, Account: ACC-998877",light:"SSN: ***-**-**89, Account: A***998***",moderate:"SSN: ***-**-****, Account: ***-******",strict:"SSN: [MASKED_SSN], Account: [MASKED_ACCOUNT]"}],li=[{category:"Personal Information",fields:["name","email","phone","address","ssn","employee_id"],description:"Personal identifiers and contact information"},{category:"Financial Data",fields:["account_number","credit_card","salary","amount","cost"],description:"Financial and monetary information"},{category:"System Data",fields:["password","token","api_key","ip_address","hostname"],description:"System credentials and technical identifiers"}];function ci({config:r,onConfigChange:s,canModify:t,isSaving:a}){const[n,i]=g.useState(!1),[o,m]=g.useState(r.customSensitiveFields.join(", ")),[l,h]=g.useState(r.maskingLevel),c=b=>{const j={...r,maskingLevel:b};s(j),h(b)},u=b=>{const j={...r,enablePrivacyMasking:b};s(j)},p=b=>{const j={...r,enableTokenization:b};s(j)},y=()=>{const b=o.split(",").map(w=>w.trim()).filter(w=>w.length>0),j={...r,customSensitiveFields:b};s(j)},S=b=>{switch(b){case"light":return"Minimal masking - masks emails, SSNs, and obvious PII while preserving readability";case"moderate":return"Standard protection - masks all PII, financial data, and potentially sensitive information";case"strict":return"Maximum security - replaces all sensitive data with descriptive tokens";default:return""}},f=b=>{switch(b){case"light":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"moderate":return"bg-blue-100 text-blue-800 border-blue-200";case"strict":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(P,{className:`border-l-4 ${r.enablePrivacyMasking?"border-l-green-500":"border-l-yellow-500"}`,children:e.jsx(O,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center",children:[r.enablePrivacyMasking?e.jsx(re,{className:"h-5 w-5 text-green-600 mr-2"}):e.jsx(X,{className:"h-5 w-5 text-yellow-600 mr-2"}),"Privacy Protection Status"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r.enablePrivacyMasking?`Active - ${r.maskingLevel} level protection`:"Disabled - No data masking applied"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:f(r.maskingLevel),children:r.maskingLevel}),e.jsx(z,{variant:r.enableTokenization?"default":"secondary",children:r.enableTokenization?"Tokenization ON":"Tokenization OFF"})]})]})})}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Privacy Protection Settings"})]})}),e.jsxs(O,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Enable Privacy Masking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Automatically mask sensitive data in AI responses and system outputs"})]}),e.jsx(M,{variant:r.enablePrivacyMasking?"default":"outline",size:"sm",onClick:()=>u(!r.enablePrivacyMasking),disabled:!t,className:"ml-4",children:r.enablePrivacyMasking?e.jsxs(e.Fragment,{children:[e.jsx(Ft,{className:"h-4 w-4 mr-2"}),"Enabled"]}):e.jsxs(e.Fragment,{children:[e.jsx(nn,{className:"h-4 w-4 mr-2"}),"Disabled"]})})]}),r.enablePrivacyMasking&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(J,{className:"text-base font-semibold",children:"Masking Level"}),e.jsx("div",{className:"grid gap-4",children:["light","moderate","strict"].map(b=>e.jsxs("div",{className:`border rounded-lg p-4 cursor-pointer transition-all ${r.maskingLevel===b?"ring-2 ring-blue-500 border-blue-200 bg-blue-50/50":"hover:border-gray-300"}`,onClick:()=>t&&c(b),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 ${r.maskingLevel===b?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:r.maskingLevel===b&&e.jsx(Y,{className:"h-3 w-3 text-white"})}),e.jsx("h4",{className:"font-semibold capitalize",children:b})]}),e.jsx(z,{className:f(b),children:b})]}),e.jsx("p",{className:"text-sm text-gray-600 ml-7",children:S(b)})]},b))})]}),r.enablePrivacyMasking&&e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Enable Tokenization"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Use reversible tokens for secure data handling (requires encryption key)"})]}),e.jsx(M,{variant:r.enableTokenization?"default":"outline",size:"sm",onClick:()=>p(!r.enableTokenization),disabled:!t,className:"ml-4",children:r.enableTokenization?e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Enabled"]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"Disabled"]})})]}),r.enablePrivacyMasking&&r.enableTokenization&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"tokenizationKey",children:"Tokenization Encryption Key"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{id:"tokenizationKey",type:n?"text":"password",value:r.privacyKey||"",onChange:b=>s({...r,privacyKey:b.target.value}),placeholder:"Enter encryption key for tokenization",disabled:!t,className:"pr-10 font-mono text-sm"}),e.jsx(M,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>i(!n),children:n?e.jsx(Ns,{className:"h-4 w-4 text-gray-400"}):e.jsx(Ge,{className:"h-4 w-4 text-gray-400"})})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Leave empty to use default key. Use a strong, unique key for production."})]})]})]}),r.enablePrivacyMasking&&e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(cs,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Custom Sensitive Fields"})]})}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"customFields",children:"Additional Field Patterns"}),e.jsx(Ys,{id:"customFields",value:o,onChange:b=>m(b.target.value),onBlur:y,placeholder:"employee_id, contract_number, vendor_code, custom_field",disabled:!t,className:"font-mono text-sm",rows:3}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enter additional field patterns to protect (comma-separated). These will be masked in addition to standard sensitive fields."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Built-in Sensitive Field Categories"}),e.jsx("div",{className:"grid gap-3",children:li.map(b=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx("h5",{className:"font-semibold text-sm mb-1",children:b.category}),e.jsx("p",{className:"text-xs text-gray-600 mb-2",children:b.description}),e.jsx("div",{className:"flex flex-wrap gap-1",children:b.fields.map(j=>e.jsx(z,{variant:"outline",className:"text-xs",children:j},j))})]},b.category))})]})]})]}),r.enablePrivacyMasking&&e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(Ge,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Data Masking Preview"})]})}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx(J,{children:"Preview Level:"}),e.jsxs("select",{value:l,onChange:b=>h(b.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm",children:[e.jsx("option",{value:"light",children:"Light"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"strict",children:"Strict"})]})]}),e.jsx("div",{className:"space-y-4",children:oi.map((b,j)=>e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Original:"}),e.jsx("div",{className:"bg-gray-50 p-2 rounded mt-1 font-mono text-sm",children:b.original})]}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-semibold text-gray-700",children:["With ",l," masking:"]}),e.jsx("div",{className:"bg-blue-50 p-2 rounded mt-1 font-mono text-sm",children:b[l]})]})]})},j))})]})]}),e.jsxs(Q,{children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Security Notice"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("p",{children:" Privacy settings affect how data is processed by AI models"}),e.jsx("p",{children:" Higher security levels may impact response quality and readability"}),e.jsx("p",{children:" Configuration changes require re-authentication of active sessions"}),e.jsx("p",{children:" Tokenization keys should be stored securely and never shared"})]})]})]})]})}const di=r=>{var a;const s=r.enabledMcpServers.length,t=r.enableCaching;return[{name:"Enabled MCP Servers",value:s.toString(),trend:"stable",description:"Number of currently enabled MCP servers"},{name:"Privacy Protection",value:r.enablePrivacyMasking?r.maskingLevel.toUpperCase():"OFF",trend:"stable",description:"Current privacy masking configuration"},{name:"Response Caching",value:t?"ENABLED":"DISABLED",trend:"stable",description:"Response caching status for performance"},{name:"Page Size",value:((a=r.pageSize)==null?void 0:a.toString())||"50",trend:"stable",description:"Records per request for API calls"}]};function mi({config:r,onConfigChange:s,canModify:t,isSaving:a}){const n=(l,h)=>{const c={...r,[l]:h};s(c)},i=l=>{const h=r[l];n(l,!h)},o=l=>{switch(l){case"up":return e.jsx(Pe,{className:"h-4 w-4 text-green-600"});case"down":return e.jsx(Pe,{className:"h-4 w-4 text-red-600 rotate-180"});default:return e.jsx(De,{className:"h-4 w-4 text-blue-600"})}},m=di(r);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Configuration Overview"})]})}),e.jsx(O,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:m.map(l=>e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[o(l.trend),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:l.value})]}),e.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-1",children:l.name}),e.jsx("div",{className:"text-xs text-gray-500",children:l.description})]},l.name))})})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(ss,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Performance Settings"})]})}),e.jsxs(O,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"pageSize",className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{children:"Page Size"})]}),e.jsx(ne,{id:"pageSize",type:"number",value:r.pageSize,onChange:l=>n("pageSize",parseInt(l.target.value)||50),min:10,max:500,disabled:!t}),e.jsx("p",{className:"text-xs text-gray-500",children:"Records per request (10-500)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"timeout",className:"flex items-center space-x-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx("span",{children:"Request Timeout"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{id:"timeout",type:"number",value:r.requestTimeout,onChange:l=>n("requestTimeout",parseInt(l.target.value)||30),min:5,max:300,disabled:!t}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:"sec"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Request timeout (5-300s)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(J,{htmlFor:"maxRetries",className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{children:"Max Retries"})]}),e.jsx(ne,{id:"maxRetries",type:"number",value:r.maxRetries,onChange:l=>n("maxRetries",parseInt(l.target.value)||3),min:0,max:10,disabled:!t}),e.jsx("p",{className:"text-xs text-gray-500",children:"Maximum retry attempts (0-10)"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Performance Optimizations"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h5",{className:"font-semibold text-sm flex items-center space-x-2",children:[e.jsx(ve,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"Response Caching"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Cache responses to improve performance and reduce API calls"})]}),e.jsx(M,{variant:r.enableCaching?"default":"outline",size:"sm",onClick:()=>i("enableCaching"),disabled:!t,className:"ml-4",children:r.enableCaching?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Enabled"]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Disabled"]})})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h5",{className:"font-semibold text-sm flex items-center space-x-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"Background Sync"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Synchronize data in the background to keep cache fresh"})]}),e.jsx(M,{variant:r.enableBackgroundSync?"default":"outline",size:"sm",onClick:()=>i("enableBackgroundSync"),disabled:!t,className:"ml-4",children:r.enableBackgroundSync?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Enabled"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Disabled"]})})]})]})]})]})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"System Information"})]})}),e.jsx(O,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Configuration Status"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Tenant ID:"}),e.jsx(z,{variant:"outline",className:"font-mono text-xs",children:r.tenantId})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Configuration Status:"}),e.jsx(z,{variant:r.isActive?"default":"secondary",children:r.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Last Updated:"}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(r.lastUpdated).toLocaleString()})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"MCP Server Status"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Enabled Servers:"}),e.jsx(z,{variant:"outline",children:r.enabledMcpServers.length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Privacy Protection:"}),e.jsx(z,{variant:r.enablePrivacyMasking?"default":"secondary",children:r.enablePrivacyMasking?r.maskingLevel:"Disabled"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Tokenization:"}),e.jsx(z,{variant:r.enableTokenization?"default":"secondary",children:r.enableTokenization?"Enabled":"Disabled"})]})]})]})]})})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Configuration Recommendations"})]})}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-4",children:[r.pageSize>200&&e.jsxs(Q,{children:[e.jsx(he,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Performance Tip"}),e.jsx("p",{className:"text-sm",children:"Consider reducing page size below 200 for faster response times, especially with privacy masking enabled."})]})]}),!r.enablePrivacyMasking&&e.jsxs(Q,{children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Security Recommendation"}),e.jsx("p",{className:"text-sm",children:"Enable privacy masking to protect sensitive data when working with AI models and external integrations."})]})]}),!r.enableCaching&&r.enabledMcpServers.length>2&&e.jsxs(Q,{children:[e.jsx(he,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Performance Recommendation"}),e.jsx("p",{className:"text-sm",children:"Enable response caching to improve performance when using multiple MCP servers."})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-sm text-green-800 mb-2",children:"Recommended Settings"}),e.jsxs("div",{className:"text-sm text-green-700 space-y-1",children:[e.jsxs("p",{children:[" ",e.jsx("strong",{children:"Page Size:"})," 50-100 records for optimal balance"]}),e.jsxs("p",{children:[" ",e.jsx("strong",{children:"Timeout:"})," 30-60 seconds for reliable connections"]}),e.jsxs("p",{children:[" ",e.jsx("strong",{children:"Max Retries:"})," 3 attempts for resilient operation"]}),e.jsxs("p",{children:[" ",e.jsx("strong",{children:"Caching:"})," Enable for better performance"]}),e.jsxs("p",{children:[" ",e.jsx("strong",{children:"Privacy:"})," Use moderate masking level"]})]})]})]})})]}),e.jsxs(Q,{children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Advanced Configuration Notice"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("p",{children:" These settings directly affect system performance and behavior"}),e.jsx("p",{children:" Incorrect values may cause timeouts, errors, or degraded performance"}),e.jsx("p",{children:" Test changes in a non-production environment when possible"}),e.jsx("p",{children:" Contact support if you experience issues after configuration changes"})]})]})]})]})}const St=r=>({enablePrivacyMasking:!0,maskingLevel:"moderate",enableTokenization:!1,customSensitiveFields:[],enabledMcpServers:[],mcpServerEndpoints:{"archer-grc":"http://localhost:3001"},mcpToolAllowlist:{},pageSize:50,requestTimeout:30,maxRetries:3,enableCaching:!0,enableBackgroundSync:!0,tenantId:r,lastUpdated:new Date().toISOString(),isActive:!0});function ui(){var j;const{user:r,tenant:s}=oe(),[t,a]=na(),n=t.get("tab")||"llm",[i,o]=g.useState(n),[m,l]=g.useState(null),[h,c]=g.useState(!0),[u,p]=g.useState(!1),[y,S]=g.useState(null),f=((j=r==null?void 0:r.roles)==null?void 0:j.includes("TenantOwner"))||!1;g.useEffect(()=>{if(!s)return;const w=`mcp_privacy_config_${s.id}`,T=localStorage.getItem(w);try{const D=T?JSON.parse(T):St(s.id);l(D)}catch(D){console.error("Error loading MCP Privacy config:",D),l(St(s.id))}c(!1)},[s]);const b=async w=>{if(!(!s||!f)){p(!0),S(null);try{const T={...w,tenantId:s.id,lastUpdated:new Date().toISOString()},D=`mcp_privacy_config_${s.id}`;localStorage.setItem(D,JSON.stringify(T)),l(T);const I=await rs.syncSettingsToMcpServer(s.id);S(I?{type:"success",message:"Settings saved and synced to MCP server successfully"}:{type:"error",message:"Settings saved locally but failed to sync to MCP server"}),setTimeout(()=>S(null),5e3)}catch(T){console.error("Error saving MCP Privacy config:",T),S({type:"error",message:"Failed to save settings"})}finally{p(!1)}}};return h?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s?e.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-6xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(de,{className:"h-7 w-7 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Settings"})]}),e.jsxs("p",{className:"text-gray-600",children:["Configure MCP servers, privacy protection, and AI model settings for"," ",e.jsx("span",{className:"font-semibold",children:s.name})]}),!f&&e.jsxs(Q,{className:"mt-4",children:[e.jsx(X,{className:"h-4 w-4"}),"You have read-only access to these settings. Contact your tenant owner to make changes."]})]}),y&&e.jsxs(Q,{className:`mb-6 ${y.type==="success"?"border-green-200 bg-green-50":"border-red-200 bg-red-50"}`,children:[y.type==="success"?e.jsx(Y,{className:"h-4 w-4 text-green-600"}):e.jsx(X,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:y.type==="success"?"text-green-800":"text-red-800",children:y.message}),u&&e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Syncing to MCP server..."})]})]}),e.jsxs(Jr,{value:i,onValueChange:w=>{o(w),a(w==="llm"?{}:{tab:w})},className:"space-y-6",children:[e.jsxs(Yr,{className:"grid w-full grid-cols-4",children:[e.jsxs(hs,{value:"llm",className:"flex items-center space-x-2",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"LLM Models"}),e.jsx("span",{className:"sm:hidden",children:"LLM"})]}),e.jsxs(hs,{value:"mcp",className:"flex items-center space-x-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"MCP Servers"}),e.jsx("span",{className:"sm:hidden",children:"MCP"})]}),e.jsxs(hs,{value:"privacy",className:"flex items-center space-x-2",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Privacy"}),e.jsx("span",{className:"sm:hidden",children:"Privacy"})]}),e.jsxs(hs,{value:"advanced",className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Advanced"}),e.jsx("span",{className:"sm:hidden",children:"Advanced"})]})]}),e.jsx(xs,{value:"llm",className:"space-y-6",children:e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{className:"h-5 w-5 text-blue-600"}),e.jsx($,{children:"Language Model Configuration"})]})}),e.jsx(O,{children:e.jsx(Xr,{})})]})}),e.jsx(xs,{value:"mcp",className:"space-y-6",children:m&&e.jsx(ii,{config:m,onConfigChange:b,canModify:f,isSaving:u})}),e.jsx(xs,{value:"privacy",className:"space-y-6",children:m&&e.jsx(ci,{config:m,onConfigChange:b,canModify:f,isSaving:u})}),e.jsx(xs,{value:"advanced",className:"space-y-6",children:m&&e.jsx(mi,{config:m,onConfigChange:b,canModify:f,isSaving:u})})]}),m&&e.jsx(P,{className:"mt-8 border-gray-200",children:e.jsx(O,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsxs("span",{children:["Last updated: ",new Date(m.lastUpdated).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Tenant:"}),e.jsx(z,{variant:"outline",children:s.name})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{variant:m.isActive?"default":"secondary",className:m.isActive?"bg-green-100 text-green-800 border-green-200":"",children:m.isActive?"Active":"Inactive"}),e.jsxs(z,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(ve,{className:"h-3 w-3 mr-1"}),"MCP Synced"]})]})]})})})]}):e.jsxs(Q,{className:"max-w-2xl mx-auto mt-8",children:[e.jsx(X,{className:"h-4 w-4"}),"Please select a tenant to manage settings."]})}function hi(){const{initializeAuth:r}=oe();return g.useEffect(()=>{localStorage.getItem("theme")==="dark"&&document.documentElement.classList.add("dark"),r()},[r]),e.jsx(ra,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsx("div",{className:"min-h-screen bg-background text-foreground",children:e.jsxs(ia,{children:[e.jsx(ye,{path:"/login",element:e.jsx(mn,{})}),e.jsxs(ye,{path:"/",element:e.jsx(cn,{}),children:[e.jsx(ye,{index:!0,element:e.jsx(We,{to:"/dashboard",replace:!0})}),e.jsx(ye,{path:"dashboard",element:e.jsx(xr,{})}),e.jsx(ye,{path:"agents",element:e.jsx(wr,{})}),e.jsx(ye,{path:"mcp-servers",element:e.jsx(We,{to:"/settings?tab=mcp-servers",replace:!0})}),e.jsx(ye,{path:"chat",element:e.jsx(Ur,{})}),e.jsx(ye,{path:"audit",element:e.jsx(Fr,{})}),e.jsx(ye,{path:"users",element:e.jsx($r,{})}),e.jsx(ye,{path:"ai-insights",element:e.jsx(qr,{})}),e.jsx(ye,{path:"tools",element:e.jsx(Hr,{})}),e.jsx(ye,{path:"connections",element:e.jsx(Wr,{})}),e.jsx(ye,{path:"llm-config",element:e.jsx(We,{to:"/settings?tab=llm",replace:!0})}),e.jsx(ye,{path:"settings",element:e.jsx(ui,{})})]}),e.jsx(ye,{path:"*",element:e.jsx(We,{to:"/dashboard",replace:!0})})]})})})}Ds.createRoot(document.getElementById("root")).render(e.jsx(Vs.StrictMode,{children:e.jsx(hi,{})}));
//# sourceMappingURL=index-ea0f459f.js.map
