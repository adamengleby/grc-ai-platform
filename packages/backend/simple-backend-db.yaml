properties:
  template:
    containers:
    - image: mcr.microsoft.com/azure-functions/node:4-node20-appservice
      name: grc-backend-simple
      env:
      - name: NODE_ENV
        value: production
      - name: PORT
        value: "3005"
      - name: CORS_ORIGINS
        value: "https://grc-frontend-simple.calmmeadow-5080198e.australiasoutheast.azurecontainerapps.io"
      - name: POSTGRES_HOST
        value: "grc-postgres-syd.postgres.database.azure.com"
      - name: POSTGRES_PORT
        value: "5432"
      - name: POSTGRES_DATABASE
        value: "grc_platform"
      - name: POSTGRES_USER
        value: "grcadmin"
      - name: POSTGRES_PASSWORD
        value: "GrcAzure2024!"
      command: ["/bin/sh"]
      args: ["-c", "echo 'Starting GRC Backend with Multi-Tenant Security v7...' && echo '{\"name\":\"grc-backend\",\"version\":\"1.0.0\",\"dependencies\":{\"express\":\"^4.19.2\",\"cors\":\"^2.8.5\",\"pg\":\"^8.11.0\"}}' > package.json && npm install && curl -s -o server.js 'https://raw.githubusercontent.com/adamengleby/grc-ai-platform/master/packages/backend/containerapp-server-v7.js?v=7' && echo 'Downloaded server with multi-tenant security and tenant isolation' && node server.js"]
      resources:
        cpu: 1.0
        memory: 2Gi
    scale:
      minReplicas: 1
      maxReplicas: 5
  configuration:
    ingress:
      external: true
      targetPort: 3005