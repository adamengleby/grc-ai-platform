properties:
  template:
    containers:
    - image: mcr.microsoft.com/azure-functions/node:4-node20-appservice
      name: grc-frontend-simple
      env:
      - name: NODE_ENV
        value: production
      - name: PORT
        value: "8080"
      - name: VITE_API_BASE_URL
        value: "https://grc-backend-simple.calmmeadow-5080198e.australiasoutheast.azurecontainerapps.io/api/v1"
      command: ["/bin/sh"]
      args: ["-c", "echo 'Setting up GRC Frontend without MCP validation...' && cat > package.json << 'EOF'\n{\n  \"name\": \"grc-frontend\",\n  \"version\": \"2.0.0\",\n  \"main\": \"server.js\",\n  \"dependencies\": {\n    \"express\": \"^4.19.2\"\n  }\n}\nEOF\necho 'Installing dependencies...' && npm install && echo 'Creating server...' && cat > server.js << 'EOF'\nconst express = require('express');\nconst path = require('path');\nconst app = express();\n\n// Serve static files\napp.use(express.static('.'));\n\n// Health check\napp.get('/health', (req, res) => {\n  res.json({\n    status: 'healthy',\n    service: 'GRC React Frontend - MCP Validation Removed',\n    version: '2025-09-25-no-mcp-validation',\n    timestamp: new Date().toISOString(),\n    build: 'inline-deployment'\n  });\n});\n\n// SPA fallback\napp.get('*', (req, res) => {\n  res.sendFile(path.join(__dirname, 'index.html'));\n});\n\nconst port = process.env.PORT || 8080;\napp.listen(port, () => {\n  console.log('üöÄ GRC Frontend (MCP validation removed) on port', port);\n});\nEOF\necho 'Creating React SPA...' && cat > index.html << 'EOF'\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>GRC AI Platform</title>\n    <style>\n      * { margin: 0; padding: 0; box-sizing: border-box; }\n      body { font-family: system-ui, sans-serif; }\n      .app { min-height: 100vh; background: #f8fafc; }\n      .header { background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 1rem 2rem; }\n      .title { font-size: 1.5rem; font-weight: 600; color: #1f2937; }\n      .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }\n      .card { background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 2rem; margin-bottom: 1rem; }\n      .success { background: #10b981; color: white; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; }\n      .form { display: grid; gap: 1rem; max-width: 500px; }\n      .form-group { display: flex; flex-direction: column; gap: 0.5rem; }\n      .form-group label { font-weight: 500; color: #374151; }\n      .form-group input, .form-group textarea { padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px; }\n      .button { background: #3b82f6; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; }\n      .button:hover { background: #2563eb; }\n      .button:disabled { background: #9ca3af; cursor: not-allowed; }\n    </style>\n  </head>\n  <body>\n    <div class=\"app\">\n      <header class=\"header\">\n        <h1 class=\"title\">ü§ñ GRC AI Platform - Agent Creator</h1>\n      </header>\n      <div class=\"container\">\n        <div class=\"success\">\n          ‚úÖ <strong>MCP Validation Removed!</strong> Agents can now be created without requiring MCP servers.\n        </div>\n        <div class=\"card\">\n          <h2>Create New Agent</h2>\n          <div class=\"form\">\n            <div class=\"form-group\">\n              <label for=\"name\">Agent Name *</label>\n              <input type=\"text\" id=\"name\" placeholder=\"e.g., GRC Assistant\" required>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"description\">Description</label>\n              <textarea id=\"description\" placeholder=\"Brief description of the agent's purpose\" rows=\"3\"></textarea>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"systemPrompt\">System Prompt</label>\n              <textarea id=\"systemPrompt\" placeholder=\"Instructions for the agent (optional)\" rows=\"4\"></textarea>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"tenantId\">Tenant</label>\n              <select id=\"tenantId\">\n                <option value=\"a1b2c3d4-e5f6-4a8b-9c0d-1e2f3a4b5c6d\">Sarah Chen (ACME Corp)</option>\n                <option value=\"f1234567-89ab-4cde-f012-3456789abcde\">David Smith (FinTech)</option>\n              </select>\n            </div>\n            <button class=\"button\" onclick=\"createAgent()\" id=\"createBtn\">Create Agent (No MCP Required)</button>\n          </div>\n          <div id=\"result\" style=\"margin-top: 1rem;\"></div>\n        </div>\n      </div>\n    </div>\n    <script>\n      async function createAgent() {\n        const btn = document.getElementById('createBtn');\n        const result = document.getElementById('result');\n        \n        btn.disabled = true;\n        btn.textContent = 'Creating...';\n        result.innerHTML = '';\n        \n        const data = {\n          name: document.getElementById('name').value,\n          description: document.getElementById('description').value,\n          system_prompt: document.getElementById('systemPrompt').value || 'You are a helpful AI assistant for GRC tasks.',\n          enabledMcpServers: [] // Empty array - no MCP servers required!\n        };\n        \n        try {\n          const response = await fetch('https://grc-backend-simple.calmmeadow-5080198e.australiasoutheast.azurecontainerapps.io/api/v1/simple-agents', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'x-tenant-id': document.getElementById('tenantId').value\n            },\n            body: JSON.stringify(data)\n          });\n          \n          const res = await response.json();\n          \n          if (res.success) {\n            result.innerHTML = `<div style=\"background: #dcfce7; color: #166534; padding: 1rem; border-radius: 4px;\">‚úÖ Agent created successfully! ID: ${res.data.id}</div>`;\n            document.getElementById('name').value = '';\n            document.getElementById('description').value = '';\n            document.getElementById('systemPrompt').value = '';\n          } else {\n            throw new Error(res.error || 'Unknown error');\n          }\n        } catch (error) {\n          result.innerHTML = `<div style=\"background: #fecaca; color: #dc2626; padding: 1rem; border-radius: 4px;\">‚ùå Error: ${error.message}</div>`;\n        } finally {\n          btn.disabled = false;\n          btn.textContent = 'Create Agent (No MCP Required)';\n        }\n      }\n    </script>\n  </body>\n</html>\nEOF\necho 'Starting GRC Frontend without MCP validation...' && node server.js"]
      resources:
        cpu: 0.5
        memory: 1Gi
    scale:
      minReplicas: 1
      maxReplicas: 3
  configuration:
    ingress:
      external: true
      targetPort: 8080