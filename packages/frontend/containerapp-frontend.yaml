properties:
  managedEnvironmentId: /subscriptions/2e6b5431-6d83-4072-8ccc-86af69cf22b0/resourceGroups/rg-grc-ai-platform-syd/providers/Microsoft.App/managedEnvironments/grc-containerapp-env
  configuration:
    ingress:
      external: true
      targetPort: 8080
      transport: auto
    activeRevisionsMode: Single
  template:
    containers:
    - image: mcr.microsoft.com/azure-functions/node:4-node20-appservice
      name: grc-frontend
      env:
      - name: NODE_ENV
        value: production
      - name: PORT
        value: "8080"
      command: ["/bin/sh"]
      args: ["-c", "cat > server.js << 'EOF'\nconst express = require('express');\nconst path = require('path');\nconst app = express();\napp.use(express.static('.'));\napp.get('*', (req, res) => {\n  res.sendFile(path.join(__dirname, 'index.html'));\n});\nconst port = process.env.PORT || 8080;\napp.listen(port, () => {\n  console.log('Frontend server running on port ' + port);\n});\nEOF\ncat > package.json << 'EOF'\n{\n  \"name\": \"frontend\",\n  \"version\": \"1.0.0\",\n  \"main\": \"server.js\",\n  \"dependencies\": {\n    \"express\": \"^4.19.2\"\n  },\n  \"scripts\": {\n    \"start\": \"node server.js\"\n  }\n}\nEOF\ncat > index.html << 'EOF'\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n    <title>GRC AI Platform - Azure Hosted</title>\n    <style>\n      body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: white; }\n      .container { max-width: 1200px; margin: 0 auto; text-align: center; }\n      .card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 20px; padding: 40px; margin: 20px 0; border: 1px solid rgba(255,255,255,0.2); }\n      h1 { font-size: 3rem; margin-bottom: 1rem; }\n      .status { font-size: 1.2rem; margin: 20px 0; }\n      .success { color: #4ade80; }\n      .info { color: #60a5fa; }\n      .endpoint { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; margin: 10px 0; font-family: monospace; }\n      .btn { display: inline-block; padding: 12px 24px; background: #4ade80; color: black; text-decoration: none; border-radius: 8px; margin: 10px; font-weight: 600; }\n      .btn:hover { background: #22c55e; }\n    </style>\n  </head>\n  <body>\n    <div class=\"container\">\n      <div class=\"card\">\n        <h1>ğŸš€ GRC AI Platform</h1>\n        <p class=\"status success\">âœ… Frontend: Azure Container Apps (Australia Southeast)</p>\n        <p class=\"status success\">âœ… Backend: Azure Container Apps (Australia Southeast)</p>\n        <p class=\"status info\">ğŸ“ Fully hosted on Azure with data sovereignty compliance</p>\n        \n        <div class=\"card\">\n          <h3>ğŸ”— API Endpoints</h3>\n          <div class=\"endpoint\">Backend: https://grc-backend-simple.calmmeadow-5080198e.australiasoutheast.azurecontainerapps.io</div>\n          <div class=\"endpoint\">Health: /health</div>\n          <div class=\"endpoint\">LLM Configs: /api/v1/simple-llm-configs</div>\n          <div class=\"endpoint\">Agents: /api/v1/simple-agents</div>\n        </div>\n        \n        <div class=\"card\">\n          <h3>ğŸ¯ Test API Connection</h3>\n          <a href=\"https://grc-backend-simple.calmmeadow-5080198e.australiasoutheast.azurecontainerapps.io/health\" target=\"_blank\" class=\"btn\">Test Backend Health</a>\n          <a href=\"https://grc-backend-simple.calmmeadow-5080198e.australiasoutheast.azurecontainerapps.io/api/v1/simple-llm-configs\" target=\"_blank\" class=\"btn\">Test LLM Configs</a>\n          <a href=\"https://grc-backend-simple.calmmeadow-5080198e.australiasoutheast.azurecontainerapps.io/api/v1/simple-agents\" target=\"_blank\" class=\"btn\">Test Agents API</a>\n        </div>\n        \n        <div class=\"card\">\n          <h3>ğŸ—ï¸ Architecture</h3>\n          <p>âœ… Azure Container Apps Environment (Australia Southeast)</p>\n          <p>âœ… Node.js 20 Backend with Express</p>\n          <p>âœ… CORS enabled for cross-origin requests</p>\n          <p>âœ… Auto-scaling (1-3 replicas)</p>\n          <p>âœ… HTTPS enabled with Azure-managed certificates</p>\n        </div>\n      </div>\n    </div>\n    <script>\n      console.log('ğŸ‡¦ğŸ‡º GRC AI Platform - Australia Southeast Region');\n      console.log('Frontend: Container Apps');\n      console.log('Backend: Container Apps');\n      \n      // Test backend connectivity\n      fetch('https://grc-backend-simple.calmmeadow-5080198e.australiasoutheast.azurecontainerapps.io/health')\n        .then(response => response.json())\n        .then(data => {\n          console.log('âœ… Backend Health Check:', data);\n        })\n        .catch(error => {\n          console.error('âŒ Backend Health Check Failed:', error);\n        });\n    </script>\n  </body>\n</html>\nEOF\nnpm install && node server.js"]
      resources:
        cpu: 0.25
        memory: 0.5Gi
    scale:
      minReplicas: 1
      maxReplicas: 3
location: Australia Southeast